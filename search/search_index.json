{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Farmer Code","text":"<p>AI-powered SDLC automation platform.</p>"},{"location":"#what-is-farmer-code","title":"What is Farmer Code?","text":"<p>Farmer Code is a microservices platform that uses AI agents to automate software development lifecycle tasks:</p> <ul> <li>Specification Generation - Generate feature specs from natural language</li> <li>Implementation Planning - Create detailed implementation plans</li> <li>Task Generation - Break plans into actionable tasks</li> <li>Expert Consultation - Ask domain experts (architecture, testing, security)</li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":"<pre><code># Clone and install\ngit clone https://github.com/farmer1st/farmer-code.git\ncd farmer-code\nuv sync\n\n# Start services\ndocker-compose up\n\n# Create a workflow\ncurl -X POST http://localhost:8001/workflows \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"workflow_type\": \"specify\", \"feature_description\": \"Add user authentication\"}'\n</code></pre> <p>Full Installation Guide</p>"},{"location":"#architecture","title":"Architecture","text":"<pre><code>graph LR\n    ORC[Orchestrator] --&gt; HUB[Agent Hub]\n    HUB --&gt; BARON[Baron PM]\n    HUB --&gt; DUC[Duc Architecture]\n    HUB --&gt; MARIE[Marie Testing]</code></pre> Service Port Purpose Agent Hub 8000 Central coordination Orchestrator 8001 Workflow state machine Baron 8010 PM agent Duc 8011 Architecture expert Marie 8012 Testing expert <p>Architecture Overview</p>"},{"location":"#documentation-sections","title":"Documentation Sections","text":"<ul> <li> <p>:material-rocket-launch: Getting Started</p> <p>Installation, quickstart, and development setup.</p> <p>:octicons-arrow-right-24: Get started</p> </li> <li> <p>:material-sitemap: Architecture</p> <p>System design, services, and data flow.</p> <p>:octicons-arrow-right-24: Learn more</p> </li> <li> <p>:material-server: Services</p> <p>Individual service documentation.</p> <p>:octicons-arrow-right-24: Explore</p> </li> <li> <p>:material-book-open: Guides</p> <p>How-to guides for common tasks.</p> <p>:octicons-arrow-right-24: Read guides</p> </li> </ul>"},{"location":"#links","title":"Links","text":"<ul> <li>GitHub Repository</li> <li>API Reference</li> <li>User Journeys</li> </ul>"},{"location":"architecture/","title":"Architecture Documentation","text":"<p>This section documents the system architecture, component interactions, and design decisions for Farmer Code.</p>"},{"location":"architecture/#contents","title":"Contents","text":"Document Description System Overview High-level architecture and design principles Module Interactions How modules communicate and depend on each other Agent Hub Agent Hub service architecture Services Microservices architecture (Feature 008) Diagrams Visual architecture diagrams (Mermaid)"},{"location":"architecture/#architecture-principles","title":"Architecture Principles","text":"<p>Farmer Code follows these architectural principles (from the Constitution):</p> <ol> <li>Thin Client Architecture: All business logic in backend, clients are presentation-only</li> <li>Local-First Design: Primary deployment is local, cloud-ready as future option</li> <li>Services Architecture: Independent services communicating via REST APIs</li> <li>Event-Driven State: State machine manages workflow transitions</li> <li>Agent-Based Processing: AI agents handle specialized tasks (Baron, Duc, Marie)</li> </ol>"},{"location":"architecture/#system-context","title":"System Context","text":"<pre><code>graph TB\n    subgraph \"External Systems\"\n        GH[GitHub API]\n        AI[Claude CLI]\n    end\n\n    subgraph \"Farmer Code\"\n        ORC[Orchestrator]\n        GI[GitHub Integration]\n        WM[Worktree Manager]\n        AH[Agent Hub]\n    end\n\n    subgraph \"Storage\"\n        FS[File System]\n        GIT[Git Repository]\n    end\n\n    ORC --&gt; GI\n    ORC --&gt; WM\n    ORC --&gt; AH\n\n    GI --&gt; GH\n    AH --&gt; AI\n    WM --&gt; GIT\n    ORC --&gt; FS</code></pre>"},{"location":"architecture/#module-dependency-graph","title":"Module Dependency Graph","text":"<pre><code>graph LR\n    subgraph \"Core Layer\"\n        GI[github_integration]\n        WM[worktree_manager]\n    end\n\n    subgraph \"Service Layer\"\n        ORC[orchestrator]\n        AH[agent_hub]\n    end\n\n    ORC --&gt; GI\n    ORC --&gt; WM\n    AH --&gt; GI\n\n    style ORC fill:#f9f,stroke:#333\n    style AH fill:#f9f,stroke:#333\n    style GI fill:#bbf,stroke:#333\n    style WM fill:#bbf,stroke:#333</code></pre> <p>Dependency Rules: - Core layer modules have no internal dependencies - Service layer depends on core layer - No circular dependencies allowed</p>"},{"location":"architecture/#key-design-decisions","title":"Key Design Decisions","text":""},{"location":"architecture/#1-state-machine-for-workflow","title":"1. State Machine for Workflow","text":"<p>Decision: Use explicit state machine for SDLC workflow management.</p> <p>Rationale: - Clear state transitions with guards - Persistent state survives restarts - Easy to add new phases or gates - Enables parallel story execution</p>"},{"location":"architecture/#2-agent-based-architecture","title":"2. Agent-Based Architecture","text":"<p>Decision: Route questions and tasks to specialized AI agents.</p> <p>Rationale: - Domain expertise improves answer quality - Configurable routing rules - Confidence-based validation - Human escalation for uncertain answers</p>"},{"location":"architecture/#3-git-worktrees-for-isolation","title":"3. Git Worktrees for Isolation","text":"<p>Decision: Each feature works in isolated git worktree.</p> <p>Rationale: - Prevents cross-feature conflicts - Enables parallel feature development - Clean main branch until merge - Easy cleanup after completion</p>"},{"location":"architecture/#4-jsonl-for-logging","title":"4. JSONL for Logging","text":"<p>Decision: Use append-only JSONL files for Q&amp;A logging.</p> <p>Rationale: - Immutable audit trail - Easy to process line-by-line - Human-readable format - Supports retrospective analysis</p>"},{"location":"architecture/#data-flow","title":"Data Flow","text":"<p>See Module Interactions for detailed data flow diagrams.</p>"},{"location":"architecture/#related-documentation","title":"Related Documentation","text":"<ul> <li>Modules - Detailed module documentation</li> <li>User Journeys - End-to-end workflows</li> <li>Constitution - Development principles</li> </ul>"},{"location":"architecture/agent-hub/","title":"Agent Hub Architecture","text":"<p>This document describes the architecture of the Agent Hub module, the central coordination layer for all agent interactions.</p>"},{"location":"architecture/agent-hub/#overview","title":"Overview","text":"<p>The Agent Hub provides a unified interface for:</p> <ol> <li>Routing questions to appropriate expert agents</li> <li>Managing sessions for multi-turn conversations</li> <li>Validating confidence and escalating to humans</li> <li>Logging all exchanges for audit and retrospective</li> </ol>"},{"location":"architecture/agent-hub/#component-architecture","title":"Component Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         Agent Hub                                \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502                      AgentHub                              \u2502   \u2502\n\u2502  \u2502  (Central Facade - Coordinates all operations)            \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                \u2502                                  \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502    \u2502           \u2502               \u2502               \u2502           \u2502     \u2502\n\u2502    \u25bc           \u25bc               \u25bc               \u25bc           \u25bc     \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502 \u2502 Agent   \u2502 \u2502 Session \u2502 \u2502Confidence \u2502 \u2502Escalation \u2502 \u2502   QA    \u2502 \u2502\n\u2502 \u2502 Router  \u2502 \u2502 Manager \u2502 \u2502 Validator \u2502 \u2502  Handler  \u2502 \u2502 Logger  \u2502 \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502      \u2502           \u2502             \u2502             \u2502            \u2502      \u2502\n\u2502      \u2502     \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510       \u2502             \u2502     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510\u2502\n\u2502      \u2502     \u2502  Session  \u2502       \u2502             \u2502     \u2502  JSONL    \u2502\u2502\n\u2502      \u2502     \u2502  Storage  \u2502       \u2502             \u2502     \u2502   Files   \u2502\u2502\n\u2502      \u2502     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2502             \u2502     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502\n\u2502      \u2502                         \u2502             \u2502                   \u2502\n\u2502      \u25bc                         \u2502             \u2502                   \u2502\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                    \u2502             \u2502                   \u2502\n\u2502 \u2502 Claude  \u2502                    \u2502             \u2502                   \u2502\n\u2502 \u2502   CLI   \u2502                    \u2502             \u2502                   \u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                    \u2502             \u2502                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                 \u2502             \u2502\n                                 \u25bc             \u25bc\n                            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                            \u2502  Config \u2502   \u2502 GitHub  \u2502\n                            \u2502  (YAML) \u2502   \u2502   API   \u2502\n                            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/agent-hub/#component-responsibilities","title":"Component Responsibilities","text":""},{"location":"architecture/agent-hub/#agenthub-facade","title":"AgentHub (Facade)","text":"<p>The main entry point for all agent interactions.</p> <p>Responsibilities: - Coordinate routing, validation, and logging - Manage sessions for multi-turn conversations - Handle escalation lifecycle - Expose MCP tools</p> <p>Key Methods: - <code>ask_expert()</code> - Route question and return response - <code>check_escalation()</code> - Get escalation status - <code>add_human_response()</code> - Process human feedback - <code>get_session()</code> / <code>close_session()</code> - Session management</p>"},{"location":"architecture/agent-hub/#agentrouter","title":"AgentRouter","text":"<p>Dispatches questions to Claude CLI agents.</p> <p>Responsibilities: - Resolve topic to agent mapping - Spawn Claude CLI process - Parse agent responses - Handle timeouts and errors</p>"},{"location":"architecture/agent-hub/#sessionmanager","title":"SessionManager","text":"<p>Maintains conversation context.</p> <p>Responsibilities: - Create and store sessions - Add messages to sessions - Track session status (active/closed/expired) - Provide session history for context</p>"},{"location":"architecture/agent-hub/#confidencevalidator","title":"ConfidenceValidator","text":"<p>Validates agent answers against thresholds.</p> <p>Responsibilities: - Look up topic-specific thresholds - Compare confidence to threshold - Return validation outcome (ACCEPTED/ESCALATE)</p>"},{"location":"architecture/agent-hub/#escalationhandler","title":"EscalationHandler","text":"<p>Manages human review workflow.</p> <p>Responsibilities: - Create escalation requests - Format GitHub comments - Process human responses - Handle CONFIRM/CORRECT/ADD_CONTEXT actions</p>"},{"location":"architecture/agent-hub/#qalogger","title":"QALogger","text":"<p>Provides audit trail for all exchanges.</p> <p>Responsibilities: - Log complete Q&amp;A exchanges - Include session and escalation context - Write to feature-specific JSONL files - Support log retrieval by feature</p>"},{"location":"architecture/agent-hub/#data-flow","title":"Data Flow","text":""},{"location":"architecture/agent-hub/#ask_expert-flow","title":"ask_expert Flow","text":"<pre><code>1. Client calls ask_expert(topic, question)\n        \u2502\n        \u25bc\n2. AgentHub validates topic\n        \u2502\n        \u25bc\n3. AgentHub creates/retrieves session\n        \u2502\n        \u25bc\n4. AgentRouter dispatches to agent\n        \u2502\n        \u25bc\n5. AgentRouter parses answer\n        \u2502\n        \u25bc\n6. ConfidenceValidator validates answer\n        \u2502\n        \u251c\u2500\u2500 High confidence \u2500\u2500\u25ba Return RESOLVED\n        \u2502\n        \u2514\u2500\u2500 Low confidence \u2500\u2500\u25ba Create escalation\n                \u2502              Return PENDING_HUMAN\n                \u25bc\n7. QALogger logs exchange\n        \u2502\n        \u25bc\n8. Return HubResponse to client\n</code></pre>"},{"location":"architecture/agent-hub/#escalation-resolution-flow","title":"Escalation Resolution Flow","text":"<pre><code>1. Client calls check_escalation(escalation_id)\n        \u2502\n        \u25bc\n2. Return current status (pending/resolved)\n        \u2502\n        \u25bc\n3. Human provides response via add_human_response()\n        \u2502\n        \u251c\u2500\u2500 CONFIRM \u2500\u2500\u25ba Accept tentative answer\n        \u2502\n        \u251c\u2500\u2500 CORRECT \u2500\u2500\u25ba Use human's answer (100% confidence)\n        \u2502\n        \u2514\u2500\u2500 ADD_CONTEXT \u2500\u2500\u25ba Mark as NEEDS_REROUTE\n                            Client can re-ask with context\n</code></pre>"},{"location":"architecture/agent-hub/#session-architecture","title":"Session Architecture","text":""},{"location":"architecture/agent-hub/#session-model","title":"Session Model","text":"<pre><code>Session:\n    id: str              # UUID\n    agent_id: str        # Agent handling this session\n    feature_id: str      # Feature grouping\n    messages: [Message]  # Conversation history\n    created_at: datetime\n    updated_at: datetime\n    status: SessionStatus  # ACTIVE, CLOSED, EXPIRED\n</code></pre>"},{"location":"architecture/agent-hub/#message-model","title":"Message Model","text":"<pre><code>Message:\n    role: MessageRole    # USER, ASSISTANT, HUMAN\n    content: str         # Message text\n    timestamp: datetime\n    metadata: dict       # Additional context (confidence, etc.)\n</code></pre>"},{"location":"architecture/agent-hub/#session-lifecycle","title":"Session Lifecycle","text":"<pre><code>                    create()\n                       \u2502\n                       \u25bc\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500[ACTIVE]\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502                  \u2502                  \u2502\n    \u2502   add_message()  \u2502     timeout      \u2502\n    \u2502   (loops back)   \u2502                  \u2502\n    \u2502                  \u25bc                  \u25bc\n    \u2502            close()              [EXPIRED]\n    \u2502                  \u2502\n    \u2502                  \u25bc\n    \u2502            [CLOSED]\n    \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n</code></pre>"},{"location":"architecture/agent-hub/#mcp-server-architecture","title":"MCP Server Architecture","text":"<p>The Agent Hub can optionally be exposed as an MCP server for external consumers.</p> <p>Note: The core Agent Hub dispatches agents via Claude CLI subprocess calls. The MCP server is an optional alternative interface for SDK-based agents.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    External Claude Agent            \u2502\n\u2502   (using claude_code_sdk)           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                   \u2502\n                   \u2502 MCP Protocol\n                   \u2502\n                   \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         MCP Server                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502  ask_expert tool            \u2502    \u2502\n\u2502  \u2502  check_escalation tool      \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                  \u2502\n                  \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502           AgentHub                  \u2502\n\u2502      (same instance)                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/agent-hub/#configuration-architecture","title":"Configuration Architecture","text":""},{"location":"architecture/agent-hub/#config-loading","title":"Config Loading","text":"<pre><code>routing.yaml \u2500\u2500parse\u2500\u2500\u25ba RoutingConfig\n                             \u2502\n          \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n          \u2502                                      \u2502\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2510                        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502  Agents   \u2502                        \u2502   Overrides   \u2502\n    \u2502           \u2502                        \u2502               \u2502\n    \u2502 architect \u2502                        \u2502 security: 95% \u2502\n    \u2502 devops    \u2502                        \u2502 legal: 90%    \u2502\n    \u2502 security  \u2502                        \u2502               \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/agent-hub/#threshold-resolution","title":"Threshold Resolution","text":"<ol> <li>Check topic in overrides \u2192 use override threshold</li> <li>Else \u2192 use default threshold (80%)</li> </ol>"},{"location":"architecture/agent-hub/#error-handling","title":"Error Handling","text":""},{"location":"architecture/agent-hub/#error-hierarchy","title":"Error Hierarchy","text":"<pre><code>AgentHubError (base)\n\u251c\u2500\u2500 UnknownTopicError    # Topic not configured\n\u251c\u2500\u2500 SessionNotFoundError # Session doesn't exist\n\u251c\u2500\u2500 SessionClosedError   # Session already closed\n\u251c\u2500\u2500 EscalationError      # Escalation not found\n\u251c\u2500\u2500 AgentDispatchError   # Agent failed to start\n\u251c\u2500\u2500 AgentTimeoutError    # Agent timed out\n\u2514\u2500\u2500 RoutingError         # General routing failure\n</code></pre>"},{"location":"architecture/agent-hub/#error-propagation","title":"Error Propagation","text":"<ul> <li>Validation errors (topic, session) \u2192 raise immediately</li> <li>Agent errors \u2192 catch and convert to appropriate error</li> <li>Logging errors \u2192 log warning but don't fail request</li> </ul>"},{"location":"architecture/agent-hub/#design-decisions","title":"Design Decisions","text":""},{"location":"architecture/agent-hub/#why-in-memory-sessions","title":"Why In-Memory Sessions?","text":"<ul> <li>Simplicity: No external dependencies for local dev</li> <li>Performance: Fast access without I/O</li> <li>Sufficient: 5-10 concurrent sessions is the target</li> <li>Replaceable: Interface allows future persistence layer</li> </ul>"},{"location":"architecture/agent-hub/#why-mcp-for-optional-server-interface","title":"Why MCP (for optional server interface)?","text":"<ul> <li>SDK Compatibility: MCP is native to Claude Code SDK for external integrations</li> <li>Standard Protocol: Follows Anthropic's Model Context Protocol</li> <li>Tool-Based: Agents naturally understand tools</li> </ul>"},{"location":"architecture/agent-hub/#why-jsonl-for-logs","title":"Why JSONL for Logs?","text":"<ul> <li>Append-Only: Safe for concurrent writes</li> <li>Human-Readable: Easy debugging</li> <li>Streamable: Can process large files line by line</li> <li>Simple: No database dependencies</li> </ul>"},{"location":"architecture/agent-hub/#testing-strategy","title":"Testing Strategy","text":""},{"location":"architecture/agent-hub/#test-pyramid","title":"Test Pyramid","text":"<pre><code>           /\\\n          /  \\  E2E Tests (AH-001 to AH-005)\n         /    \\  - Full journey validation\n        /\u2500\u2500\u2500\u2500\u2500\u2500\\\n       /        \\  Integration Tests\n      /          \\  - Component interaction\n     /\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\\\n    /              \\  Unit Tests\n   /                \\  - Isolated components\n  /\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\\\n</code></pre>"},{"location":"architecture/agent-hub/#journey-coverage","title":"Journey Coverage","text":"Journey Focus AH-001 Routing to correct agent AH-002 Session context preservation AH-003 Confidence escalation AH-004 Escalation tracking AH-005 Audit logging"},{"location":"architecture/agent-hub/#future-considerations","title":"Future Considerations","text":""},{"location":"architecture/agent-hub/#persistent-sessions","title":"Persistent Sessions","text":"<p>If needed, sessions could be backed by: - SQLite for single-node - Redis for distributed</p>"},{"location":"architecture/agent-hub/#additional-mcp-tools","title":"Additional MCP Tools","text":"<p>Potential future tools: - <code>add_human_response</code> - Process human feedback - <code>get_session_history</code> - Retrieve conversation - <code>close_session</code> - End conversation</p>"},{"location":"architecture/agent-hub/#federation","title":"Federation","text":"<p>For multi-hub deployments: - Central routing registry - Cross-hub session forwarding - Distributed logging</p>"},{"location":"architecture/data-flow/","title":"Data Flow","text":"<p>How data flows through the Farmer Code system.</p>"},{"location":"architecture/data-flow/#workflow-execution-flow","title":"Workflow Execution Flow","text":"<pre><code>sequenceDiagram\n    participant User\n    participant Orchestrator\n    participant AgentHub\n    participant Baron\n\n    User-&gt;&gt;Orchestrator: Create workflow\n    Orchestrator-&gt;&gt;Orchestrator: Generate feature ID\n    Orchestrator-&gt;&gt;AgentHub: Invoke Baron (specify)\n    AgentHub-&gt;&gt;Baron: POST /invoke\n    Baron-&gt;&gt;Baron: Process with Claude SDK\n    Baron--&gt;&gt;AgentHub: Specification result\n    AgentHub-&gt;&gt;AgentHub: Log to audit\n    AgentHub--&gt;&gt;Orchestrator: Response\n    Orchestrator--&gt;&gt;User: Workflow created</code></pre>"},{"location":"architecture/data-flow/#requestresponse-models","title":"Request/Response Models","text":""},{"location":"architecture/data-flow/#workflow-creation","title":"Workflow Creation","text":"<pre><code>// Request\n{\n  \"workflow_type\": \"specify\",\n  \"feature_description\": \"Add user authentication\"\n}\n\n// Response\n{\n  \"id\": \"uuid\",\n  \"feature_id\": \"009-user-authentication\",\n  \"status\": \"in_progress\"\n}\n</code></pre>"},{"location":"architecture/data-flow/#agent-invocation","title":"Agent Invocation","text":"<pre><code>// Request to Agent Hub\n{\n  \"workflow_type\": \"specify\",\n  \"context\": {\n    \"feature_description\": \"Add user authentication\"\n  }\n}\n\n// Response\n{\n  \"success\": true,\n  \"result\": \"...\",\n  \"confidence\": 85,\n  \"metadata\": {\n    \"duration_ms\": 1500\n  }\n}\n</code></pre>"},{"location":"architecture/data-flow/#session-context-flow","title":"Session Context Flow","text":"<p>For multi-turn conversations:</p> <pre><code>sequenceDiagram\n    participant User\n    participant AgentHub\n    participant Agent\n\n    User-&gt;&gt;AgentHub: Ask question (new)\n    AgentHub-&gt;&gt;AgentHub: Create session\n    AgentHub-&gt;&gt;Agent: Query with context\n    Agent--&gt;&gt;AgentHub: Answer\n    AgentHub--&gt;&gt;User: Answer + session_id\n\n    User-&gt;&gt;AgentHub: Follow-up (session_id)\n    AgentHub-&gt;&gt;AgentHub: Load session history\n    AgentHub-&gt;&gt;Agent: Query with full context\n    Agent--&gt;&gt;AgentHub: Answer\n    AgentHub--&gt;&gt;User: Answer</code></pre>"},{"location":"architecture/data-flow/#escalation-flow","title":"Escalation Flow","text":"<p>When confidence is below threshold:</p> <pre><code>sequenceDiagram\n    participant User\n    participant AgentHub\n    participant Agent\n    participant Human\n\n    User-&gt;&gt;AgentHub: Ask question\n    AgentHub-&gt;&gt;Agent: Query\n    Agent--&gt;&gt;AgentHub: Low confidence (60%)\n    AgentHub-&gt;&gt;AgentHub: Create escalation\n    AgentHub--&gt;&gt;User: Pending human review\n\n    Human-&gt;&gt;AgentHub: Provide answer\n    AgentHub-&gt;&gt;AgentHub: Resolve escalation\n    AgentHub--&gt;&gt;User: Final answer</code></pre>"},{"location":"architecture/module-interactions/","title":"Module Interactions","text":"<p>This document describes how Farmer Code modules interact with each other, including dependencies, interfaces, and data flow.</p>"},{"location":"architecture/module-interactions/#module-dependency-matrix","title":"Module Dependency Matrix","text":"Module Depends On Depended By <code>github_integration</code> (external: PyGithub) <code>orchestrator</code>, <code>agent_hub</code> <code>worktree_manager</code> (external: git) <code>orchestrator</code> <code>orchestrator</code> <code>github_integration</code>, <code>worktree_manager</code>, <code>agent_hub</code> (top-level) <code>agent_hub</code> <code>github_integration</code> (optional) <code>orchestrator</code>"},{"location":"architecture/module-interactions/#interaction-patterns","title":"Interaction Patterns","text":""},{"location":"architecture/module-interactions/#1-orchestrator-github-integration","title":"1. Orchestrator \u2192 GitHub Integration","text":"<p>The orchestrator uses GitHub Integration for all GitHub operations:</p> <pre><code># Issue creation during Phase 1\nfrom github_integration import GitHubService\n\ngithub = GitHubService.from_env()\nissue = github.issues.create(\n    title=\"Feature: Add authentication\",\n    body=spec_content,\n    labels=[\"enhancement\", \"status:new\"]\n)\n\n# Label sync during state transitions\ngithub.issues.update_labels(\n    issue_number=123,\n    labels=[\"status:phase-2\"]\n)\n\n# Comment posting for agent feedback\ngithub.issues.add_comment(\n    issue_number=123,\n    body=\"Agent completed architecture review.\"\n)\n</code></pre> <p>Data Exchange: - Input: Issue metadata, comment content, label lists - Output: Issue objects, comment objects, operation status</p>"},{"location":"architecture/module-interactions/#2-orchestrator-worktree-manager","title":"2. Orchestrator \u2192 Worktree Manager","text":"<p>The orchestrator uses Worktree Manager for isolated development environments:</p> <pre><code>from worktree_manager import WorktreeService, CreateWorktreeRequest\n\nworktree = WorktreeService(repo_path)\n\n# Create feature worktree\nresult = worktree.create_worktree(\n    CreateWorktreeRequest(\n        branch_name=\"123-add-auth\",\n        worktree_path=Path(\"/worktrees/123-add-auth\")\n    )\n)\n\n# Initialize plans directory\nworktree.init_plans(result.worktree_path)\n\n# Cleanup after completion\nworktree.delete_worktree(result.worktree_path)\n</code></pre> <p>Data Exchange: - Input: Branch names, paths, commit messages - Output: Worktree info, operation results</p>"},{"location":"architecture/module-interactions/#3-orchestrator-agent-hub","title":"3. Orchestrator \u2192 Agent Hub","text":"<p>The orchestrator routes questions to appropriate expert agents:</p> <pre><code>from agent_hub import AgentHub, ConfigLoader\n\nconfig = ConfigLoader.load_from_file(\"config/routing.yaml\")\nhub = AgentHub(config, log_dir=\"logs/qa\")\n\n# Route architecture question\nresponse = hub.ask_expert(\n    topic=\"architecture\",\n    question=\"Which auth method should we use?\",\n    feature_id=\"005-auth\"\n)\n\nif response.status.value == \"resolved\":\n    answer = response.answer\nelse:\n    # Low confidence - check escalation\n    escalation = hub.check_escalation(response.escalation_id)\n</code></pre> <p>Data Exchange: - Input: Questions with topic and context - Output: Answers with confidence scores, escalation requests</p>"},{"location":"architecture/module-interactions/#4-agent-hub-github-integration-optional","title":"4. Agent Hub \u2192 GitHub Integration (Optional)","text":"<p>Agent Hub can post escalation comments to GitHub:</p> <pre><code># Format escalation for GitHub\nescalation = hub.check_escalation(escalation_id)\n\n# Post to issue (via orchestrator or directly)\ngithub.issues.add_comment(\n    issue_number=feature_issue_number,\n    body=escalation.format_comment()\n)\n</code></pre>"},{"location":"architecture/module-interactions/#data-flow-diagrams","title":"Data Flow Diagrams","text":""},{"location":"architecture/module-interactions/#phase-1-execution","title":"Phase 1 Execution","text":"<pre><code>sequenceDiagram\n    participant O as Orchestrator\n    participant SM as StateMachine\n    participant GI as GitHubIntegration\n    participant WM as WorktreeManager\n\n    O-&gt;&gt;SM: transition(IDLE \u2192 PHASE_1)\n    SM--&gt;&gt;O: StateTransition(success)\n\n    O-&gt;&gt;GI: create_issue(title, body, labels)\n    GI--&gt;&gt;O: Issue(number=123)\n\n    O-&gt;&gt;WM: create_worktree(\"123-feature\")\n    WM--&gt;&gt;O: OperationResult(success)\n\n    O-&gt;&gt;WM: init_plans(worktree_path)\n    WM--&gt;&gt;O: OperationResult(success)\n\n    O-&gt;&gt;GI: update_labels([\"status:phase-1\"])\n    GI--&gt;&gt;O: success\n\n    O-&gt;&gt;SM: transition(PHASE_1 \u2192 PHASE_2)\n    SM--&gt;&gt;O: StateTransition(success)</code></pre>"},{"location":"architecture/module-interactions/#question-routing-with-escalation","title":"Question Routing with Escalation","text":"<pre><code>sequenceDiagram\n    participant O as Orchestrator\n    participant AH as AgentHub\n    participant R as AgentRouter\n    participant V as Validator\n    participant E as EscalationHandler\n    participant L as QALogger\n\n    O-&gt;&gt;AH: ask_expert(topic, question)\n    AH-&gt;&gt;R: dispatch_question(question)\n    R--&gt;&gt;AH: AgentHandle\n\n    AH-&gt;&gt;R: parse_answer(handle)\n    R--&gt;&gt;AH: Answer(confidence=65)\n\n    AH-&gt;&gt;V: validate(answer)\n    V--&gt;&gt;AH: ValidationResult(ESCALATE)\n\n    AH-&gt;&gt;E: create_escalation(question, answer)\n    E--&gt;&gt;AH: EscalationRequest\n\n    Note over AH,E: Human reviews and responds\n\n    AH-&gt;&gt;E: process_response(escalation, response)\n    E--&gt;&gt;AH: EscalationResult(final_answer)\n\n    AH-&gt;&gt;L: log_exchange(entry)\n    L--&gt;&gt;AH: success\n\n    AH--&gt;&gt;O: HubResponse(final_answer)</code></pre>"},{"location":"architecture/module-interactions/#interface-contracts","title":"Interface Contracts","text":""},{"location":"architecture/module-interactions/#github-integration-interface","title":"GitHub Integration Interface","text":"<pre><code>class GitHubService:\n    \"\"\"GitHub API wrapper.\"\"\"\n\n    @classmethod\n    def from_env(cls) -&gt; GitHubService: ...\n\n    @property\n    def issues(self) -&gt; IssueService: ...\n\n    @property\n    def comments(self) -&gt; CommentService: ...\n\nclass IssueService:\n    def create(self, title: str, body: str, labels: list[str]) -&gt; Issue: ...\n    def update(self, issue_number: int, **kwargs) -&gt; Issue: ...\n    def update_labels(self, issue_number: int, labels: list[str]) -&gt; None: ...\n    def add_comment(self, issue_number: int, body: str) -&gt; Comment: ...\n</code></pre>"},{"location":"architecture/module-interactions/#worktree-manager-interface","title":"Worktree Manager Interface","text":"<pre><code>class WorktreeService:\n    \"\"\"Git worktree management.\"\"\"\n\n    def __init__(self, repo_path: Path): ...\n\n    def create_worktree(self, request: CreateWorktreeRequest) -&gt; OperationResult: ...\n    def delete_worktree(self, path: Path) -&gt; OperationResult: ...\n    def init_plans(self, worktree_path: Path) -&gt; OperationResult: ...\n    def commit_and_push(self, request: CommitRequest) -&gt; OperationResult: ...\n</code></pre>"},{"location":"architecture/module-interactions/#agent-hub-interface","title":"Agent Hub Interface","text":"<pre><code>class AgentHub:\n    \"\"\"Central coordination for agent interactions.\"\"\"\n\n    def __init__(self, config: RoutingConfig, log_dir: str | None = None): ...\n\n    def ask_expert(self, topic: str, question: str, context: str = \"\",\n                   feature_id: str = \"\", session_id: str | None = None) -&gt; HubResponse: ...\n    def check_escalation(self, escalation_id: str) -&gt; EscalationRequest: ...\n    def add_human_response(self, escalation_id: str, action: HumanAction,\n                           responder: str, corrected_answer: str | None = None) -&gt; EscalationResult: ...\n    def get_session(self, session_id: str) -&gt; Session: ...\n    def close_session(self, session_id: str) -&gt; None: ...\n</code></pre>"},{"location":"architecture/module-interactions/#error-propagation","title":"Error Propagation","text":"<p>Errors flow upward through the module hierarchy:</p> <pre><code>External System Error\n    \u2193\nModule-Specific Error (e.g., AgentTimeoutError)\n    \u2193\nOrchestrator catches and handles\n    \u2193\nState machine may transition to error state\n    \u2193\nUser notified via GitHub comment or UI\n</code></pre>"},{"location":"architecture/module-interactions/#error-types-by-module","title":"Error Types by Module","text":"Module Error Types <code>github_integration</code> <code>GitHubAPIError</code>, <code>IssueNotFoundError</code>, <code>AuthenticationError</code> <code>worktree_manager</code> <code>BranchExistsError</code>, <code>WorktreeExistsError</code>, <code>GitCommandError</code> <code>orchestrator</code> <code>InvalidStateTransition</code>, <code>PhaseExecutionError</code>, <code>PollTimeoutError</code> <code>agent_hub</code> <code>UnknownTopicError</code>, <code>AgentDispatchError</code>, <code>AgentTimeoutError</code>, <code>EscalationError</code>, <code>SessionNotFoundError</code>"},{"location":"architecture/module-interactions/#thread-safety","title":"Thread Safety","text":"<ul> <li>State Machine: Single-threaded, file-locked during writes</li> <li>GitHub Operations: Thread-safe (PyGithub handles internally)</li> <li>Git Operations: Process-based isolation via subprocess</li> <li>Q&amp;A Logging: Append-only, one writer per feature</li> </ul>"},{"location":"architecture/module-interactions/#configuration-sharing","title":"Configuration Sharing","text":"<p>Modules read configuration from:</p> <ol> <li>Environment Variables: API keys, credentials (<code>python-dotenv</code>)</li> <li>YAML Files: Routing rules, agent definitions (<code>config/routing.yaml</code>)</li> <li>JSON Files: State persistence (<code>.plans/{issue}/state.json</code>)</li> </ol>"},{"location":"architecture/orchestration-flow/","title":"Orchestration Flow","text":"<p>This document describes the complete orchestration system for Farmer Code, including Baron PM Agent, Agent Hub, domain experts, and human escalation flows.</p>"},{"location":"architecture/orchestration-flow/#overview","title":"Overview","text":"<p>Farmer Code uses a multi-agent orchestration system where:</p> <ol> <li>Baron PM Agent drives the speckit workflow (specify \u2192 plan \u2192 tasks)</li> <li>Agent Hub coordinates expert consultations and human escalations</li> <li>Domain Experts provide specialized knowledge (@duc, @veuve, @marie)</li> <li>Human Reviewers approve critical decisions and resolve escalations</li> <li>Orchestrator manages the overall SDLC state machine</li> </ol> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                              USER / DEVELOPER                                \u2502\n\u2502                     (Feature Request / Approval / Feedback)                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                      \u2502\n                                      \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                           ORCHESTRATOR SERVICE                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502                       State Machine                                  \u2502   \u2502\n\u2502  \u2502  IDLE \u2192 PHASE_1 \u2192 PHASE_2 \u2192 GATE_1 \u2192 DONE                           \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502  BaronDispatcher \u2502  \u2502  Phase Executor  \u2502  \u2502  Label Sync / Polling    \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502                       \u2502                        \u2502\n          \u25bc                       \u25bc                        \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   BARON PM       \u2502  \u2502   WORKTREE       \u2502  \u2502   GITHUB INTEGRATION         \u2502\n\u2502   AGENT          \u2502  \u2502   MANAGER        \u2502  \u2502                              \u2502\n\u2502                  \u2502  \u2502                  \u2502  \u2502  - Issues                    \u2502\n\u2502  - Specify       \u2502  \u2502  - Create        \u2502  \u2502  - Comments                  \u2502\n\u2502  - Plan          \u2502  \u2502  - Init Plans    \u2502  \u2502  - Labels                    \u2502\n\u2502  - Tasks         \u2502  \u2502  - Commit/Push   \u2502  \u2502  - Pull Requests             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502\n          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                              AGENT HUB (MCP)                                 \u2502\n\u2502                                                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502  Question Router \u2502  \u2502  Session Manager \u2502  \u2502  Escalation Handler      \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                                                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502                        Expert Agents                                  \u2502  \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502  \u2502\n\u2502  \u2502  \u2502 @duc        \u2502  \u2502 @veuve      \u2502  \u2502 @marie      \u2502  \u2502 @gustave    \u2502  \u2502  \u2502\n\u2502  \u2502  \u2502 Architecture\u2502  \u2502 Product     \u2502  \u2502 Testing     \u2502  \u2502 DevOps      \u2502  \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2502\n          \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                            HUMAN REVIEWERS                                   \u2502\n\u2502                   (Async Escalation Resolution)                              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/orchestration-flow/#agent-roles","title":"Agent Roles","text":""},{"location":"architecture/orchestration-flow/#baron-pm-agent","title":"Baron PM Agent","text":"<p>Baron is a prompt-driven Claude agent (invoked via CLI subprocess) that acts as a Product Manager for the speckit workflow. Baron's logic lives in prompts, not Python code. It is executed via <code>ClaudeCLIRunner</code>:</p> Workflow Input Output Purpose Specify Feature description spec.md Create feature specification Plan spec.md plan.md + artifacts Generate implementation plan Tasks plan.md tasks.md Generate TDD-ordered task list <p>Baron consults domain experts via Agent Hub for specialized questions.</p>"},{"location":"architecture/orchestration-flow/#agent-hub-experts","title":"Agent Hub Experts","text":"Expert Topic Specialty @duc <code>architecture</code> System design, API contracts, data models @veuve <code>product</code> User stories, requirements, success criteria @marie <code>testing</code> Test strategy, edge cases, quality assurance @gustave <code>devops</code> Infrastructure, deployment, CI/CD @charles <code>security</code> Authentication, authorization, compliance"},{"location":"architecture/orchestration-flow/#communication-flows","title":"Communication Flows","text":""},{"location":"architecture/orchestration-flow/#1-baron-agent-hub-expert","title":"1. Baron \u2192 Agent Hub \u2192 Expert","text":"<p>When Baron needs domain expertise:</p> <pre><code>Baron                    Agent Hub                 Expert (@duc)\n  \u2502                          \u2502                          \u2502\n  \u251c\u2500\u2500ask_expert(topic,q)\u2500\u2500\u2500\u2500\u25ba\u2502                          \u2502\n  \u2502                          \u251c\u2500\u2500route_question()\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n  \u2502                          \u2502                          \u251c\u2500\u2500process\n  \u2502                          \u2502\u25c4\u2500\u2500answer(confidence)\u2500\u2500\u2500\u2500\u2500\u2524\n  \u2502                          \u251c\u2500\u2500validate_confidence()   \u2502\n  \u2502                          \u2502                          \u2502\n  \u2502\u25c4\u2500\u2500answer\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524                          \u2502\n  \u2502                          \u2502                          \u2502\n</code></pre> <p>MCP Tool Call: <pre><code>{\n  \"tool\": \"ask_expert\",\n  \"topic\": \"architecture\",\n  \"question\": \"Should we use PostgreSQL or MongoDB for user data?\",\n  \"context\": \"Feature requires complex queries and transactions\"\n}\n</code></pre></p>"},{"location":"architecture/orchestration-flow/#2-low-confidence-human-escalation","title":"2. Low Confidence \u2192 Human Escalation","text":"<p>When an expert's answer has low confidence:</p> <pre><code>Baron          Agent Hub           Expert            Human\n  \u2502                \u2502                  \u2502                 \u2502\n  \u251c\u2500\u2500ask_expert\u2500\u2500\u2500\u25ba\u2502                  \u2502                 \u2502\n  \u2502                \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                 \u2502\n  \u2502                \u2502\u25c4\u2500\u2500confidence:65\u2500\u2500\u2524                 \u2502\n  \u2502                \u2502                  \u2502                 \u2502\n  \u2502                \u251c\u2500\u2500create_escalation()               \u2502\n  \u2502                \u2502                  \u2502                 \u2502\n  \u2502\u25c4\u2500\u2500blocked\u2500\u2500\u2500\u2500\u2500\u2500\u2524                  \u2502                 \u2502\n  \u2502                \u2502                  \u2502                 \u2502\n  \u2502  (continues    \u2502                  \u2502                 \u2502\n  \u2502   other work)  \u2502                  \u2502                 \u2502\n  \u2502                \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500response\u2500\u2500\u2500\u2500\u2524\n  \u2502                \u2502                  \u2502                 \u2502\n  \u2502\u25c4\u2500\u2500answer\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524                  \u2502                 \u2502\n  \u2502                \u2502                  \u2502                 \u2502\n</code></pre> <p>Escalation Request (GitHub Issue Comment): <pre><code>## \ud83d\udd04 Human Review Required\n\n**Question:** Should we use PostgreSQL or MongoDB for user data?\n**Expert:** @duc (Architecture)\n**Confidence:** 65%\n\n### Expert's Answer\nPostgreSQL would work, but MongoDB might be simpler for this use case.\n\n### Why Review Needed\nConfidence below 80% threshold. Multiple valid approaches exist.\n\n### Options\n- [ ] **CONFIRM** - Accept expert's answer\n- [ ] **CORRECT** - Provide different answer\n- [ ] **CONTEXT** - Add more context for re-evaluation\n\nPlease reply with your decision.\n</code></pre></p>"},{"location":"architecture/orchestration-flow/#3-session-continuity","title":"3. Session Continuity","text":"<p>Agent Hub maintains conversation sessions for multi-turn interactions:</p> <pre><code>Baron                    Agent Hub                 Expert\n  \u2502                          \u2502                        \u2502\n  \u251c\u2500\u2500ask_expert(session:A)\u2500\u2500\u25ba\u2502                        \u2502\n  \u2502                          \u251c\u2500\u2500create_session(A)\u2500\u2500\u2500\u2500\u25ba\u2502\n  \u2502                          \u2502\u25c4\u2500\u2500answer\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n  \u2502\u25c4\u2500\u2500answer\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524                        \u2502\n  \u2502                          \u2502                        \u2502\n  \u2502 (later...)               \u2502                        \u2502\n  \u2502                          \u2502                        \u2502\n  \u251c\u2500\u2500ask_expert(session:A)\u2500\u2500\u25ba\u2502                        \u2502\n  \u2502                          \u251c\u2500\u2500resume_session(A)\u2500\u2500\u2500\u2500\u25ba\u2502\n  \u2502                          \u2502\u25c4\u2500\u2500answer (with ctx)\u2500\u2500\u2500\u2500\u2524\n  \u2502\u25c4\u2500\u2500answer\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524                        \u2502\n</code></pre> <p>Sessions preserve context for follow-up questions within the same feature.</p>"},{"location":"architecture/orchestration-flow/#the-speckit-workflow","title":"The Speckit Workflow","text":""},{"location":"architecture/orchestration-flow/#complete-flow","title":"Complete Flow","text":"<pre><code>User: \"I want to add OAuth2 authentication\"\n                    \u2502\n                    \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  1. SPECIFY                          \u2502\n\u2502                                                      \u2502\n\u2502  Input: Natural language description                 \u2502\n\u2502  Baron:                                              \u2502\n\u2502    - Creates feature branch and directory            \u2502\n\u2502    - Loads spec-template.md                          \u2502\n\u2502    - Analyzes requirements                           \u2502\n\u2502    - Consults @veuve for product questions           \u2502\n\u2502    - Writes spec.md                                  \u2502\n\u2502  Output: specs/008-oauth2-auth/spec.md               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                    \u2502\n                    \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  2. PLAN                             \u2502\n\u2502                                                      \u2502\n\u2502  Input: spec.md                                      \u2502\n\u2502  Baron:                                              \u2502\n\u2502    - Runs research phase (resolve unknowns)          \u2502\n\u2502    - Consults @duc for architecture decisions        \u2502\n\u2502    - Generates data-model.md                         \u2502\n\u2502    - Generates API contracts                         \u2502\n\u2502    - Writes plan.md with constitution check          \u2502\n\u2502  Output: plan.md, research.md, data-model.md,        \u2502\n\u2502          contracts/, quickstart.md                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                    \u2502\n                    \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  3. TASKS                            \u2502\n\u2502                                                      \u2502\n\u2502  Input: plan.md                                      \u2502\n\u2502  Baron:                                              \u2502\n\u2502    - Reads all design artifacts                      \u2502\n\u2502    - Applies TDD ordering (tests first)              \u2502\n\u2502    - Consults @marie for test strategy               \u2502\n\u2502    - Generates dependency-ordered tasks              \u2502\n\u2502    - Writes tasks.md                                 \u2502\n\u2502  Output: specs/008-oauth2-auth/tasks.md              \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                    \u2502\n                    \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  4. IMPLEMENT                        \u2502\n\u2502                                                      \u2502\n\u2502  Input: tasks.md                                     \u2502\n\u2502  Developer/Agent:                                    \u2502\n\u2502    - Executes tasks in order                         \u2502\n\u2502    - Writes tests first (TDD)                        \u2502\n\u2502    - Implements features                             \u2502\n\u2502    - Runs quality checks                             \u2502\n\u2502  Output: Working code with tests                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/orchestration-flow/#baron-result-format","title":"Baron Result Format","text":"<p>All Baron workflows output structured JSON:</p> <pre><code>Baron executing specify workflow...\n[agent activity...]\n\n&lt;!-- BARON_RESULT_START --&gt;\n{\n    \"success\": true,\n    \"spec_path\": \"specs/008-oauth2-auth/spec.md\",\n    \"feature_id\": \"008-oauth2-auth\",\n    \"branch_name\": \"008-oauth2-auth\",\n    \"duration_seconds\": 45.2\n}\n&lt;!-- BARON_RESULT_END --&gt;\n</code></pre> <p>The BaronDispatcher parses results between these markers.</p>"},{"location":"architecture/orchestration-flow/#sdlc-state-machine-integration","title":"SDLC State Machine Integration","text":"<p>Baron workflows integrate with the orchestrator state machine:</p> <pre><code>                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502              SDLC PHASES                     \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nIDLE \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\n           \u2502\n           \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PHASE 1: Setup                                                   \u2502\n\u2502  - Create GitHub issue                                            \u2502\n\u2502  - Create branch and worktree                                     \u2502\n\u2502  - Initialize .plans directory                                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502\n           \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PHASE 2: Specification (Baron /speckit.specify)                  \u2502\n\u2502  - Baron creates spec.md                                          \u2502\n\u2502  - Expert consultations via Agent Hub                             \u2502\n\u2502  - Human escalations if needed                                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502\n           \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PHASE 3: Planning (Baron /speckit.plan)                          \u2502\n\u2502  - Baron creates plan.md and artifacts                            \u2502\n\u2502  - Architecture decisions via @duc                                \u2502\n\u2502  - Research phase resolves unknowns                               \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502\n           \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PHASE 4: Tasks (Baron /speckit.tasks)                            \u2502\n\u2502  - Baron creates tasks.md                                         \u2502\n\u2502  - TDD ordering enforced                                          \u2502\n\u2502  - Test strategy via @marie                                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502\n           \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  GATE 1: Human Approval                                           \u2502\n\u2502  - Review spec, plan, tasks                                       \u2502\n\u2502  - Approve to proceed with implementation                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502\n           \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PHASE 5-7: Implementation (/speckit.implement)                   \u2502\n\u2502  - Execute tasks in order                                         \u2502\n\u2502  - Agent or human implements                                      \u2502\n\u2502  - Tests first per TDD                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502\n           \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PHASE 8: Review &amp; Merge                                          \u2502\n\u2502  - Create pull request                                            \u2502\n\u2502  - Code review                                                    \u2502\n\u2502  - Merge to main                                                  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502\n           \u25bc\n        DONE\n</code></pre>"},{"location":"architecture/orchestration-flow/#async-escalation-handling","title":"Async Escalation Handling","text":"<p>When Baron is blocked on human escalation:</p> <ol> <li>Baron saves state to <code>.baron-state.json</code></li> <li>Baron continues with non-blocked sections</li> <li>Escalation posted to GitHub issue</li> <li>Human responds (async, could be hours/days)</li> <li>Next Baron invocation checks escalation status</li> <li>Baron resumes with human response incorporated</li> </ol> <pre><code># Baron checks escalation status on resume\nresponse = check_escalation(escalation_id)\nif response.status == \"resolved\":\n    # Continue with response\n    answer = response.final_answer\nelse:\n    # Still pending, continue other work\n    continue_non_blocked_sections()\n</code></pre>"},{"location":"architecture/orchestration-flow/#constitution-compliance","title":"Constitution Compliance","text":"<p>Baron enforces constitution principles throughout:</p> Principle Enforcement I. TDD Tasks workflow orders tests before implementation VI. YAGNI Plan workflow avoids unnecessary complexity XI. User Journeys Plan workflow maps user stories to journey IDs <p>The constitution is loaded at the start of each workflow from <code>.specify/memory/constitution.md</code>.</p>"},{"location":"architecture/orchestration-flow/#error-handling","title":"Error Handling","text":""},{"location":"architecture/orchestration-flow/#baron-errors","title":"Baron Errors","text":"Error Cause Recovery <code>DispatchError</code> Claude CLI failed Retry with backoff <code>ParseError</code> Missing result markers Check agent output <code>TimeoutError</code> Agent took too long Increase timeout"},{"location":"architecture/orchestration-flow/#agent-hub-errors","title":"Agent Hub Errors","text":"Error Cause Recovery <code>RoutingError</code> Unknown topic Check topic mapping <code>SessionNotFound</code> Session expired Create new session <code>EscalationTimeout</code> Human didn't respond Re-escalate or skip"},{"location":"architecture/orchestration-flow/#monitoring-observability","title":"Monitoring &amp; Observability","text":""},{"location":"architecture/orchestration-flow/#structured-logging","title":"Structured Logging","text":"<p>All components log in JSON format:</p> <pre><code>{\n  \"timestamp\": \"2026-01-05T10:00:00Z\",\n  \"level\": \"info\",\n  \"component\": \"baron\",\n  \"workflow\": \"specify\",\n  \"feature_id\": \"008-oauth2-auth\",\n  \"message\": \"Consulting expert @duc for architecture\",\n  \"duration_ms\": 1500\n}\n</code></pre>"},{"location":"architecture/orchestration-flow/#journey-markers","title":"Journey Markers","text":"<p>Integration tests use journey markers for traceability:</p> <pre><code>@pytest.mark.journey(\"BRN-001\")\ndef test_baron_creates_spec():\n    ...\n</code></pre>"},{"location":"architecture/orchestration-flow/#related-documentation","title":"Related Documentation","text":"<ul> <li>Baron Agent README</li> <li>Agent Hub Architecture</li> <li>System Overview</li> <li>Module Interactions</li> <li>User Journeys</li> <li>Constitution</li> </ul>"},{"location":"architecture/services/","title":"Services Architecture","text":"<p>Farmer Code uses a microservices architecture with three main services and multiple agent services.</p>"},{"location":"architecture/services/#service-topology","title":"Service Topology","text":"<pre><code>graph TB\n    subgraph \"Core Services\"\n        ORC[Orchestrator&lt;br/&gt;:8001]\n        HUB[Agent Hub&lt;br/&gt;:8000]\n    end\n\n    subgraph \"Agent Services\"\n        BARON[Baron PM&lt;br/&gt;:8010]\n        DUC[Duc Architecture&lt;br/&gt;:8011]\n        MARIE[Marie Testing&lt;br/&gt;:8012]\n    end\n\n    ORC --&gt; HUB\n    HUB --&gt; BARON\n    HUB --&gt; DUC\n    HUB --&gt; MARIE</code></pre>"},{"location":"architecture/services/#port-assignments","title":"Port Assignments","text":"Service Port Purpose Agent Hub 8000 Central coordination, routing, sessions Orchestrator 8001 Workflow state machine Baron 8010 PM agent (specify, plan, tasks) Duc 8011 Architecture expert Marie 8012 Testing expert"},{"location":"architecture/services/#communication-patterns","title":"Communication Patterns","text":""},{"location":"architecture/services/#orchestrator-agent-hub","title":"Orchestrator \u2192 Agent Hub","text":"<p>The Orchestrator delegates all agent communication through Agent Hub:</p> <pre><code>POST /invoke/{agent_name}\nPOST /ask/{topic}\n</code></pre>"},{"location":"architecture/services/#agent-hub-agents","title":"Agent Hub \u2192 Agents","text":"<p>Agent Hub routes requests to the appropriate agent service:</p> <pre><code>POST /invoke  (to agent service)\nGET /health   (health checks)\n</code></pre>"},{"location":"architecture/services/#service-responsibilities","title":"Service Responsibilities","text":""},{"location":"architecture/services/#orchestrator","title":"Orchestrator","text":"<ul> <li>Workflow state machine (specify \u2192 plan \u2192 tasks \u2192 implement)</li> <li>Feature ID generation</li> <li>Phase transitions and gates</li> </ul>"},{"location":"architecture/services/#agent-hub","title":"Agent Hub","text":"<ul> <li>Request routing to agents</li> <li>Session management (multi-turn conversations)</li> <li>Confidence validation and escalation</li> <li>Audit logging</li> </ul>"},{"location":"architecture/services/#agent-services","title":"Agent Services","text":"<ul> <li>Stateless request processing</li> <li>Claude SDK integration</li> <li>Domain-specific expertise</li> </ul>"},{"location":"architecture/system-overview/","title":"System Overview","text":"<p>Farmer Code is an AI-orchestrated software development lifecycle (SDLC) automation system. It coordinates AI agents to perform development tasks while maintaining human oversight through approval gates.</p>"},{"location":"architecture/system-overview/#purpose","title":"Purpose","text":"<p>Farmer Code automates the mundane aspects of software development while ensuring quality through:</p> <ul> <li>Structured Workflow: 8-phase SDLC with clear deliverables</li> <li>AI Assistance: Specialist agents for different domains</li> <li>Human Gates: Approval checkpoints for critical decisions</li> <li>Quality Validation: Confidence-based answer verification</li> </ul>"},{"location":"architecture/system-overview/#high-level-architecture","title":"High-Level Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                              User Interface                              \u2502\n\u2502                        (Future: TUI, Web, CLI)                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                    \u2502\n                                    \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                          Orchestrator Service                            \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502                      State Machine                               \u2502   \u2502\n\u2502  \u2502  IDLE \u2192 PHASE_1 \u2192 PHASE_2 \u2192 GATE_1 \u2192 DONE                       \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502 Phase Executor  \u2502  \u2502  Label Sync     \u2502  \u2502  Signal Poller     \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n           \u2502                    \u2502                      \u2502\n           \u25bc                    \u25bc                      \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 GitHub           \u2502  \u2502 Worktree         \u2502  \u2502 Agent Hub                \u2502\n\u2502 Integration      \u2502  \u2502 Manager          \u2502  \u2502                          \u2502\n\u2502                  \u2502  \u2502                  \u2502  \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502 - Issues         \u2502  \u2502 - Create/Delete  \u2502  \u2502 \u2502 Question Routing     \u2502 \u2502\n\u2502 - Comments       \u2502  \u2502 - Branch Mgmt    \u2502  \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502 - Labels         \u2502  \u2502 - Plans Setup    \u2502  \u2502 \u2502 Session Management   \u2502 \u2502\n\u2502 - PRs            \u2502  \u2502 - Git Operations \u2502  \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502 \u2502 Answer Validation    \u2502 \u2502\n         \u2502                    \u2502              \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n         \u25bc                    \u25bc              \u2502 \u2502 Human Escalation     \u2502 \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502 GitHub API       \u2502  \u2502 Git Repository   \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518             \u2502\n                                                       \u25bc\n                                            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                                            \u2502 Claude CLI Agents    \u2502\n                                            \u2502 (@duc, @gustave...)  \u2502\n                                            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/system-overview/#core-modules","title":"Core Modules","text":""},{"location":"architecture/system-overview/#1-github-integration-srcgithub_integration","title":"1. GitHub Integration (<code>src/github_integration/</code>)","text":"<p>Handles all GitHub API interactions:</p> <ul> <li>Issues: Create, update, close feature issues</li> <li>Comments: Post agent feedback and status updates</li> <li>Labels: Manage workflow state labels</li> <li>Pull Requests: Create and link PRs to issues</li> </ul> <p>Key Classes: <code>GitHubService</code>, <code>IssueService</code>, <code>CommentService</code></p>"},{"location":"architecture/system-overview/#2-worktree-manager-srcworktree_manager","title":"2. Worktree Manager (<code>src/worktree_manager/</code>)","text":"<p>Manages git worktrees for isolated feature development:</p> <ul> <li>Creation: New worktree with branch</li> <li>Plans Setup: Initialize .plans directory structure</li> <li>Git Operations: Commit, push, branch management</li> <li>Cleanup: Remove worktree after feature completion</li> </ul> <p>Key Classes: <code>WorktreeService</code>, <code>GitClient</code></p>"},{"location":"architecture/system-overview/#3-orchestrator-srcorchestrator","title":"3. Orchestrator (<code>src/orchestrator/</code>)","text":"<p>Central workflow coordination:</p> <ul> <li>State Machine: Tracks feature progress through phases</li> <li>Phase Execution: Runs phase 1 and phase 2 operations</li> <li>Agent Dispatch: Spawns AI agents for tasks</li> <li>Signal Polling: Monitors for completion signals</li> </ul> <p>Key Classes: <code>OrchestratorService</code>, <code>StateMachine</code>, <code>PhaseExecutor</code></p>"},{"location":"architecture/system-overview/#4-agent-hub-srcagent_hub","title":"4. Agent Hub (<code>src/agent_hub/</code>)","text":"<p>Central coordination for agent interactions:</p> <ul> <li>Routing: Direct questions to appropriate expert agents</li> <li>Sessions: Maintain conversation context across interactions</li> <li>Validation: Check answer confidence against thresholds</li> <li>Escalation: Package low-confidence for human review</li> <li>Logging: Immutable Q&amp;A audit trail</li> </ul> <p>Key Classes: <code>AgentHub</code>, <code>AgentRouter</code>, <code>SessionManager</code>, <code>ConfidenceValidator</code>, <code>EscalationHandler</code></p>"},{"location":"architecture/system-overview/#data-flow","title":"Data Flow","text":""},{"location":"architecture/system-overview/#feature-creation-flow","title":"Feature Creation Flow","text":"<pre><code>sequenceDiagram\n    participant User\n    participant Orchestrator\n    participant GitHub\n    participant Worktree\n    participant AgentHub\n\n    User-&gt;&gt;Orchestrator: Create Feature Request\n    Orchestrator-&gt;&gt;GitHub: Create Issue\n    GitHub--&gt;&gt;Orchestrator: Issue #123\n    Orchestrator-&gt;&gt;Worktree: Create Worktree\n    Worktree--&gt;&gt;Orchestrator: /worktrees/123-feature\n    Orchestrator-&gt;&gt;Worktree: Initialize .plans\n    Orchestrator-&gt;&gt;GitHub: Add Labels (status:phase-1)\n    Orchestrator-&gt;&gt;AgentHub: Route Architecture Questions\n    AgentHub--&gt;&gt;Orchestrator: Answers</code></pre>"},{"location":"architecture/system-overview/#question-routing-flow","title":"Question Routing Flow","text":"<pre><code>sequenceDiagram\n    participant Orchestrator\n    participant Hub as AgentHub\n    participant Agent as Claude CLI Agent\n    participant Validator\n    participant Human\n\n    Orchestrator-&gt;&gt;Hub: ask_expert(topic, question)\n    Hub-&gt;&gt;Agent: Dispatch via subprocess\n    Agent--&gt;&gt;Hub: Answer (with confidence)\n    Hub-&gt;&gt;Validator: Validate Confidence\n    alt High Confidence (&gt;=80%)\n        Validator--&gt;&gt;Hub: ACCEPTED\n        Hub--&gt;&gt;Orchestrator: Final Answer\n    else Low Confidence (&lt;80%)\n        Validator--&gt;&gt;Hub: ESCALATE\n        Hub-&gt;&gt;Human: Request Review\n        Human--&gt;&gt;Hub: CONFIRM/CORRECT/CONTEXT\n        Hub--&gt;&gt;Orchestrator: Final Answer\n    end</code></pre>"},{"location":"architecture/system-overview/#state-management","title":"State Management","text":""},{"location":"architecture/system-overview/#workflow-states","title":"Workflow States","text":"State Description Transitions To <code>IDLE</code> No active work <code>PHASE_1</code> <code>PHASE_1</code> Issue, branch, worktree creation <code>PHASE_2</code> <code>PHASE_2</code> Agent work in progress <code>GATE_1</code> <code>GATE_1</code> Awaiting human approval <code>DONE</code> <code>DONE</code> Feature complete -"},{"location":"architecture/system-overview/#state-persistence","title":"State Persistence","text":"<p>State is persisted to JSON files:</p> <pre><code>.plans/{issue_number}/state.json\n</code></pre> <p>This enables: - Crash recovery - Multi-session work - State inspection for debugging</p>"},{"location":"architecture/system-overview/#external-dependencies","title":"External Dependencies","text":"Dependency Purpose Required GitHub API Issue/PR management Yes Git Version control Yes Claude CLI AI agent execution Yes File System State/log persistence Yes"},{"location":"architecture/system-overview/#security-considerations","title":"Security Considerations","text":"<ul> <li>Secrets: API keys stored in environment variables</li> <li>Validation: All inputs validated with Pydantic</li> <li>Isolation: Worktrees prevent cross-feature interference</li> <li>Audit: Q&amp;A logging provides traceability</li> </ul>"},{"location":"architecture/system-overview/#performance-characteristics","title":"Performance Characteristics","text":"<ul> <li>State Operations: Synchronous, file-based (~10ms)</li> <li>GitHub Operations: Network-bound (~100-500ms)</li> <li>Agent Dispatch: Variable (5s-120s depending on task)</li> <li>Git Operations: Local (~50-200ms)</li> </ul>"},{"location":"architecture/system-overview/#services-architecture","title":"Services Architecture","text":"<p>Status: Implemented (Feature 008)</p> <p>The system uses a services-based architecture with independent HTTP services:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Orchestrator  \u2502\u2500\u2500\u2500\u2500\u25b6\u2502   Agent Hub     \u2502\u2500\u2500\u2500\u2500\u25b6\u2502  Agent Services \u2502\n\u2502   Service       \u2502     \u2502   Service       \u2502     \u2502 (Baron/Duc/...) \u2502\n\u2502   :8000         \u2502     \u2502   :8001         \u2502     \u2502   :8002-8004    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        \u2502                       \u2502                       \u2502\n        \u25bc                       \u25bc                       \u25bc\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502 SQLite  \u2502            \u2502 SQLite  \u2502            \u2502Claude SDK\u2502\n   \u2502Workflows\u2502            \u2502Sessions \u2502            \u2502  Query   \u2502\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/system-overview/#service-ports","title":"Service Ports","text":"Service Port Description Orchestrator 8000 Workflow state machine Agent Hub 8001 Agent routing, sessions Baron 8002 PM Agent Duc 8003 Architecture Expert Marie 8004 Testing Expert"},{"location":"architecture/system-overview/#architecture-comparison","title":"Architecture Comparison","text":"Aspect Previous (Modules) Current (Services) Communication Direct imports REST APIs State File-based JSON SQLite databases Agent Invocation CLI subprocess Claude Code SDK Deployment Single process Docker Compose Scaling Vertical Horizontal"},{"location":"architecture/system-overview/#services","title":"Services","text":"<ul> <li>Orchestrator Service: Workflow state machine, phase execution</li> <li>Agent Hub Service: Agent routing, sessions, escalation, audit logging</li> <li>Agent Services: Stateless SDK-based agents (Baron, Duc, Marie)</li> </ul> <p>For details, see Services Architecture.</p>"},{"location":"configuration/environment-variables/","title":"Environment Variables","text":"<p>Complete list of environment variables used by Farmer Code.</p>"},{"location":"configuration/environment-variables/#required-variables","title":"Required Variables","text":""},{"location":"configuration/environment-variables/#github-integration","title":"GitHub Integration","text":"Variable Description Example <code>GITHUB_TOKEN</code> GitHub personal access token or app token <code>ghp_xxxx...</code> <code>GITHUB_REPO</code> Target repository in owner/repo format <code>farmer1st/farmer-code</code> <p>Token Permissions Required: - <code>repo</code> - Full control of private repositories - <code>workflow</code> - Update GitHub Action workflows (if using Actions)</p>"},{"location":"configuration/environment-variables/#how-to-create-github-token","title":"How to Create GitHub Token","text":"<ol> <li>Go to GitHub Settings &gt; Developer Settings &gt; Personal Access Tokens</li> <li>Click \"Generate new token (classic)\"</li> <li>Select scopes: <code>repo</code>, <code>workflow</code></li> <li>Copy token to <code>.env</code></li> </ol>"},{"location":"configuration/environment-variables/#optional-variables","title":"Optional Variables","text":""},{"location":"configuration/environment-variables/#claude-ai","title":"Claude AI","text":"Variable Description Default <code>ANTHROPIC_API_KEY</code> Anthropic API key for Claude None <p>Used by: Agent Hub for agent dispatch</p>"},{"location":"configuration/environment-variables/#debugging","title":"Debugging","text":"Variable Description Default <code>DEBUG</code> Enable debug mode <code>false</code> <code>LOG_LEVEL</code> Logging verbosity <code>INFO</code> <p>Log Levels: <code>DEBUG</code>, <code>INFO</code>, <code>WARNING</code>, <code>ERROR</code>, <code>CRITICAL</code></p>"},{"location":"configuration/environment-variables/#variable-reference-by-service","title":"Variable Reference by Service","text":""},{"location":"configuration/environment-variables/#orchestrator-service-port-8000","title":"Orchestrator Service (port 8000)","text":"<pre><code>DATABASE_URL=sqlite:///./data/orchestrator.db\nAGENT_HUB_URL=http://localhost:8001\nPYTHONUNBUFFERED=1\n</code></pre>"},{"location":"configuration/environment-variables/#agent-hub-service-port-8001","title":"Agent Hub Service (port 8001)","text":"<pre><code>DATABASE_URL=sqlite:///./data/agent-hub.db\nBARON_URL=http://localhost:8002\nDUC_URL=http://localhost:8003\nMARIE_URL=http://localhost:8004\nGITHUB_TOKEN=ghp_xxxx\nGITHUB_REPO=farmer1st/farmer-code\nCONFIDENCE_THRESHOLD=70\nPYTHONUNBUFFERED=1\n</code></pre>"},{"location":"configuration/environment-variables/#baron-agent-service-port-8002","title":"Baron Agent Service (port 8002)","text":"<pre><code>ANTHROPIC_API_KEY=sk-ant-xxxx  # Required for LLM calls\nPYTHONUNBUFFERED=1\n</code></pre>"},{"location":"configuration/environment-variables/#duc-agent-service-port-8003","title":"Duc Agent Service (port 8003)","text":"<pre><code>PYTHONUNBUFFERED=1\n</code></pre>"},{"location":"configuration/environment-variables/#marie-agent-service-port-8004","title":"Marie Agent Service (port 8004)","text":"<pre><code>PYTHONUNBUFFERED=1\n</code></pre>"},{"location":"configuration/environment-variables/#variable-reference-by-module-legacy","title":"Variable Reference by Module (Legacy)","text":""},{"location":"configuration/environment-variables/#github_integration","title":"github_integration","text":"<pre><code>GITHUB_TOKEN=ghp_xxxx    # Required\nGITHUB_REPO=owner/repo   # Required\n</code></pre>"},{"location":"configuration/environment-variables/#agent_hub","title":"agent_hub","text":"<pre><code>ANTHROPIC_API_KEY=sk-ant-xxxx  # Optional (for agent dispatch)\n</code></pre>"},{"location":"configuration/environment-variables/#orchestrator","title":"orchestrator","text":"<p>No additional environment variables. Uses GitHub credentials.</p>"},{"location":"configuration/environment-variables/#worktree_manager","title":"worktree_manager","text":"<p>No environment variables. Uses local git configuration.</p>"},{"location":"configuration/environment-variables/#configuration-files","title":"Configuration Files","text":"<p>In addition to environment variables, some modules use configuration files:</p> File Module Purpose <code>config/routing.yaml</code> agent_hub Agent routing rules"},{"location":"configuration/environment-variables/#example-env-file","title":"Example <code>.env</code> File","text":"<pre><code># ===================\n# Required\n# ===================\n\n# GitHub Access\nGITHUB_TOKEN=ghp_your_personal_access_token_here\nGITHUB_REPO=farmer1st/farmer-code\n\n# Claude AI (for Baron agent LLM calls)\nANTHROPIC_API_KEY=sk-ant-your_key_here\n\n# ===================\n# Optional\n# ===================\n\n# Debugging\nDEBUG=false\nLOG_LEVEL=INFO\n\n# ===================\n# Docker Compose Defaults\n# ===================\n# These are set in docker-compose.yml but can be overridden:\n# DATABASE_URL=sqlite:///./data/orchestrator.db\n# AGENT_HUB_URL=http://agent-hub:8001\n# BARON_URL=http://baron:8002\n# DUC_URL=http://duc:8003\n# MARIE_URL=http://marie:8004\n</code></pre>"},{"location":"configuration/environment-variables/#loading-environment-variables","title":"Loading Environment Variables","text":"<p>Farmer Code uses <code>python-dotenv</code> to load <code>.env</code>:</p> <pre><code>from dotenv import load_dotenv\nimport os\n\nload_dotenv()  # Load .env file\n\ntoken = os.getenv(\"GITHUB_TOKEN\")\nrepo = os.getenv(\"GITHUB_REPO\")\n</code></pre>"},{"location":"configuration/environment-variables/#cicd-configuration","title":"CI/CD Configuration","text":"<p>For GitHub Actions, store secrets in repository settings:</p> <ol> <li>Go to Repository &gt; Settings &gt; Secrets and variables &gt; Actions</li> <li>Add secrets:</li> <li><code>GITHUB_TOKEN</code> (or use <code>secrets.GITHUB_TOKEN</code>)</li> <li><code>ANTHROPIC_API_KEY</code></li> </ol> <p>Access in workflow:</p> <pre><code>env:\n  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n  ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}\n</code></pre>"},{"location":"configuration/environment-variables/#troubleshooting","title":"Troubleshooting","text":""},{"location":"configuration/environment-variables/#github_token-not-set","title":"\"GITHUB_TOKEN not set\"","text":"<pre><code>Error: GITHUB_TOKEN environment variable not set\n</code></pre> <p>Fix: Ensure <code>.env</code> exists with valid token:</p> <pre><code>echo $GITHUB_TOKEN  # Should print token\n# If empty, check .env file\n</code></pre>"},{"location":"configuration/environment-variables/#invalid-token","title":"\"Invalid token\"","text":"<pre><code>github.GithubException: 401 Bad credentials\n</code></pre> <p>Fix: Regenerate token and update <code>.env</code></p>"},{"location":"configuration/environment-variables/#repository-not-found","title":"\"Repository not found\"","text":"<pre><code>github.GithubException: 404 Not Found\n</code></pre> <p>Fix: Check <code>GITHUB_REPO</code> format is <code>owner/repo</code>:</p> <pre><code># Correct\nGITHUB_REPO=farmer1st/farmer-code\n\n# Wrong\nGITHUB_REPO=https://github.com/farmer1st/farmer-code\n</code></pre>"},{"location":"getting-started/","title":"Getting Started","text":"<p>This guide will help you set up Farmer Code for development.</p>"},{"location":"getting-started/#contents","title":"Contents","text":"Document Description Quick Start 5-minute setup guide Development Workflow How to contribute"},{"location":"getting-started/#prerequisites","title":"Prerequisites","text":"<p>Before you begin, ensure you have:</p> <ul> <li>Python 3.11+ - Required for backend</li> <li>uv - Python package manager (install)</li> <li>Git - Version control</li> <li>GitHub Account - With repository access</li> <li>Claude CLI - For AI agent operations (optional for testing)</li> </ul>"},{"location":"getting-started/#quick-setup","title":"Quick Setup","text":""},{"location":"getting-started/#1-clone-the-repository","title":"1. Clone the Repository","text":"<pre><code>git clone https://github.com/farmer1st/farmer-code.git\ncd farmer-code\n</code></pre>"},{"location":"getting-started/#2-install-dependencies","title":"2. Install Dependencies","text":"<pre><code># Install Python dependencies with uv\nuv sync\n\n# Verify installation\nuv run python --version\nuv run pytest --version\n</code></pre>"},{"location":"getting-started/#3-configure-environment","title":"3. Configure Environment","text":"<p>Create a <code>.env</code> file from the template:</p> <pre><code>cp .env.example .env\n</code></pre> <p>Edit <code>.env</code> with your credentials:</p> <pre><code># GitHub (required for GitHub integration)\nGITHUB_TOKEN=ghp_your_personal_access_token\nGITHUB_REPO=farmer1st/farmer-code\n\n# Claude (optional - for AI agent tests)\nANTHROPIC_API_KEY=sk-ant-your_key\n</code></pre>"},{"location":"getting-started/#4-run-tests","title":"4. Run Tests","text":"<pre><code># Run all tests\nuv run pytest\n\n# Run with coverage\nuv run pytest --cov=src --cov-report=html\n\n# Run specific module tests\nuv run pytest tests/unit/agent_hub/ -v\n</code></pre>"},{"location":"getting-started/#5-run-linting","title":"5. Run Linting","text":"<pre><code># Check code style\nuv run ruff check .\n\n# Auto-fix issues\nuv run ruff check --fix .\n\n# Type checking\nuv run mypy src/\n</code></pre>"},{"location":"getting-started/#project-structure","title":"Project Structure","text":"<pre><code>farmer-code/\n\u251c\u2500\u2500 src/                      # Source code\n\u2502   \u251c\u2500\u2500 github_integration/   # GitHub API wrapper\n\u2502   \u251c\u2500\u2500 worktree_manager/     # Git worktree management\n\u2502   \u251c\u2500\u2500 orchestrator/         # SDLC workflow state machine\n\u2502   \u2514\u2500\u2500 agent_hub/            # Central agent coordination\n\u251c\u2500\u2500 tests/                    # Test suites\n\u2502   \u251c\u2500\u2500 unit/                 # Unit tests\n\u2502   \u251c\u2500\u2500 integration/          # Integration tests\n\u2502   \u251c\u2500\u2500 contract/             # Contract tests\n\u2502   \u2514\u2500\u2500 e2e/                  # End-to-end tests\n\u251c\u2500\u2500 specs/                    # Feature specifications\n\u2502   \u2514\u2500\u2500 [###-feature-name]/   # Per-feature specs\n\u251c\u2500\u2500 docs/                     # Documentation\n\u251c\u2500\u2500 config/                   # Configuration files\n\u251c\u2500\u2500 .specify/                 # SpecKit templates\n\u2514\u2500\u2500 .plans/                   # Active feature state\n</code></pre>"},{"location":"getting-started/#next-steps","title":"Next Steps","text":"<ol> <li>Read the Constitution: .specify/memory/constitution.md</li> <li>Explore the Architecture: docs/architecture/</li> <li>Understand the Modules: docs/modules/</li> <li>Review User Journeys: docs/user-journeys/</li> </ol>"},{"location":"getting-started/#common-commands","title":"Common Commands","text":"Command Description <code>uv sync</code> Install/update dependencies <code>uv run pytest</code> Run all tests <code>uv run ruff check .</code> Run linter <code>uv run mypy src/</code> Run type checker <code>uv run pytest -m journey</code> Run journey tests only"},{"location":"getting-started/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/#module-not-found-errors","title":"\"Module not found\" errors","text":"<p>Ensure you're using <code>uv run</code>:</p> <pre><code># Wrong\npython -m pytest\n\n# Correct\nuv run pytest\n</code></pre>"},{"location":"getting-started/#github-api-errors","title":"GitHub API errors","text":"<p>Check your <code>.env</code> file has valid credentials:</p> <pre><code># Test GitHub token\ncurl -H \"Authorization: token $GITHUB_TOKEN\" https://api.github.com/user\n</code></pre>"},{"location":"getting-started/#test-failures","title":"Test failures","text":"<p>Some tests require GitHub credentials. Set up <code>.env</code> properly or run unit tests only:</p> <pre><code># Unit tests only (no external dependencies)\nuv run pytest tests/unit/\n</code></pre>"},{"location":"getting-started/#getting-help","title":"Getting Help","text":"<ul> <li>Check docs/ for documentation</li> <li>Review user journeys for workflow understanding</li> <li>Open an issue on GitHub for bugs</li> </ul>"},{"location":"getting-started/development/","title":"Development Workflow","text":"<p>How to contribute to Farmer Code following our development standards.</p>"},{"location":"getting-started/development/#workflow-overview","title":"Workflow Overview","text":"<p>Farmer Code uses a specification-driven, test-first development workflow:</p> <pre><code>1. Create Spec \u2192 2. Plan \u2192 3. Tasks \u2192 4. Implement (TDD) \u2192 5. Review \u2192 6. Merge\n</code></pre>"},{"location":"getting-started/development/#prerequisites","title":"Prerequisites","text":"<p>Before contributing, understand:</p> <ol> <li>Constitution - Development principles</li> <li>Architecture - System design</li> <li>User Journeys - Feature workflows</li> </ol>"},{"location":"getting-started/development/#step-1-create-feature-specification","title":"Step 1: Create Feature Specification","text":"<p>Use SpecKit to create a feature specification:</p> <pre><code># Run the specify command\n/speckit.specify \"Add OAuth2 authentication\"\n</code></pre> <p>This creates: - <code>specs/###-feature-name/spec.md</code> - Feature specification - User stories with priorities (P1, P2, P3) - Acceptance criteria</p>"},{"location":"getting-started/development/#step-2-plan-implementation","title":"Step 2: Plan Implementation","text":"<p>Generate an implementation plan:</p> <pre><code>/speckit.plan\n</code></pre> <p>This creates: - <code>specs/###-feature-name/plan.md</code> - Implementation plan - <code>specs/###-feature-name/data-model.md</code> - Data models - <code>specs/###-feature-name/contracts/</code> - API contracts - <code>specs/###-feature-name/research.md</code> - Research findings</p> <p>Gate 1: Plan requires human approval before proceeding.</p>"},{"location":"getting-started/development/#step-3-generate-tasks","title":"Step 3: Generate Tasks","text":"<p>Create an actionable task list:</p> <pre><code>/speckit.tasks\n</code></pre> <p>This creates: - <code>specs/###-feature-name/tasks.md</code> - Task list organized by user story</p>"},{"location":"getting-started/development/#step-4-implement-with-tdd","title":"Step 4: Implement with TDD","text":"<p>Implement following Test-First Development (NON-NEGOTIABLE):</p>"},{"location":"getting-started/development/#tdd-cycle","title":"TDD Cycle","text":"<ol> <li> <p>Write Test First (Red)    <pre><code>def test_question_routes_to_architect():\n    hub = AgentHub(config)\n    response = hub.ask_expert(topic=\"architecture\", question=\"...\")\n    assert response.status.value == \"resolved\"\n</code></pre></p> </li> <li> <p>Run Test - Should Fail <pre><code>uv run pytest tests/unit/agent_hub/test_hub.py -v\n# FAILED - ask_expert not implemented\n</code></pre></p> </li> <li> <p>Implement Minimal Code (Green)    <pre><code>def ask_expert(self, topic: str, question: str, ...) -&gt; HubResponse:\n    agent = self.config.get_agent_for_topic(topic)\n    return self._dispatch_to_agent(agent, question)\n</code></pre></p> </li> <li> <p>Run Test - Should Pass <pre><code>uv run pytest tests/unit/agent_hub/test_hub.py -v\n# PASSED\n</code></pre></p> </li> <li> <p>Refactor (Clean)</p> </li> <li>Improve code quality</li> <li>Maintain passing tests</li> </ol>"},{"location":"getting-started/development/#commit-after-each-task","title":"Commit After Each Task","text":"<pre><code>git add .\ngit commit -m \"feat(agent-hub): implement question routing\"\n</code></pre> <p>Use conventional commits: - <code>feat:</code> - New feature - <code>fix:</code> - Bug fix - <code>docs:</code> - Documentation - <code>test:</code> - Test changes - <code>refactor:</code> - Code restructuring</p>"},{"location":"getting-started/development/#step-5-update-documentation","title":"Step 5: Update Documentation","text":"<p>After implementing, update docs:</p> <ol> <li>Module README: <code>src/[module]/README.md</code></li> <li>Module Doc: <code>docs/modules/[module-name].md</code></li> <li>User Journeys: <code>docs/user-journeys/[DOMAIN]-[NNN]-*.md</code></li> <li>Journey Index: <code>docs/user-journeys/JOURNEYS.md</code></li> <li>Architecture (if new component): <code>docs/architecture/</code></li> </ol>"},{"location":"getting-started/development/#step-6-create-pull-request","title":"Step 6: Create Pull Request","text":"<pre><code># Push branch\ngit push -u origin 123-feature-name\n\n# Create PR\ngh pr create --title \"feat: Add OAuth2 authentication\" --body \"...\"\n</code></pre> <p>PR requirements: - All tests pass - Linting passes (<code>uv run ruff check .</code>) - Type checking passes (<code>uv run mypy src/</code>) - Documentation updated - E2E tests tagged with journey markers</p> <p>Gate 4: PR requires human approval before merge.</p>"},{"location":"getting-started/development/#quality-checks","title":"Quality Checks","text":"<p>Before submitting PR, verify:</p> <pre><code># Run all quality checks\nuv run ruff check .           # Linting\nuv run mypy src/              # Type checking\nuv run pytest                 # All tests\nuv run pytest -m journey      # Journey tests\n\n# Check coverage\nuv run pytest --cov=src --cov-report=term-missing\n</code></pre>"},{"location":"getting-started/development/#branch-naming","title":"Branch Naming","text":"<p>Follow this pattern:</p> <pre><code>{issue_number}-{feature-name}\n</code></pre> <p>Examples: - <code>123-add-oauth2-auth</code> - <code>456-fix-routing-bug</code> - <code>789-refactor-state-machine</code></p>"},{"location":"getting-started/development/#commit-message-format","title":"Commit Message Format","text":"<pre><code>&lt;type&gt;(&lt;scope&gt;): &lt;description&gt;\n\n[optional body]\n\n[optional footer]\n</code></pre> <p>Examples: <pre><code>feat(agent-hub): implement expert routing\n\n- Add AgentHub class with ask_expert method\n- Add AgentRouter for Claude CLI spawning\n- Add ConfidenceValidator for answer validation\n\nCloses #123\n</code></pre></p>"},{"location":"getting-started/development/#test-organization","title":"Test Organization","text":"<pre><code>tests/\n\u251c\u2500\u2500 unit/                    # Pure unit tests (no external deps)\n\u2502   \u2514\u2500\u2500 [module]/           # Tests per module\n\u251c\u2500\u2500 integration/             # Integration tests (mocked externals)\n\u2502   \u2514\u2500\u2500 [module]/\n\u251c\u2500\u2500 contract/                # Contract/schema tests\n\u2502   \u2514\u2500\u2500 [module]/\n\u2514\u2500\u2500 e2e/                     # End-to-end tests (real externals)\n    \u2514\u2500\u2500 [module]/\n</code></pre>"},{"location":"getting-started/development/#journey-markers","title":"Journey Markers","text":"<p>E2E tests MUST have journey markers:</p> <pre><code>@pytest.mark.e2e\n@pytest.mark.journey(\"AH-001\")\ndef test_route_question_to_architect_e2e():\n    \"\"\"Test AH-001: Route Question to Expert Agent.\"\"\"\n    ...\n</code></pre>"},{"location":"getting-started/development/#common-pitfalls","title":"Common Pitfalls","text":""},{"location":"getting-started/development/#dont-skip-tests","title":"Don't Skip Tests","text":"<pre><code># WRONG - implementing before test\ndef route_question(self, question):\n    return self.config.get_agent(question.topic)\n\n# RIGHT - test first\ndef test_route_question():\n    ...  # Write this first\n</code></pre>"},{"location":"getting-started/development/#dont-over-engineer","title":"Don't Over-Engineer","text":"<pre><code># WRONG - abstract factory for simple case\nclass AgentFactory(ABC):\n    @abstractmethod\n    def create_agent(self): ...\n\n# RIGHT - simple implementation\ndef get_agent(topic: str) -&gt; Agent:\n    return self.agents.get(topic)\n</code></pre>"},{"location":"getting-started/development/#dont-forget-documentation","title":"Don't Forget Documentation","text":"<pre><code># Before PR, check:\ncat src/[module]/README.md         # Module docs exist\ncat docs/modules/[module-name].md  # Extended docs exist\ncat docs/user-journeys/[DOMAIN]-*.md  # Journey docs exist\n</code></pre>"},{"location":"getting-started/development/#getting-help","title":"Getting Help","text":"<ul> <li>Ask questions via GitHub issues</li> <li>Review existing specs in <code>specs/</code></li> <li>Check user journeys for workflow understanding</li> <li>Consult the Constitution for principles</li> </ul>"},{"location":"getting-started/installation/","title":"Installation","text":""},{"location":"getting-started/installation/#prerequisites","title":"Prerequisites","text":"<ul> <li>Python 3.11+</li> <li>uv package manager</li> <li>Git</li> <li>Docker (for running services locally)</li> </ul>"},{"location":"getting-started/installation/#install-uv","title":"Install uv","text":"<pre><code># macOS/Linux\ncurl -LsSf https://astral.sh/uv/install.sh | sh\n\n# Or with Homebrew\nbrew install uv\n</code></pre>"},{"location":"getting-started/installation/#clone-the-repository","title":"Clone the Repository","text":"<pre><code>git clone https://github.com/farmer1st/farmer-code.git\ncd farmer-code\n</code></pre>"},{"location":"getting-started/installation/#install-dependencies","title":"Install Dependencies","text":"<pre><code># Create virtual environment and install\nuv sync\n\n# Install dev dependencies\nuv pip install -e \".[dev]\"\n</code></pre>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":"<pre><code># Run tests\nuv run pytest\n\n# Check linting\nuv run ruff check src/ tests/\n</code></pre>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start - Run your first workflow</li> <li>Development Workflow - Set up your dev environment</li> </ul>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":"<p>Get Farmer Code running in 5 minutes.</p>"},{"location":"getting-started/quickstart/#tldr","title":"TL;DR","text":"<pre><code>git clone https://github.com/farmer1st/farmer-code.git\ncd farmer-code\nuv sync\nuv run pytest tests/unit/  # Unit tests (no credentials needed)\n</code></pre>"},{"location":"getting-started/quickstart/#step-by-step","title":"Step-by-Step","text":""},{"location":"getting-started/quickstart/#1-clone-install","title":"1. Clone &amp; Install","text":"<pre><code>git clone https://github.com/farmer1st/farmer-code.git\ncd farmer-code\nuv sync\n</code></pre>"},{"location":"getting-started/quickstart/#2-verify-installation","title":"2. Verify Installation","text":"<pre><code># Should show Python 3.11+\nuv run python --version\n\n# Should list installed packages\nuv pip list | grep pydantic\n</code></pre>"},{"location":"getting-started/quickstart/#3-run-unit-tests","title":"3. Run Unit Tests","text":"<p>Unit tests don't require external credentials:</p> <pre><code>uv run pytest tests/unit/ -v\n</code></pre> <p>Expected output: <pre><code>tests/unit/agent_hub/test_models.py::TestQuestionModel PASSED\ntests/unit/agent_hub/test_validator.py::TestConfidenceValidator PASSED\n...\n458 passed in 2.5s\n</code></pre></p>"},{"location":"getting-started/quickstart/#4-optional-full-test-suite","title":"4. (Optional) Full Test Suite","text":"<p>For full tests, configure <code>.env</code>:</p> <pre><code>cp .env.example .env\n# Edit .env with your credentials\nuv run pytest\n</code></pre>"},{"location":"getting-started/quickstart/#running-with-docker-compose","title":"Running with Docker Compose","text":"<p>Start all services with a single command:</p> <pre><code># Copy environment template\ncp .env.example .env\n# Edit .env with your ANTHROPIC_API_KEY\n\n# Start all services\ndocker-compose up\n\n# Or for development with hot reload\ndocker-compose -f docker-compose.dev.yml up\n</code></pre> <p>Services will be available at: - Orchestrator: http://localhost:8000 - Agent Hub: http://localhost:8001 - Baron Agent: http://localhost:8002</p> <p>Verify services are running: <pre><code>curl http://localhost:8000/health\ncurl http://localhost:8001/health\ncurl http://localhost:8002/health\n</code></pre></p> <p>For more details, see Local Development Setup.</p>"},{"location":"getting-started/quickstart/#whats-next","title":"What's Next?","text":"Task Guide Understand the codebase Architecture Overview Contribute a feature Development Workflow Run services locally Docker Compose Guide Explore services Services Documentation Run journey tests Testing Guide"},{"location":"getting-started/quickstart/#quick-reference","title":"Quick Reference","text":"<pre><code># Tests\nuv run pytest                    # All tests\nuv run pytest tests/unit/        # Unit only\nuv run pytest -m journey         # Journey tests\n\n# Quality\nuv run ruff check .              # Lint\nuv run mypy src/                 # Types\n\n# Coverage\nuv run pytest --cov=src --cov-report=html\nopen htmlcov/index.html\n</code></pre>"},{"location":"guides/","title":"Guides","text":"<p>Practical guides for working with Farmer Code.</p>"},{"location":"guides/#available-guides","title":"Available Guides","text":""},{"location":"guides/#running-locally","title":"Running Locally","text":"<p>Set up and run all services on your local machine using Docker Compose.</p>"},{"location":"guides/#adding-an-agent","title":"Adding an Agent","text":"<p>Create a new agent service and integrate it with Agent Hub.</p>"},{"location":"guides/#testing","title":"Testing","text":"<p>Write and run tests for Farmer Code components.</p>"},{"location":"guides/#quick-links","title":"Quick Links","text":"<ul> <li>Quick Start - Get started in 5 minutes</li> <li>Services Overview - Understand the architecture</li> <li>API Reference - API documentation</li> </ul>"},{"location":"guides/adding-an-agent/","title":"Adding an Agent","text":"<p>Create a new agent service and integrate it with Agent Hub.</p>"},{"location":"guides/adding-an-agent/#overview","title":"Overview","text":"<p>Agents are stateless services that process requests using Claude SDK. Each agent has:</p> <ul> <li>A domain expertise (e.g., architecture, testing, security)</li> <li>One or more workflow types it supports</li> <li>A health endpoint for discovery</li> </ul>"},{"location":"guides/adding-an-agent/#step-1-create-service-structure","title":"Step 1: Create Service Structure","text":"<pre><code>mkdir -p services/agents/your-agent/{src/{api,core},tests/{unit,integration,contract}}\n</code></pre> <p>Directory structure: <pre><code>services/agents/your-agent/\n\u251c\u2500\u2500 Dockerfile\n\u251c\u2500\u2500 pyproject.toml\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 main.py\n\u2502   \u251c\u2500\u2500 api/\n\u2502   \u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u2502   \u251c\u2500\u2500 health.py\n\u2502   \u2502   \u2514\u2500\u2500 invoke.py\n\u2502   \u2514\u2500\u2500 core/\n\u2502       \u251c\u2500\u2500 __init__.py\n\u2502       \u251c\u2500\u2500 agent.py\n\u2502       \u2514\u2500\u2500 prompts.py\n\u2514\u2500\u2500 tests/\n</code></pre></p>"},{"location":"guides/adding-an-agent/#step-2-implement-the-agent","title":"Step 2: Implement the Agent","text":""},{"location":"guides/adding-an-agent/#mainpy","title":"main.py","text":"<pre><code>from fastapi import FastAPI\nfrom src.api.health import router as health_router\nfrom src.api.invoke import router as invoke_router\n\napp = FastAPI(title=\"Your Agent\")\napp.include_router(health_router)\napp.include_router(invoke_router)\n</code></pre>"},{"location":"guides/adding-an-agent/#apihealthpy","title":"api/health.py","text":"<pre><code>from fastapi import APIRouter\n\nrouter = APIRouter()\n\n@router.get(\"/health\")\nasync def health():\n    return {\n        \"status\": \"healthy\",\n        \"agent_name\": \"your-agent\",\n        \"capabilities\": {\n            \"workflow_types\": [\"your-workflow\"]\n        }\n    }\n</code></pre>"},{"location":"guides/adding-an-agent/#apiinvokepy","title":"api/invoke.py","text":"<pre><code>from fastapi import APIRouter\nfrom pydantic import BaseModel\nfrom src.core.agent import YourAgent\n\nrouter = APIRouter()\n\nclass InvokeRequest(BaseModel):\n    workflow_type: str\n    context: dict\n\n@router.post(\"/invoke\")\nasync def invoke(request: InvokeRequest):\n    agent = YourAgent()\n    result = await agent.process(request.workflow_type, request.context)\n    return result\n</code></pre>"},{"location":"guides/adding-an-agent/#coreagentpy","title":"core/agent.py","text":"<pre><code>import anthropic\n\nclass YourAgent:\n    def __init__(self):\n        self.client = anthropic.Anthropic()\n\n    async def process(self, workflow_type: str, context: dict):\n        response = self.client.messages.create(\n            model=\"claude-sonnet-4-20250514\",\n            max_tokens=4096,\n            messages=[{\"role\": \"user\", \"content\": str(context)}]\n        )\n        return {\n            \"success\": True,\n            \"result\": response.content[0].text,\n            \"confidence\": 85\n        }\n</code></pre>"},{"location":"guides/adding-an-agent/#step-3-add-to-docker-compose","title":"Step 3: Add to Docker Compose","text":"<p>In <code>docker-compose.yml</code>:</p> <pre><code>your-agent:\n  build:\n    context: ./services/agents/your-agent\n  ports:\n    - \"8013:8013\"\n  environment:\n    - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}\n  healthcheck:\n    test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:8013/health\"]\n</code></pre>"},{"location":"guides/adding-an-agent/#step-4-register-with-agent-hub","title":"Step 4: Register with Agent Hub","text":"<p>Add to Agent Hub's agent configuration:</p> <pre><code>AGENTS = {\n    \"your-agent\": {\n        \"url\": \"http://your-agent:8013\",\n        \"capabilities\": [\"your-workflow\"]\n    }\n}\n</code></pre>"},{"location":"guides/adding-an-agent/#step-5-test","title":"Step 5: Test","text":"<pre><code># Unit tests\ncd services/agents/your-agent\nuv run pytest tests/\n\n# Integration test\ncurl -X POST http://localhost:8013/invoke \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"workflow_type\": \"your-workflow\", \"context\": {}}'\n</code></pre>"},{"location":"guides/adding-an-agent/#next-steps","title":"Next Steps","text":"<ul> <li>See Baron for a complete example</li> <li>Read Testing Guide for test patterns</li> </ul>"},{"location":"guides/running-locally/","title":"Running Locally","text":"<p>Run all Farmer Code services on your local machine.</p>"},{"location":"guides/running-locally/#prerequisites","title":"Prerequisites","text":"<ul> <li>Docker and Docker Compose</li> <li><code>.env</code> file with required variables (copy from <code>.env.example</code>)</li> </ul>"},{"location":"guides/running-locally/#quick-start","title":"Quick Start","text":""},{"location":"guides/running-locally/#1-copy-environment-file","title":"1. Copy Environment File","text":"<pre><code>cp .env.example .env\n# Edit .env and add your ANTHROPIC_API_KEY\n</code></pre>"},{"location":"guides/running-locally/#2-start-all-services","title":"2. Start All Services","text":"<pre><code>docker-compose up\n</code></pre> <p>This starts: - Agent Hub on http://localhost:8000 - Orchestrator on http://localhost:8001 - Baron on http://localhost:8010 - Duc on http://localhost:8011 - Marie on http://localhost:8012</p>"},{"location":"guides/running-locally/#3-verify-services","title":"3. Verify Services","text":"<pre><code># Check all health endpoints\ncurl http://localhost:8000/health\ncurl http://localhost:8001/health\ncurl http://localhost:8010/health\n</code></pre>"},{"location":"guides/running-locally/#development-mode","title":"Development Mode","text":"<p>For development with hot-reload:</p> <pre><code>docker-compose -f docker-compose.dev.yml up\n</code></pre> <p>This mounts local source directories so changes are reflected immediately.</p>"},{"location":"guides/running-locally/#running-individual-services","title":"Running Individual Services","text":"<p>To run services outside Docker:</p> <pre><code># Terminal 1: Agent Hub\ncd services/agent-hub\nuv run uvicorn src.main:app --port 8000 --reload\n\n# Terminal 2: Orchestrator\ncd services/orchestrator\nuv run uvicorn src.main:app --port 8001 --reload\n\n# Terminal 3: Baron\ncd services/agents/baron\nuv run uvicorn src.main:app --port 8010 --reload\n</code></pre>"},{"location":"guides/running-locally/#troubleshooting","title":"Troubleshooting","text":""},{"location":"guides/running-locally/#port-already-in-use","title":"Port Already in Use","text":"<pre><code># Find what's using the port\nlsof -i :8000\n\n# Kill the process\nkill -9 &lt;PID&gt;\n</code></pre>"},{"location":"guides/running-locally/#services-cant-connect","title":"Services Can't Connect","text":"<p>Ensure all services are on the same Docker network:</p> <pre><code>docker network ls\ndocker-compose down &amp;&amp; docker-compose up\n</code></pre>"},{"location":"guides/running-locally/#next-steps","title":"Next Steps","text":"<ul> <li>Testing Guide - Run the test suite</li> <li>Adding an Agent - Create a new agent</li> </ul>"},{"location":"guides/testing/","title":"Testing Guide","text":"<p>Write and run tests for Farmer Code components.</p>"},{"location":"guides/testing/#test-categories","title":"Test Categories","text":"Type Location Purpose Unit <code>tests/unit/</code> Isolated component tests Integration <code>tests/integration/</code> Component interaction tests Contract <code>tests/contract/</code> API contract validation E2E <code>tests/e2e/</code> Full system tests"},{"location":"guides/testing/#running-tests","title":"Running Tests","text":""},{"location":"guides/testing/#all-tests","title":"All Tests","text":"<pre><code>uv run pytest\n</code></pre>"},{"location":"guides/testing/#specific-category","title":"Specific Category","text":"<pre><code># Unit tests only\nuv run pytest tests/unit/\n\n# Integration tests\nuv run pytest tests/integration/\n\n# E2E tests (requires services running)\nRUN_E2E_TESTS=1 uv run pytest tests/e2e/\n</code></pre>"},{"location":"guides/testing/#service-specific-tests","title":"Service-Specific Tests","text":"<pre><code># Agent Hub tests\ncd services/agent-hub\nuv run pytest\n\n# Orchestrator tests\ncd services/orchestrator\nuv run pytest\n</code></pre>"},{"location":"guides/testing/#writing-tests","title":"Writing Tests","text":""},{"location":"guides/testing/#unit-test-example","title":"Unit Test Example","text":"<pre><code>import pytest\nfrom your_module import YourClass\n\nclass TestYourClass:\n    def test_basic_operation(self):\n        obj = YourClass()\n        result = obj.do_something(\"input\")\n        assert result == \"expected\"\n\n    def test_error_handling(self):\n        obj = YourClass()\n        with pytest.raises(ValueError):\n            obj.do_something(None)\n</code></pre>"},{"location":"guides/testing/#contract-test-example","title":"Contract Test Example","text":"<pre><code>import pytest\nfrom httpx import AsyncClient\n\n@pytest.mark.contract\nclass TestHealthEndpoint:\n    async def test_health_returns_200(self, client: AsyncClient):\n        response = await client.get(\"/health\")\n        assert response.status_code == 200\n\n    async def test_health_response_format(self, client: AsyncClient):\n        response = await client.get(\"/health\")\n        data = response.json()\n        assert \"status\" in data\n        assert data[\"status\"] == \"healthy\"\n</code></pre>"},{"location":"guides/testing/#integration-test-example","title":"Integration Test Example","text":"<pre><code>import pytest\nfrom unittest.mock import AsyncMock\n\n@pytest.mark.integration\nclass TestAgentIntegration:\n    async def test_agent_invocation(self, mock_claude):\n        mock_claude.return_value = \"Test response\"\n\n        result = await invoke_agent(\"specify\", {\"description\": \"test\"})\n\n        assert result[\"success\"] is True\n        assert \"result\" in result\n</code></pre>"},{"location":"guides/testing/#test-markers","title":"Test Markers","text":"<p>Use pytest markers to categorize tests:</p> <pre><code>@pytest.mark.unit\ndef test_unit_example():\n    pass\n\n@pytest.mark.integration\ndef test_integration_example():\n    pass\n\n@pytest.mark.contract\ndef test_contract_example():\n    pass\n\n@pytest.mark.e2e\ndef test_e2e_example():\n    pass\n\n@pytest.mark.journey(\"SVC-001\")\ndef test_user_journey():\n    pass\n</code></pre>"},{"location":"guides/testing/#fixtures","title":"Fixtures","text":"<p>Common fixtures in <code>conftest.py</code>:</p> <pre><code>import pytest\nfrom httpx import AsyncClient\n\n@pytest.fixture\nasync def client():\n    async with AsyncClient(base_url=\"http://localhost:8000\") as c:\n        yield c\n\n@pytest.fixture\ndef mock_claude(mocker):\n    return mocker.patch(\"anthropic.Anthropic\")\n</code></pre>"},{"location":"guides/testing/#coverage","title":"Coverage","text":"<pre><code># Run with coverage\nuv run pytest --cov=src/ --cov-report=html\n\n# View report\nopen htmlcov/index.html\n</code></pre>"},{"location":"guides/testing/#ci-integration","title":"CI Integration","text":"<p>Tests run automatically on PR via GitHub Actions. See <code>.github/workflows/ci.yml</code>.</p>"},{"location":"modules/github-integration/","title":"GitHub Integration Module","text":"<p>Wrapper around the GitHub API for issue, comment, label, and PR management.</p>"},{"location":"modules/github-integration/#overview","title":"Overview","text":"<p>The <code>github_integration</code> module provides a clean interface for GitHub operations:</p> <ul> <li>Issues: Create, update, close, query issues</li> <li>Comments: Add comments to issues and PRs</li> <li>Labels: Manage issue labels for workflow state</li> <li>Pull Requests: Create and link PRs to issues</li> </ul>"},{"location":"modules/github-integration/#quick-start","title":"Quick Start","text":"<pre><code>from github_integration import GitHubService\n\n# Initialize from environment\nservice = GitHubService.from_env()\n\n# Create an issue\nissue = service.issues.create(\n    title=\"Feature: Add authentication\",\n    body=\"Implement OAuth2 authentication flow.\",\n    labels=[\"enhancement\", \"status:new\"]\n)\n\nprint(f\"Created issue #{issue.number}\")\n\n# Add a comment\nservice.issues.add_comment(\n    issue_number=issue.number,\n    body=\"Starting architecture review.\"\n)\n\n# Update labels\nservice.issues.update_labels(\n    issue_number=issue.number,\n    labels=[\"status:phase-1\"]\n)\n</code></pre>"},{"location":"modules/github-integration/#source-documentation","title":"Source Documentation","text":"<p>For API reference and detailed usage, see: - <code>src/github_integration/README.md</code></p>"},{"location":"modules/github-integration/#architecture","title":"Architecture","text":"<pre><code>graph TB\n    subgraph \"github_integration\"\n        GS[GitHubService]\n        IS[IssueService]\n        CS[CommentService]\n        LS[LabelService]\n    end\n\n    GS --&gt; IS\n    GS --&gt; CS\n    GS --&gt; LS\n\n    IS --&gt; GH[GitHub API]\n    CS --&gt; GH\n    LS --&gt; GH</code></pre>"},{"location":"modules/github-integration/#configuration","title":"Configuration","text":""},{"location":"modules/github-integration/#environment-variables","title":"Environment Variables","text":"Variable Description Required <code>GITHUB_TOKEN</code> Personal access token or GitHub App token Yes <code>GITHUB_REPO</code> Repository in <code>owner/repo</code> format Yes"},{"location":"modules/github-integration/#token-permissions","title":"Token Permissions","text":"<p>Required GitHub token permissions: - <code>repo</code> - Full control of repositories - <code>workflow</code> - Workflow management (if using GitHub Actions)</p>"},{"location":"modules/github-integration/#integration-points","title":"Integration Points","text":""},{"location":"modules/github-integration/#used-by","title":"Used By","text":"<ul> <li>Orchestrator: Issue creation, label sync, comment posting</li> <li>Agent Hub: Escalation comment posting (optional)</li> </ul>"},{"location":"modules/github-integration/#dependencies","title":"Dependencies","text":"<ul> <li><code>PyGithub</code> - GitHub API client</li> <li><code>python-dotenv</code> - Environment loading</li> </ul>"},{"location":"modules/github-integration/#error-handling","title":"Error Handling","text":"<pre><code>from github_integration import GitHubAPIError, IssueNotFoundError\n\ntry:\n    issue = service.issues.get(999999)\nexcept IssueNotFoundError:\n    print(\"Issue does not exist\")\nexcept GitHubAPIError as e:\n    print(f\"GitHub API error: {e}\")\n</code></pre>"},{"location":"modules/github-integration/#user-journeys","title":"User Journeys","text":"Journey Description ORC-001 Create Issue for New Feature ORC-002 Agent Provides Feedback"},{"location":"modules/github-integration/#related-documentation","title":"Related Documentation","text":"<ul> <li>Specification</li> <li>Contracts</li> <li>API Documentation</li> </ul>"},{"location":"modules/worktree-manager/","title":"Worktree Manager Module","text":"<p>Git worktree management for isolated feature development.</p>"},{"location":"modules/worktree-manager/#overview","title":"Overview","text":"<p>The <code>worktree_manager</code> module provides:</p> <ul> <li>Worktree Creation: Create isolated worktrees with branches</li> <li>Plans Initialization: Set up .plans directory structure</li> <li>Git Operations: Commit, push, branch management</li> <li>Cleanup: Remove worktrees after feature completion</li> </ul>"},{"location":"modules/worktree-manager/#quick-start","title":"Quick Start","text":"<pre><code>from pathlib import Path\nfrom worktree_manager import WorktreeService, CreateWorktreeRequest\n\n# Initialize service\nservice = WorktreeService(Path(\"/path/to/repo\"))\n\n# Create a worktree for a feature\nresult = service.create_worktree(\n    CreateWorktreeRequest(\n        branch_name=\"123-add-auth\",\n        worktree_path=Path(\"/worktrees/123-add-auth\")\n    )\n)\n\nif result.success:\n    print(f\"Created worktree at {result.worktree_path}\")\n\n# Initialize plans directory\nservice.init_plans(result.worktree_path)\n\n# Commit and push changes\nservice.commit_and_push(\n    CommitRequest(\n        worktree_path=result.worktree_path,\n        message=\"feat: add authentication\",\n        push=True\n    )\n)\n\n# Cleanup when done\nservice.delete_worktree(result.worktree_path)\n</code></pre>"},{"location":"modules/worktree-manager/#source-documentation","title":"Source Documentation","text":"<p>For API reference and detailed usage, see: - <code>src/worktree_manager/README.md</code></p>"},{"location":"modules/worktree-manager/#architecture","title":"Architecture","text":"<pre><code>graph TB\n    subgraph \"worktree_manager\"\n        WS[WorktreeService]\n        GC[GitClient]\n        PH[PlansHandler]\n    end\n\n    WS --&gt; GC\n    WS --&gt; PH\n\n    GC --&gt; GIT[Git CLI]\n    PH --&gt; FS[File System]</code></pre>"},{"location":"modules/worktree-manager/#worktree-structure","title":"Worktree Structure","text":"<p>When a worktree is created:</p> <pre><code>/worktrees/123-add-auth/\n\u251c\u2500\u2500 .git/                    # Git worktree link\n\u251c\u2500\u2500 src/                     # Source code\n\u251c\u2500\u2500 tests/                   # Tests\n\u2514\u2500\u2500 .plans/                  # Initialized by init_plans()\n    \u251c\u2500\u2500 spec.md\n    \u251c\u2500\u2500 plan.md\n    \u2514\u2500\u2500 tasks.md\n</code></pre>"},{"location":"modules/worktree-manager/#configuration","title":"Configuration","text":"<p>No configuration required. The service uses the local git configuration.</p>"},{"location":"modules/worktree-manager/#integration-points","title":"Integration Points","text":""},{"location":"modules/worktree-manager/#used-by","title":"Used By","text":"<ul> <li>Orchestrator: Creates worktrees for Phase 1, manages commits</li> </ul>"},{"location":"modules/worktree-manager/#dependencies","title":"Dependencies","text":"<ul> <li><code>subprocess</code> - Git command execution</li> <li><code>pathlib</code> - Path handling</li> </ul>"},{"location":"modules/worktree-manager/#error-handling","title":"Error Handling","text":"<pre><code>from worktree_manager import (\n    BranchExistsError,\n    WorktreeExistsError,\n    GitCommandError\n)\n\ntry:\n    result = service.create_worktree(request)\nexcept BranchExistsError:\n    print(\"Branch already exists\")\nexcept WorktreeExistsError:\n    print(\"Worktree path already in use\")\nexcept GitCommandError as e:\n    print(f\"Git command failed: {e}\")\n</code></pre>"},{"location":"modules/worktree-manager/#user-journeys","title":"User Journeys","text":"Journey Description WT-001 Create Worktree for Feature WT-002 Initialize Plans Folder WT-003 Commit and Push Changes WT-004 Cleanup Worktree"},{"location":"modules/worktree-manager/#related-documentation","title":"Related Documentation","text":"<ul> <li>Specification</li> <li>Contracts</li> </ul>"},{"location":"reference/","title":"Reference","text":"<p>Technical reference documentation for Farmer Code.</p>"},{"location":"reference/#contents","title":"Contents","text":""},{"location":"reference/#configuration","title":"Configuration","text":"<p>System configuration options and settings files.</p>"},{"location":"reference/#environment-variables","title":"Environment Variables","text":"<p>All environment variables used by Farmer Code services.</p>"},{"location":"reference/#api-contracts","title":"API Contracts","text":"<p>OpenAPI specifications for all service APIs.</p>"},{"location":"reference/#quick-links","title":"Quick Links","text":"<ul> <li>Services Overview</li> <li>Architecture</li> <li>User Journeys</li> </ul>"},{"location":"reference/api-contracts/","title":"API Contracts","text":"<p>OpenAPI specifications for Farmer Code services.</p>"},{"location":"reference/api-contracts/#contract-files","title":"Contract Files","text":"<p>Full OpenAPI specs are in <code>specs/008-services-architecture/contracts/</code>:</p> <ul> <li>orchestrator.yaml</li> <li>agent-hub.yaml</li> <li>agent-service.yaml</li> </ul>"},{"location":"reference/api-contracts/#orchestrator-api","title":"Orchestrator API","text":""},{"location":"reference/api-contracts/#create-workflow","title":"Create Workflow","text":"<pre><code>POST /workflows\n</code></pre> <p>Request: <pre><code>{\n  \"workflow_type\": \"specify\",\n  \"feature_description\": \"Add user authentication\"\n}\n</code></pre></p> <p>Response: <pre><code>{\n  \"id\": \"uuid\",\n  \"feature_id\": \"009-user-authentication\",\n  \"workflow_type\": \"specify\",\n  \"status\": \"pending\",\n  \"created_at\": \"2024-01-01T00:00:00Z\"\n}\n</code></pre></p>"},{"location":"reference/api-contracts/#get-workflow","title":"Get Workflow","text":"<pre><code>GET /workflows/{id}\n</code></pre>"},{"location":"reference/api-contracts/#advance-workflow","title":"Advance Workflow","text":"<pre><code>POST /workflows/{id}/advance\n</code></pre>"},{"location":"reference/api-contracts/#agent-hub-api","title":"Agent Hub API","text":""},{"location":"reference/api-contracts/#ask-expert","title":"Ask Expert","text":"<pre><code>POST /ask/{topic}\n</code></pre> <p>Request: <pre><code>{\n  \"question\": \"What auth method should we use?\",\n  \"context\": \"Building a web app\",\n  \"feature_id\": \"009-auth\"\n}\n</code></pre></p> <p>Response: <pre><code>{\n  \"answer\": \"...\",\n  \"confidence\": 85,\n  \"status\": \"resolved\",\n  \"session_id\": \"uuid\"\n}\n</code></pre></p>"},{"location":"reference/api-contracts/#invoke-agent","title":"Invoke Agent","text":"<pre><code>POST /invoke/{agent_name}\n</code></pre> <p>Request: <pre><code>{\n  \"workflow_type\": \"specify\",\n  \"context\": {\n    \"feature_description\": \"...\"\n  }\n}\n</code></pre></p>"},{"location":"reference/api-contracts/#sessions","title":"Sessions","text":"<pre><code>POST /sessions           # Create session\nGET /sessions/{id}       # Get session\nDELETE /sessions/{id}    # Close session\n</code></pre>"},{"location":"reference/api-contracts/#escalations","title":"Escalations","text":"<pre><code>GET /escalations/{id}           # Get escalation\nPOST /escalations/{id}          # Respond to escalation\n</code></pre>"},{"location":"reference/api-contracts/#agent-service-api","title":"Agent Service API","text":"<p>All agents implement this interface.</p>"},{"location":"reference/api-contracts/#health","title":"Health","text":"<pre><code>GET /health\n</code></pre> <p>Response: <pre><code>{\n  \"status\": \"healthy\",\n  \"agent_name\": \"baron\",\n  \"capabilities\": {\n    \"workflow_types\": [\"specify\", \"plan\", \"tasks\", \"implement\"]\n  }\n}\n</code></pre></p>"},{"location":"reference/api-contracts/#invoke","title":"Invoke","text":"<pre><code>POST /invoke\n</code></pre> <p>Request: <pre><code>{\n  \"workflow_type\": \"specify\",\n  \"context\": {}\n}\n</code></pre></p> <p>Response: <pre><code>{\n  \"success\": true,\n  \"result\": \"...\",\n  \"confidence\": 85,\n  \"metadata\": {\n    \"duration_ms\": 1500\n  }\n}\n</code></pre></p>"},{"location":"reference/configuration/","title":"Configuration","text":"<p>Configuration options for Farmer Code services.</p>"},{"location":"reference/configuration/#configuration-files","title":"Configuration Files","text":"File Purpose <code>.env</code> Environment variables (local) <code>.env.example</code> Template for <code>.env</code> <code>docker-compose.yml</code> Service definitions <code>mkdocs.yml</code> Documentation config <code>pyproject.toml</code> Python project config"},{"location":"reference/configuration/#service-configuration","title":"Service Configuration","text":""},{"location":"reference/configuration/#orchestrator","title":"Orchestrator","text":"<pre><code># In docker-compose.yml\norchestrator:\n  environment:\n    - ORCHESTRATOR_PORT=8001\n    - AGENT_HUB_URL=http://agent-hub:8000\n    - DATABASE_URL=sqlite:///./data/orchestrator.db\n</code></pre>"},{"location":"reference/configuration/#agent-hub","title":"Agent Hub","text":"<pre><code>agent-hub:\n  environment:\n    - AGENT_HUB_PORT=8000\n    - CONFIDENCE_THRESHOLD=80\n    - DATABASE_URL=sqlite:///./data/agent_hub.db\n    - AUDIT_LOG_PATH=/app/logs/audit.jsonl\n</code></pre>"},{"location":"reference/configuration/#agents","title":"Agents","text":"<pre><code>baron:\n  environment:\n    - BARON_PORT=8010\n    - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}\n    - BARON_MODEL=claude-sonnet-4-20250514\n</code></pre>"},{"location":"reference/configuration/#database-configuration","title":"Database Configuration","text":"<p>SQLite is used for local development:</p> <pre><code>DATABASE_URL=sqlite:///./data/service.db\n</code></pre> <p>For production, use PostgreSQL:</p> <pre><code>DATABASE_URL=postgresql://user:pass@host:5432/dbname\n</code></pre>"},{"location":"reference/configuration/#logging-configuration","title":"Logging Configuration","text":"<p>Audit logs are written to JSONL files:</p> <pre><code>AUDIT_LOG_PATH=/app/logs/audit.jsonl\nLOG_LEVEL=INFO\n</code></pre>"},{"location":"reference/configuration/#see-also","title":"See Also","text":"<ul> <li>Environment Variables - Complete list</li> <li>Running Locally - Setup guide</li> </ul>"},{"location":"reference/environment/","title":"Environment Variables","text":"<p>All environment variables used by Farmer Code services.</p>"},{"location":"reference/environment/#required-variables","title":"Required Variables","text":"Variable Service Description <code>ANTHROPIC_API_KEY</code> All agents Claude API key"},{"location":"reference/environment/#service-ports","title":"Service Ports","text":"Variable Default Description <code>AGENT_HUB_PORT</code> 8000 Agent Hub service port <code>ORCHESTRATOR_PORT</code> 8001 Orchestrator service port <code>BARON_PORT</code> 8010 Baron agent port <code>DUC_PORT</code> 8011 Duc agent port <code>MARIE_PORT</code> 8012 Marie agent port"},{"location":"reference/environment/#service-urls","title":"Service URLs","text":"Variable Default Description <code>AGENT_HUB_URL</code> http://agent-hub:8000 Agent Hub URL (for Orchestrator) <code>ORCHESTRATOR_URL</code> http://orchestrator:8001 Orchestrator URL <code>BARON_URL</code> http://baron:8010 Baron agent URL <code>DUC_URL</code> http://duc:8011 Duc agent URL <code>MARIE_URL</code> http://marie:8012 Marie agent URL"},{"location":"reference/environment/#database","title":"Database","text":"Variable Default Description <code>DATABASE_URL</code> sqlite:///./data/app.db Database connection string"},{"location":"reference/environment/#agent-hub","title":"Agent Hub","text":"Variable Default Description <code>CONFIDENCE_THRESHOLD</code> 80 Min confidence for auto-accept <code>AUDIT_LOG_PATH</code> ./logs/audit.jsonl Audit log file path <code>SESSION_TIMEOUT_MINUTES</code> 60 Session expiry time"},{"location":"reference/environment/#agents","title":"Agents","text":"Variable Default Description <code>BARON_MODEL</code> claude-sonnet-4-20250514 Claude model for Baron <code>DUC_MODEL</code> claude-sonnet-4-20250514 Claude model for Duc <code>MARIE_MODEL</code> claude-sonnet-4-20250514 Claude model for Marie"},{"location":"reference/environment/#github-integration","title":"GitHub Integration","text":"Variable Default Description <code>GITHUB_TOKEN</code> - GitHub personal access token <code>GITHUB_APP_ID</code> - GitHub App ID (if using App) <code>GITHUB_PRIVATE_KEY</code> - GitHub App private key"},{"location":"reference/environment/#logging","title":"Logging","text":"Variable Default Description <code>LOG_LEVEL</code> INFO Logging level <code>LOG_FORMAT</code> json Log format (json/text)"},{"location":"reference/environment/#example-env-file","title":"Example .env File","text":"<pre><code># Required\nANTHROPIC_API_KEY=sk-ant-...\n\n# Optional - GitHub\nGITHUB_TOKEN=ghp_...\n\n# Optional - Override ports\n# AGENT_HUB_PORT=8000\n# ORCHESTRATOR_PORT=8001\n\n# Optional - Override models\n# BARON_MODEL=claude-opus-4-20250514\n</code></pre>"},{"location":"services/","title":"Services Architecture","text":"<p>Status: Implemented (Feature 008)</p> <p>This directory contains documentation for the Farmer Code services architecture.</p>"},{"location":"services/#overview","title":"Overview","text":"<p>The services architecture refactors Farmer Code from a module-based Python architecture to independent services communicating via REST APIs.</p>"},{"location":"services/#services","title":"Services","text":"Service Port Description Orchestrator 8000 Workflow state machine and phase execution Agent Hub 8001 Agent routing, session management, escalation Baron 8002 SpecKit workflow agent (specify, plan, tasks, implement) Duc 8003 Architecture and design expert Marie 8004 Testing and QA expert"},{"location":"services/#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Orchestrator  \u2502\u2500\u2500\u2500\u2500\u25b6\u2502   Agent Hub     \u2502\u2500\u2500\u2500\u2500\u25b6\u2502  Agent Services \u2502\n\u2502   (workflows)   \u2502     \u2502  (routing)      \u2502     \u2502 (Baron/Duc/...)\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n        \u2502                       \u2502                       \u2502\n        \u25bc                       \u25bc                       \u25bc\n   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n   \u2502 SQLite  \u2502            \u2502 SQLite  \u2502            \u2502Claude SDK\u2502\n   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"services/#quick-start","title":"Quick Start","text":"<pre><code># Start all services\ndocker-compose up -d\n\n# Verify health\ncurl http://localhost:8000/health  # Orchestrator\ncurl http://localhost:8001/health  # Agent Hub\ncurl http://localhost:8002/health  # Baron\ncurl http://localhost:8003/health  # Duc\ncurl http://localhost:8004/health  # Marie\n</code></pre>"},{"location":"services/#related-documentation","title":"Related Documentation","text":"<ul> <li>System Overview</li> <li>Services Communication</li> <li>Environment Variables</li> <li>Docker Compose Guide</li> </ul>"},{"location":"services/#user-journeys","title":"User Journeys","text":"Journey Description SVC-001 Orchestrator Workflow Execution SVC-002 Expert Agent Consultation SVC-003 Human Review Escalation SVC-004 Multi-Turn Session SVC-005 Stateless Agent Invocation SVC-006 Local Development Setup SVC-007 Audit Log Query"},{"location":"services/agent-hub/","title":"Agent Hub Service","text":"<p>The Agent Hub Service is the central coordination layer for all agent interactions.</p>"},{"location":"services/agent-hub/#overview","title":"Overview","text":"<p>The Agent Hub is the single entry point for all agent invocations. It:</p> <ul> <li>Routes requests to appropriate agents based on topic</li> <li>Validates response confidence against thresholds</li> <li>Manages multi-turn conversation sessions</li> <li>Handles human escalation for low-confidence answers</li> <li>Logs all exchanges for audit</li> </ul> <p>Key Principle: All agent invocations MUST go through Agent Hub. Direct agent calls are prohibited.</p>"},{"location":"services/agent-hub/#quick-start","title":"Quick Start","text":""},{"location":"services/agent-hub/#running-locally","title":"Running Locally","text":"<pre><code>cd services/agent-hub\n\n# Install dependencies\nuv sync\n\n# Run the service\nuv run uvicorn src.main:app --host 0.0.0.0 --port 8000 --reload\n</code></pre>"},{"location":"services/agent-hub/#running-with-docker","title":"Running with Docker","text":"<pre><code># Build image\ndocker build -t agent-hub:latest .\n\n# Run container\ndocker run -p 8000:8000 agent-hub:latest\n</code></pre>"},{"location":"services/agent-hub/#api-documentation","title":"API Documentation","text":"<p>Once running, visit: - OpenAPI docs: http://localhost:8000/docs - ReDoc: http://localhost:8000/redoc</p>"},{"location":"services/agent-hub/#api-reference","title":"API Reference","text":""},{"location":"services/agent-hub/#direct-agent-invocation","title":"Direct Agent Invocation","text":"<pre><code>curl -X POST http://localhost:8000/invoke/baron \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"workflow_type\": \"specify\",\n    \"context\": {\"feature_description\": \"User auth system\"},\n    \"parameters\": {\"priority\": \"P1\"}\n  }'\n</code></pre>"},{"location":"services/agent-hub/#ask-expert-by-topic","title":"Ask Expert by Topic","text":"<pre><code>curl -X POST http://localhost:8000/ask/architecture \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"question\": \"What authentication method should I use?\",\n    \"context\": \"Building a multi-tenant SaaS\",\n    \"feature_id\": \"008-auth\"\n  }'\n</code></pre>"},{"location":"services/agent-hub/#session-management","title":"Session Management","text":"<pre><code># Create session\ncurl -X POST http://localhost:8000/sessions \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"agent_id\": \"@baron\", \"feature_id\": \"008-auth\"}'\n\n# Get session with messages\ncurl http://localhost:8000/sessions/{session_id}\n\n# Close session\ncurl -X DELETE http://localhost:8000/sessions/{session_id}\n</code></pre>"},{"location":"services/agent-hub/#health-check","title":"Health Check","text":"<pre><code>curl http://localhost:8000/health\n</code></pre>"},{"location":"services/agent-hub/#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Agent Hub Service              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  API Layer (FastAPI)                        \u2502\n\u2502  \u251c\u2500\u2500 /invoke/{agent}                        \u2502\n\u2502  \u251c\u2500\u2500 /ask/{topic}                           \u2502\n\u2502  \u251c\u2500\u2500 /sessions, /sessions/{id}              \u2502\n\u2502  \u251c\u2500\u2500 /escalations/{id}                      \u2502\n\u2502  \u2514\u2500\u2500 /health                                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Core Layer                                 \u2502\n\u2502  \u251c\u2500\u2500 AgentRouter (topic \u2192 agent mapping)    \u2502\n\u2502  \u251c\u2500\u2500 ConfidenceValidator                    \u2502\n\u2502  \u251c\u2500\u2500 SessionManager                         \u2502\n\u2502  \u2514\u2500\u2500 EscalationManager                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Client Layer                               \u2502\n\u2502  \u251c\u2500\u2500 AgentServiceClient                     \u2502\n\u2502  \u2514\u2500\u2500 GitHubClient (escalation comments)     \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Database Layer (SQLite)                    \u2502\n\u2502  \u251c\u2500\u2500 sessions table                         \u2502\n\u2502  \u251c\u2500\u2500 messages table                         \u2502\n\u2502  \u2514\u2500\u2500 escalations table                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Agent Services \u2502\n\u2502  (Baron, etc.)  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"services/agent-hub/#topic-routing","title":"Topic Routing","text":"Topic Agent Confidence Threshold architecture baron 85% security charles 90% testing marie 80% frontend dali 85% devops gustave 85%"},{"location":"services/agent-hub/#session-management_1","title":"Session Management","text":"<p>Sessions enable multi-turn conversations with context preservation.</p>"},{"location":"services/agent-hub/#session-lifecycle","title":"Session Lifecycle","text":"<ol> <li>Create: <code>POST /sessions</code> - creates active session</li> <li>Exchange: <code>POST /ask/{topic}</code> with <code>session_id</code> - adds messages</li> <li>Get: <code>GET /sessions/{id}</code> - retrieves session with history</li> <li>Close: <code>DELETE /sessions/{id}</code> - closes session (preserves history)</li> </ol>"},{"location":"services/agent-hub/#session-states","title":"Session States","text":"State Description active Session available for exchanges closed Manually closed, history preserved expired Inactive for &gt; 1 hour"},{"location":"services/agent-hub/#context-preservation","title":"Context Preservation","text":"<p>When <code>session_id</code> is provided: 1. Previous messages retrieved from database 2. Conversation history included in agent context 3. New question and answer stored as messages</p> <pre><code># Agent receives context like:\n{\n    \"question\": \"Should I use JWT?\",\n    \"conversation_history\": [\n        {\"role\": \"user\", \"content\": \"Building OAuth2 auth...\"},\n        {\"role\": \"assistant\", \"content\": \"For OAuth2, consider...\"}\n    ]\n}\n</code></pre>"},{"location":"services/agent-hub/#confidence-validation","title":"Confidence Validation","text":"<p>Responses below threshold trigger escalation:</p> <pre><code>if confidence &lt; threshold:\n    # Create escalation record\n    # Post to GitHub issue comment\n    return {\"status\": \"pending_human\", \"escalation_id\": \"...\"}\n</code></pre>"},{"location":"services/agent-hub/#human-escalation","title":"Human Escalation","text":"<p>When an agent response has low confidence, an escalation is created for human review.</p>"},{"location":"services/agent-hub/#escalation-endpoints","title":"Escalation Endpoints","text":"<pre><code># Get escalation details\ncurl http://localhost:8000/escalations/{escalation_id}\n\n# Submit human response\ncurl -X POST http://localhost:8000/escalations/{escalation_id} \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"action\": \"confirm\",\n    \"responder\": \"@jane\"\n  }'\n</code></pre>"},{"location":"services/agent-hub/#human-actions","title":"Human Actions","text":"Action Description Response Required confirm Accept the tentative answer No correct Provide the correct answer Yes add_context Add information for re-evaluation Yes"},{"location":"services/agent-hub/#escalation-states","title":"Escalation States","text":"State Description pending Awaiting human review resolved Human has responded expired Expired without response"},{"location":"services/agent-hub/#github-integration","title":"GitHub Integration","text":"<p>When configured with <code>GITHUB_TOKEN</code>, escalations are posted as GitHub comments:</p> <pre><code>## Human Review Required\n\n**Confidence:** 60%\n\n### Question\nShould we use microservices or monolith?\n\n### Tentative Answer\nBased on your context, I recommend...\n\n### How to Respond\n- `/confirm` - Accept the answer\n- `/correct &lt;answer&gt;` - Provide correct answer\n- `/context &lt;info&gt;` - Add more context\n</code></pre>"},{"location":"services/agent-hub/#audit-logging","title":"Audit Logging","text":"<p>All agent invocations are automatically logged to JSONL format for audit purposes.</p>"},{"location":"services/agent-hub/#log-location","title":"Log Location","text":"<p>Default: <code>./logs/audit.jsonl</code> (configurable via <code>AUDIT_LOG_PATH</code>)</p>"},{"location":"services/agent-hub/#log-entry-format","title":"Log Entry Format","text":"<p>Each line is a complete JSON object:</p> <pre><code>{\n  \"id\": \"f5e6d7c8-...\",\n  \"timestamp\": \"2025-01-03T12:34:56.789Z\",\n  \"session_id\": \"a1b2c3d4-...\" or null,\n  \"feature_id\": \"008-data-layer\",\n  \"topic\": \"architecture\",\n  \"question\": \"What pattern should I use?\",\n  \"answer\": \"Use the repository pattern.\",\n  \"confidence\": 88,\n  \"status\": \"resolved\",\n  \"escalation_id\": null,\n  \"duration_ms\": 245,\n  \"metadata\": {\"agent\": \"baron\"}\n}\n</code></pre>"},{"location":"services/agent-hub/#log-fields","title":"Log Fields","text":"Field Type Description <code>id</code> UUID Unique entry identifier <code>timestamp</code> ISO 8601 UTC timestamp <code>session_id</code> UUID/null Session ID for multi-turn <code>feature_id</code> string Feature being worked on <code>topic</code> string Topic of the question <code>question</code> string The question asked <code>answer</code> string The answer provided <code>confidence</code> int (0-100) Confidence level <code>status</code> string \"resolved\" or \"escalated\" <code>escalation_id</code> UUID/null Escalation ID if escalated <code>duration_ms</code> int Response time in ms <code>metadata</code> object Additional context"},{"location":"services/agent-hub/#querying-logs","title":"Querying Logs","text":"<pre><code># Filter by feature_id\ncat logs/audit.jsonl | jq 'select(.feature_id == \"008-auth\")'\n\n# Count by feature\ncat logs/audit.jsonl | jq -s 'group_by(.feature_id) | map({feature: .[0].feature_id, count: length})'\n\n# Find escalations\ncat logs/audit.jsonl | jq 'select(.status == \"escalated\")'\n\n# Average response time\ncat logs/audit.jsonl | jq -s 'map(.duration_ms) | add / length'\n</code></pre>"},{"location":"services/agent-hub/#success-criteria","title":"Success Criteria","text":"<ul> <li>SC-007.1: 100% of invocations are logged</li> <li>SC-007.2: Logs are queryable by feature ID</li> <li>SC-007.3: Log format matches data-model.md AuditLog schema</li> </ul>"},{"location":"services/agent-hub/#database-schema","title":"Database Schema","text":"<pre><code>CREATE TABLE sessions (\n    id TEXT PRIMARY KEY,\n    agent_id TEXT NOT NULL,\n    feature_id TEXT,\n    status TEXT NOT NULL DEFAULT 'active',\n    created_at TEXT NOT NULL,\n    updated_at TEXT NOT NULL,\n    expires_at TEXT\n);\n\nCREATE TABLE messages (\n    id TEXT PRIMARY KEY,\n    session_id TEXT NOT NULL REFERENCES sessions(id),\n    role TEXT NOT NULL,\n    content TEXT NOT NULL,\n    message_metadata TEXT,  -- JSON\n    created_at TEXT NOT NULL\n);\n\nCREATE TABLE escalations (\n    id TEXT PRIMARY KEY,\n    session_id TEXT REFERENCES sessions(id),\n    question_id TEXT NOT NULL,\n    topic TEXT NOT NULL,\n    question TEXT NOT NULL,\n    tentative_answer TEXT NOT NULL,\n    confidence INTEGER NOT NULL,\n    uncertainty_reasons TEXT,  -- JSON array\n    status TEXT NOT NULL DEFAULT 'pending',\n    human_action TEXT,\n    human_response TEXT,\n    human_responder TEXT,\n    github_comment_id INTEGER,\n    created_at TEXT NOT NULL,\n    resolved_at TEXT,\n    updated_at TEXT NOT NULL\n);\n</code></pre>"},{"location":"services/agent-hub/#configuration","title":"Configuration","text":"Variable Default Description DATABASE_URL sqlite:///./data/agent-hub.db Database connection DEFAULT_CONFIDENCE_THRESHOLD 85 Default confidence threshold SESSION_EXPIRY_HOURS 1 Session expiry time BARON_URL http://localhost:8002 Baron service URL GITHUB_TOKEN - GitHub API token for escalation comments GITHUB_REPO farmer1st/farmer-code Repository for escalation comments AUDIT_LOG_PATH ./logs/audit.jsonl Path to audit log file"},{"location":"services/agent-hub/#testing","title":"Testing","text":"<pre><code>cd services/agent-hub\n\n# Run all tests\nuv run pytest\n\n# Run contract tests only\nuv run pytest tests/contract/ -m contract\n\n# Run integration tests only\nuv run pytest tests/integration/ -m integration\n\n# Run with coverage\nuv run pytest --cov=src --cov-report=html\n</code></pre>"},{"location":"services/agent-hub/#project-structure","title":"Project Structure","text":"<pre><code>services/agent-hub/\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 __init__.py           # Package metadata\n\u2502   \u251c\u2500\u2500 main.py               # FastAPI application\n\u2502   \u251c\u2500\u2500 api/\n\u2502   \u2502   \u251c\u2500\u2500 health.py         # Health endpoint\n\u2502   \u2502   \u251c\u2500\u2500 invoke.py         # /invoke/{agent} endpoint\n\u2502   \u2502   \u251c\u2500\u2500 ask.py            # /ask/{topic} endpoint\n\u2502   \u2502   \u251c\u2500\u2500 sessions.py       # /sessions endpoints\n\u2502   \u2502   \u2514\u2500\u2500 escalations.py    # /escalations endpoints\n\u2502   \u251c\u2500\u2500 core/\n\u2502   \u2502   \u251c\u2500\u2500 router.py         # Topic \u2192 agent routing\n\u2502   \u2502   \u251c\u2500\u2500 validator.py      # Confidence validation\n\u2502   \u2502   \u251c\u2500\u2500 session_manager.py # Session lifecycle\n\u2502   \u2502   \u2514\u2500\u2500 escalation.py     # Escalation management\n\u2502   \u251c\u2500\u2500 clients/\n\u2502   \u2502   \u251c\u2500\u2500 agents.py         # Agent service client\n\u2502   \u2502   \u2514\u2500\u2500 github.py         # GitHub API client\n\u2502   \u251c\u2500\u2500 logging/\n\u2502   \u2502   \u2514\u2500\u2500 audit.py          # JSONL audit logger\n\u2502   \u2514\u2500\u2500 db/\n\u2502       \u251c\u2500\u2500 models.py         # SQLAlchemy models\n\u2502       \u2514\u2500\u2500 session.py        # Database session\n\u251c\u2500\u2500 tests/\n\u2502   \u251c\u2500\u2500 conftest.py\n\u2502   \u251c\u2500\u2500 contract/             # API contract tests\n\u2502   \u2514\u2500\u2500 integration/          # Integration tests\n\u2514\u2500\u2500 pyproject.toml\n</code></pre>"},{"location":"services/agent-hub/#related-documentation","title":"Related Documentation","text":"<ul> <li>User Journey: SVC-002 Agent Consultation</li> <li>User Journey: SVC-003 Human Escalation</li> <li>User Journey: SVC-004 Multi-Turn Session</li> <li>User Journey: SVC-007 Audit Log Query</li> <li>API Contract</li> <li>Orchestrator Service</li> </ul>"},{"location":"services/orchestrator/","title":"Orchestrator Service","text":"<p>The Orchestrator Service manages SpecKit workflow execution, owning workflow definitions and state transitions.</p>"},{"location":"services/orchestrator/#overview","title":"Overview","text":"<p>The Orchestrator is the entry point for executing SpecKit workflows. It:</p> <ul> <li>Accepts workflow requests (specify, plan, tasks, implement)</li> <li>Manages workflow state machine transitions</li> <li>Invokes agents exclusively via Agent Hub (never directly)</li> <li>Persists workflow state in SQLite</li> <li>Records state transition history for audit</li> </ul>"},{"location":"services/orchestrator/#quick-start","title":"Quick Start","text":""},{"location":"services/orchestrator/#running-locally","title":"Running Locally","text":"<pre><code>cd services/orchestrator\n\n# Install dependencies\nuv sync\n\n# Run the service\nuv run uvicorn src.main:app --host 0.0.0.0 --port 8001 --reload\n</code></pre>"},{"location":"services/orchestrator/#running-with-docker","title":"Running with Docker","text":"<pre><code># Build image\ndocker build -t orchestrator:latest .\n\n# Run container\ndocker run -p 8001:8001 orchestrator:latest\n</code></pre>"},{"location":"services/orchestrator/#api-documentation","title":"API Documentation","text":"<p>Once running, visit: - OpenAPI docs: http://localhost:8001/docs - ReDoc: http://localhost:8001/redoc</p>"},{"location":"services/orchestrator/#api-reference","title":"API Reference","text":""},{"location":"services/orchestrator/#create-workflow","title":"Create Workflow","text":"<pre><code>curl -X POST http://localhost:8001/workflows \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"workflow_type\": \"specify\",\n    \"feature_description\": \"Add user authentication with OAuth2\",\n    \"context\": {\"priority\": \"P1\"}\n  }'\n</code></pre>"},{"location":"services/orchestrator/#get-workflow","title":"Get Workflow","text":"<pre><code>curl http://localhost:8001/workflows/{workflow_id}\n</code></pre>"},{"location":"services/orchestrator/#advance-workflow","title":"Advance Workflow","text":"<pre><code>curl -X POST http://localhost:8001/workflows/{workflow_id}/advance \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"trigger\": \"human_approved\",\n    \"phase_result\": {\"approved\": true}\n  }'\n</code></pre>"},{"location":"services/orchestrator/#health-check","title":"Health Check","text":"<pre><code>curl http://localhost:8001/health\n</code></pre>"},{"location":"services/orchestrator/#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Orchestrator Service            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  API Layer (FastAPI)                        \u2502\n\u2502  \u251c\u2500\u2500 /workflows                             \u2502\n\u2502  \u251c\u2500\u2500 /workflows/{id}                        \u2502\n\u2502  \u251c\u2500\u2500 /workflows/{id}/advance                \u2502\n\u2502  \u2514\u2500\u2500 /health                                \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Core Layer                                 \u2502\n\u2502  \u251c\u2500\u2500 WorkflowStateMachine                   \u2502\n\u2502  \u2514\u2500\u2500 PhaseExecutor                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Client Layer                               \u2502\n\u2502  \u2514\u2500\u2500 AgentHubClient                         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  Database Layer (SQLite)                    \u2502\n\u2502  \u251c\u2500\u2500 workflows table                        \u2502\n\u2502  \u2514\u2500\u2500 workflow_history table                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Agent Hub     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"services/orchestrator/#workflow-types","title":"Workflow Types","text":"Type Description Phases specify Generate feature specification 2 plan Create implementation plan 2 tasks Generate task breakdown 2 implement Execute implementation 2"},{"location":"services/orchestrator/#state-machine","title":"State Machine","text":""},{"location":"services/orchestrator/#states","title":"States","text":"State Description pending Workflow created, not started in_progress Agent is executing current phase waiting_approval Phase complete, awaiting human review completed All phases complete failed Error occurred"},{"location":"services/orchestrator/#transitions","title":"Transitions","text":"From Trigger To pending start in_progress in_progress agent_complete waiting_approval in_progress error failed waiting_approval human_approved in_progress (next phase) or completed waiting_approval human_rejected in_progress (rework) or failed"},{"location":"services/orchestrator/#database-schema","title":"Database Schema","text":"<pre><code>CREATE TABLE workflows (\n    id TEXT PRIMARY KEY,\n    workflow_type TEXT NOT NULL,\n    status TEXT NOT NULL DEFAULT 'pending',\n    feature_id TEXT NOT NULL,\n    feature_description TEXT NOT NULL,\n    current_phase TEXT,\n    context TEXT,  -- JSON\n    result TEXT,   -- JSON\n    error TEXT,\n    created_at TEXT NOT NULL,\n    updated_at TEXT NOT NULL,\n    completed_at TEXT\n);\n\nCREATE TABLE workflow_history (\n    id TEXT PRIMARY KEY,\n    workflow_id TEXT NOT NULL REFERENCES workflows(id),\n    from_status TEXT NOT NULL,\n    to_status TEXT NOT NULL,\n    trigger TEXT NOT NULL,\n    metadata TEXT,  -- JSON\n    created_at TEXT NOT NULL\n);\n</code></pre>"},{"location":"services/orchestrator/#configuration","title":"Configuration","text":"Variable Default Description DATABASE_URL sqlite:///./data/orchestrator.db Database connection AGENT_HUB_URL http://localhost:8000 Agent Hub service URL"},{"location":"services/orchestrator/#testing","title":"Testing","text":"<pre><code>cd services/orchestrator\n\n# Run all tests\nuv run pytest\n\n# Run contract tests only\nuv run pytest tests/contract/ -m contract\n\n# Run integration tests only\nuv run pytest tests/integration/ -m integration\n\n# Run with coverage\nuv run pytest --cov=src --cov-report=html\n</code></pre>"},{"location":"services/orchestrator/#project-structure","title":"Project Structure","text":"<pre><code>services/orchestrator/\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 __init__.py           # Package metadata\n\u2502   \u251c\u2500\u2500 main.py               # FastAPI application\n\u2502   \u251c\u2500\u2500 api/\n\u2502   \u2502   \u251c\u2500\u2500 health.py         # Health endpoint\n\u2502   \u2502   \u2514\u2500\u2500 workflows.py      # Workflow endpoints\n\u2502   \u251c\u2500\u2500 core/\n\u2502   \u2502   \u251c\u2500\u2500 state_machine.py  # Workflow state management\n\u2502   \u2502   \u2514\u2500\u2500 phase_executor.py # Phase execution logic\n\u2502   \u251c\u2500\u2500 clients/\n\u2502   \u2502   \u2514\u2500\u2500 agent_hub.py      # Agent Hub client\n\u2502   \u2514\u2500\u2500 db/\n\u2502       \u251c\u2500\u2500 models.py         # SQLAlchemy models\n\u2502       \u2514\u2500\u2500 session.py        # Database session\n\u251c\u2500\u2500 tests/\n\u2502   \u251c\u2500\u2500 conftest.py\n\u2502   \u251c\u2500\u2500 contract/             # API contract tests\n\u2502   \u251c\u2500\u2500 integration/          # Integration tests\n\u2502   \u2514\u2500\u2500 unit/                 # Unit tests\n\u251c\u2500\u2500 Dockerfile\n\u2514\u2500\u2500 pyproject.toml\n</code></pre>"},{"location":"services/orchestrator/#related-documentation","title":"Related Documentation","text":"<ul> <li>User Journey: SVC-001</li> <li>API Contract</li> <li>Agent Hub Service</li> </ul>"},{"location":"services/agents/","title":"Agent Services","text":"<p>Status: In Development (Feature 008)</p> <p>This directory contains documentation for individual agent services.</p>"},{"location":"services/agents/#overview","title":"Overview","text":"<p>Agent services are stateless HTTP services that use the Claude Code SDK to process requests. Each agent has specialized capabilities and system prompts for its domain.</p>"},{"location":"services/agents/#available-agents","title":"Available Agents","text":"Agent Port Domain Workflow Types Baron 8010 SpecKit PM specify, plan, tasks, implement Duc 8011 Architecture architecture, design, api Marie 8012 Testing/QA test, qa, edge_cases"},{"location":"services/agents/#common-api","title":"Common API","text":"<p>All agent services implement the Agent Service API:</p>"},{"location":"services/agents/#endpoints","title":"Endpoints","text":"Endpoint Method Description <code>/invoke</code> POST Process a request <code>/health</code> GET Health check with capabilities"},{"location":"services/agents/#request-format","title":"Request Format","text":"<pre><code>{\n  \"workflow_type\": \"specify\",\n  \"context\": {\n    \"feature_description\": \"Add user authentication\"\n  },\n  \"parameters\": {\n    \"priority\": \"P1\"\n  }\n}\n</code></pre>"},{"location":"services/agents/#response-format","title":"Response Format","text":"<pre><code>{\n  \"success\": true,\n  \"result\": {\n    \"output\": \"...\",\n    \"files_created\": [\"specs/001-auth/spec.md\"]\n  },\n  \"confidence\": 92,\n  \"metadata\": {\n    \"duration_ms\": 15234,\n    \"model_used\": \"claude-3-5-sonnet-20241022\"\n  }\n}\n</code></pre>"},{"location":"services/agents/#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     Agent Service                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502  FastAPI    \u2502\u2500\u2500\u2500\u25b6\u2502   Core      \u2502\u2500\u2500\u2500\u25b6\u2502 Claude SDK  \u2502     \u2502\n\u2502  \u2502  Endpoints  \u2502    \u2502   Agent     \u2502    \u2502   Query     \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2502         \u2502                  \u2502                   \u2502            \u2502\n\u2502         \u25bc                  \u25bc                   \u25bc            \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502\n\u2502  \u2502   Pydantic  \u2502    \u2502   System    \u2502    \u2502    Tools    \u2502     \u2502\n\u2502  \u2502   Models    \u2502    \u2502   Prompts   \u2502    \u2502   &amp; Skills  \u2502     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"services/agents/#stateless-design","title":"Stateless Design","text":"<p>Agent services are stateless by design:</p> <ul> <li>All context passed in request: No server-side session storage</li> <li>Horizontally scalable: Multiple instances can run in parallel</li> <li>Restartable: No state lost on service restart</li> <li>Testable: Each request is independent</li> </ul>"},{"location":"services/agents/#adding-a-new-agent","title":"Adding a New Agent","text":"<ol> <li>Create directory: <code>services/agents/{agent_name}/</code></li> <li>Copy structure from <code>baron/</code></li> <li>Customize <code>core/prompts.py</code> for agent domain</li> <li>Update <code>docker-compose.yml</code> to include new service</li> <li>Update Agent Hub routing configuration</li> </ol>"},{"location":"services/agents/#related-documentation","title":"Related Documentation","text":"<ul> <li>Services Overview</li> <li>Agent Hub - Routes requests to agents</li> <li>Orchestrator - Invokes agents via Agent Hub</li> </ul>"},{"location":"services/agents/baron/","title":"Baron (PM Agent)","text":"<p>Baron is the Product Management agent responsible for SpecKit workflows.</p>"},{"location":"services/agents/baron/#overview","title":"Overview","text":"Property Value Port 8010 Role Product Manager Workflows specify, plan, tasks, implement"},{"location":"services/agents/baron/#capabilities","title":"Capabilities","text":"<p>Baron handles the core SpecKit workflows:</p> <ul> <li>Specify: Generate feature specifications from descriptions</li> <li>Plan: Create implementation plans from specifications</li> <li>Tasks: Generate task lists from plans</li> <li>Implement: Execute implementation tasks</li> </ul>"},{"location":"services/agents/baron/#api","title":"API","text":""},{"location":"services/agents/baron/#health-check","title":"Health Check","text":"<pre><code>GET /health\n</code></pre> <p>Response: <pre><code>{\n  \"status\": \"healthy\",\n  \"agent_name\": \"baron\",\n  \"capabilities\": {\n    \"workflow_types\": [\"specify\", \"plan\", \"tasks\", \"implement\"]\n  }\n}\n</code></pre></p>"},{"location":"services/agents/baron/#invoke","title":"Invoke","text":"<pre><code>POST /invoke\n</code></pre> <p>Request: <pre><code>{\n  \"workflow_type\": \"specify\",\n  \"context\": {\n    \"feature_description\": \"Add user authentication with OAuth2\"\n  }\n}\n</code></pre></p> <p>Response: <pre><code>{\n  \"success\": true,\n  \"result\": \"# Feature Specification\\n...\",\n  \"confidence\": 85,\n  \"metadata\": {\n    \"duration_ms\": 2500,\n    \"model\": \"claude-sonnet-4-20250514\"\n  }\n}\n</code></pre></p>"},{"location":"services/agents/baron/#configuration","title":"Configuration","text":"<p>Environment variables:</p> Variable Description Default <code>ANTHROPIC_API_KEY</code> Claude API key Required <code>BARON_PORT</code> Service port 8010 <code>BARON_MODEL</code> Claude model to use claude-sonnet-4-20250514"},{"location":"services/agents/baron/#source","title":"Source","text":"<ul> <li>Location: <code>services/agents/baron/</code></li> <li>README: services/agents/baron/README.md</li> </ul>"},{"location":"services/agents/duc/","title":"Duc Agent Service","text":"<p>Duc is the Architecture Expert agent for Farmer Code. It provides guidance on system architecture, API design, and technical decisions.</p>"},{"location":"services/agents/duc/#overview","title":"Overview","text":"<p>Duc specializes in: - System architecture design and patterns - API design and REST/GraphQL decisions - Technology stack recommendations - Scalability and performance guidance - Design trade-off analysis</p>"},{"location":"services/agents/duc/#quick-start","title":"Quick Start","text":""},{"location":"services/agents/duc/#running-locally","title":"Running Locally","text":"<pre><code>cd services/agents/duc\n\n# Install dependencies\nuv sync\n\n# Run the service\nuv run uvicorn src.main:app --host 0.0.0.0 --port 8003 --reload\n</code></pre>"},{"location":"services/agents/duc/#running-with-docker","title":"Running with Docker","text":"<pre><code># Build image\ndocker build -t duc:latest .\n\n# Run container\ndocker run -p 8003:8003 duc:latest\n</code></pre>"},{"location":"services/agents/duc/#api-documentation","title":"API Documentation","text":"<p>Once running, visit: - OpenAPI docs: http://localhost:8003/docs - ReDoc: http://localhost:8003/redoc</p>"},{"location":"services/agents/duc/#api-reference","title":"API Reference","text":""},{"location":"services/agents/duc/#invoke-agent","title":"Invoke Agent","text":"<pre><code>curl -X POST http://localhost:8003/invoke \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"topic\": \"architecture\",\n    \"context\": {\n      \"question\": \"Should we use microservices or monolith?\"\n    }\n  }'\n</code></pre> <p>Response: <pre><code>{\n  \"success\": true,\n  \"result\": {\n    \"output\": \"# Architecture Guidance\\n\\n...\",\n    \"answer\": \"Based on your requirements...\"\n  },\n  \"confidence\": 85,\n  \"metadata\": {\n    \"duration_ms\": 150,\n    \"agent_name\": \"duc\",\n    \"topic\": \"architecture\"\n  }\n}\n</code></pre></p>"},{"location":"services/agents/duc/#supported-topics","title":"Supported Topics","text":"Topic Description <code>architecture</code> General architecture questions <code>api_design</code> API design and contracts <code>system_design</code> Distributed systems, scaling"},{"location":"services/agents/duc/#health-check","title":"Health Check","text":"<pre><code>curl http://localhost:8003/health\n</code></pre> <p>Response: <pre><code>{\n  \"status\": \"healthy\",\n  \"version\": \"0.1.0\",\n  \"agent_name\": \"duc\",\n  \"uptime_seconds\": 3600,\n  \"capabilities\": {\n    \"topics\": [\"architecture\", \"api_design\", \"system_design\"],\n    \"specialization\": \"architecture\"\n  }\n}\n</code></pre></p>"},{"location":"services/agents/duc/#configuration","title":"Configuration","text":"Variable Default Description PORT 8003 Service port PYTHONUNBUFFERED 1 Enable unbuffered output"},{"location":"services/agents/duc/#response-format","title":"Response Format","text":"<p>Duc provides structured architecture guidance:</p> <ol> <li>Analysis: Assessment of the current situation</li> <li>Recommendation: Suggested approach</li> <li>Rationale: Why this is the best choice</li> <li>Trade-offs: Pros and cons</li> <li>Next Steps: Concrete actions</li> </ol>"},{"location":"services/agents/duc/#testing","title":"Testing","text":"<pre><code>cd services/agents/duc\n\n# Run all tests\nuv run pytest\n\n# Run contract tests only\nuv run pytest tests/contract/ -v\n\n# Run with coverage\nuv run pytest --cov=src --cov-report=html\n</code></pre>"},{"location":"services/agents/duc/#project-structure","title":"Project Structure","text":"<pre><code>services/agents/duc/\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 main.py\n\u2502   \u251c\u2500\u2500 api/\n\u2502   \u2502   \u251c\u2500\u2500 health.py\n\u2502   \u2502   \u2514\u2500\u2500 invoke.py\n\u2502   \u2514\u2500\u2500 core/\n\u2502       \u251c\u2500\u2500 agent.py\n\u2502       \u2514\u2500\u2500 prompts.py\n\u251c\u2500\u2500 tests/\n\u2502   \u251c\u2500\u2500 conftest.py\n\u2502   \u251c\u2500\u2500 contract/\n\u2502   \u2502   \u251c\u2500\u2500 test_health.py\n\u2502   \u2502   \u2514\u2500\u2500 test_invoke.py\n\u2502   \u2514\u2500\u2500 integration/\n\u251c\u2500\u2500 Dockerfile\n\u2514\u2500\u2500 pyproject.toml\n</code></pre>"},{"location":"services/agents/duc/#related-documentation","title":"Related Documentation","text":"<ul> <li>Agent Hub Service</li> <li>Baron Agent</li> <li>Marie Agent</li> </ul>"},{"location":"services/agents/marie/","title":"Marie Agent Service","text":"<p>Marie is the Testing Expert agent for Farmer Code. It provides guidance on test strategy, edge case identification, and QA best practices.</p>"},{"location":"services/agents/marie/#overview","title":"Overview","text":"<p>Marie specializes in: - Test strategy and planning - Test case generation - Edge case identification - TDD guidance - QA review and assessment</p>"},{"location":"services/agents/marie/#quick-start","title":"Quick Start","text":""},{"location":"services/agents/marie/#running-locally","title":"Running Locally","text":"<pre><code>cd services/agents/marie\n\n# Install dependencies\nuv sync\n\n# Run the service\nuv run uvicorn src.main:app --host 0.0.0.0 --port 8004 --reload\n</code></pre>"},{"location":"services/agents/marie/#running-with-docker","title":"Running with Docker","text":"<pre><code># Build image\ndocker build -t marie:latest .\n\n# Run container\ndocker run -p 8004:8004 marie:latest\n</code></pre>"},{"location":"services/agents/marie/#api-documentation","title":"API Documentation","text":"<p>Once running, visit: - OpenAPI docs: http://localhost:8004/docs - ReDoc: http://localhost:8004/redoc</p>"},{"location":"services/agents/marie/#api-reference","title":"API Reference","text":""},{"location":"services/agents/marie/#invoke-agent","title":"Invoke Agent","text":"<pre><code>curl -X POST http://localhost:8004/invoke \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"topic\": \"testing\",\n    \"context\": {\n      \"question\": \"How should I test this API endpoint?\"\n    }\n  }'\n</code></pre> <p>Response: <pre><code>{\n  \"success\": true,\n  \"result\": {\n    \"output\": \"# Testing Guidance\\n\\n...\",\n    \"answer\": \"Based on your requirements...\"\n  },\n  \"confidence\": 85,\n  \"metadata\": {\n    \"duration_ms\": 150,\n    \"agent_name\": \"marie\",\n    \"topic\": \"testing\"\n  }\n}\n</code></pre></p>"},{"location":"services/agents/marie/#supported-topics","title":"Supported Topics","text":"Topic Description <code>testing</code> General testing strategy <code>edge_cases</code> Edge case identification <code>qa_review</code> QA review and assessment"},{"location":"services/agents/marie/#health-check","title":"Health Check","text":"<pre><code>curl http://localhost:8004/health\n</code></pre> <p>Response: <pre><code>{\n  \"status\": \"healthy\",\n  \"version\": \"0.1.0\",\n  \"agent_name\": \"marie\",\n  \"uptime_seconds\": 3600,\n  \"capabilities\": {\n    \"topics\": [\"testing\", \"edge_cases\", \"qa_review\"],\n    \"specialization\": \"testing\"\n  }\n}\n</code></pre></p>"},{"location":"services/agents/marie/#configuration","title":"Configuration","text":"Variable Default Description PORT 8004 Service port PYTHONUNBUFFERED 1 Enable unbuffered output"},{"location":"services/agents/marie/#response-format","title":"Response Format","text":"<p>Marie provides structured testing guidance:</p> <ol> <li>Analysis: Assessment of testing requirements</li> <li>Strategy: Recommended testing approach</li> <li>Test Cases: Specific tests to write</li> <li>Edge Cases: Important edge cases to cover</li> <li>Tools: Recommended testing tools</li> </ol>"},{"location":"services/agents/marie/#testing","title":"Testing","text":"<pre><code>cd services/agents/marie\n\n# Run all tests\nuv run pytest\n\n# Run contract tests only\nuv run pytest tests/contract/ -v\n\n# Run with coverage\nuv run pytest --cov=src --cov-report=html\n</code></pre>"},{"location":"services/agents/marie/#project-structure","title":"Project Structure","text":"<pre><code>services/agents/marie/\n\u251c\u2500\u2500 src/\n\u2502   \u251c\u2500\u2500 __init__.py\n\u2502   \u251c\u2500\u2500 main.py\n\u2502   \u251c\u2500\u2500 api/\n\u2502   \u2502   \u251c\u2500\u2500 health.py\n\u2502   \u2502   \u2514\u2500\u2500 invoke.py\n\u2502   \u2514\u2500\u2500 core/\n\u2502       \u251c\u2500\u2500 agent.py\n\u2502       \u2514\u2500\u2500 prompts.py\n\u251c\u2500\u2500 tests/\n\u2502   \u251c\u2500\u2500 conftest.py\n\u2502   \u251c\u2500\u2500 contract/\n\u2502   \u2502   \u251c\u2500\u2500 test_health.py\n\u2502   \u2502   \u2514\u2500\u2500 test_invoke.py\n\u2502   \u2514\u2500\u2500 integration/\n\u251c\u2500\u2500 Dockerfile\n\u2514\u2500\u2500 pyproject.toml\n</code></pre>"},{"location":"services/agents/marie/#related-documentation","title":"Related Documentation","text":"<ul> <li>Agent Hub Service</li> <li>Baron Agent</li> <li>Duc Agent</li> </ul>"},{"location":"testing/running-tests/","title":"Running Tests","text":"<p>How to execute Farmer Code tests.</p>"},{"location":"testing/running-tests/#quick-reference","title":"Quick Reference","text":"<pre><code># All tests\nuv run pytest\n\n# By type\nuv run pytest tests/unit/\nuv run pytest tests/integration/\nuv run pytest tests/e2e/\n\n# By module\nuv run pytest tests/unit/agent_hub/\nuv run pytest tests/e2e/agent_hub/\n\n# By journey\nuv run pytest -m journey\nuv run pytest -m \"journey('AH-001')\"\n\n# With coverage\nuv run pytest --cov=src --cov-report=html\n</code></pre>"},{"location":"testing/running-tests/#running-all-tests","title":"Running All Tests","text":"<pre><code>uv run pytest\n</code></pre> <p>Expected output: <pre><code>tests/unit/... PASSED\ntests/integration/... PASSED\ntests/contract/... PASSED\ntests/e2e/... PASSED\n\n458 passed in 2.5s\n</code></pre></p>"},{"location":"testing/running-tests/#running-by-test-type","title":"Running by Test Type","text":""},{"location":"testing/running-tests/#unit-tests-fast-no-deps","title":"Unit Tests (Fast, No Deps)","text":"<pre><code>uv run pytest tests/unit/ -v\n</code></pre>"},{"location":"testing/running-tests/#integration-tests-mocked-deps","title":"Integration Tests (Mocked Deps)","text":"<pre><code>uv run pytest tests/integration/ -v\n</code></pre>"},{"location":"testing/running-tests/#contract-tests-schema-validation","title":"Contract Tests (Schema Validation)","text":"<pre><code>uv run pytest tests/contract/ -v\n</code></pre>"},{"location":"testing/running-tests/#e2e-tests-require-credentials","title":"E2E Tests (Require Credentials)","text":"<pre><code># Requires .env with valid credentials\nuv run pytest tests/e2e/ -v\n</code></pre>"},{"location":"testing/running-tests/#running-by-module","title":"Running by Module","text":"<pre><code># Agent Hub\nuv run pytest tests/unit/agent_hub/\nuv run pytest tests/e2e/agent_hub/\n\n# Orchestrator\nuv run pytest tests/unit/orchestrator/\nuv run pytest tests/unit/test_state_machine.py\n\n# Worktree Manager\nuv run pytest tests/unit/worktree_manager/\n</code></pre>"},{"location":"testing/running-tests/#running-services-tests","title":"Running Services Tests","text":"<p>Each service has its own test suite in <code>services/</code>:</p> <pre><code># Agent Hub service tests\ncd services/agent-hub\nuv run pytest\n\n# Agent Hub E2E tests (requires RUN_E2E_TESTS=1)\ncd services/agent-hub\nRUN_E2E_TESTS=1 uv run pytest tests/e2e/ -v\n\n# Baron agent tests\ncd services/agents/baron\nuv run pytest\n\n# Duc agent tests\ncd services/agents/duc\nuv run pytest\n\n# Marie agent tests\ncd services/agents/marie\nuv run pytest\n</code></pre>"},{"location":"testing/running-tests/#contract-tests","title":"Contract Tests","text":"<p>Each service has contract tests to verify API schemas:</p> <pre><code># Run all contract tests for a service\ncd services/agent-hub\nuv run pytest tests/contract/ -v\n</code></pre>"},{"location":"testing/running-tests/#running-journey-tests","title":"Running Journey Tests","text":"<pre><code># All journey tests\nuv run pytest -m journey -v\n\n# Specific journey\nuv run pytest -m \"journey('AH-001')\" -v\n\n# All AH journeys\nuv run pytest -m \"journey\" tests/e2e/agent_hub/ -v\n</code></pre>"},{"location":"testing/running-tests/#verbose-output","title":"Verbose Output","text":"<pre><code># Show test names\nuv run pytest -v\n\n# Show print statements\nuv run pytest -s\n\n# Show both\nuv run pytest -vs\n</code></pre>"},{"location":"testing/running-tests/#coverage","title":"Coverage","text":"<pre><code># Terminal report\nuv run pytest --cov=src --cov-report=term-missing\n\n# HTML report\nuv run pytest --cov=src --cov-report=html\nopen htmlcov/index.html\n\n# Specific module coverage\nuv run pytest --cov=src/agent_hub tests/unit/agent_hub/\n</code></pre>"},{"location":"testing/running-tests/#parallel-execution","title":"Parallel Execution","text":"<pre><code># Run tests in parallel\nuv run pytest -n auto\n\n# Specific number of workers\nuv run pytest -n 4\n</code></pre>"},{"location":"testing/running-tests/#debugging-failures","title":"Debugging Failures","text":"<pre><code># Stop on first failure\nuv run pytest -x\n\n# Show full tracebacks\nuv run pytest --tb=long\n\n# Enter debugger on failure\nuv run pytest --pdb\n</code></pre>"},{"location":"testing/running-tests/#filtering-tests","title":"Filtering Tests","text":"<pre><code># By name pattern\nuv run pytest -k \"test_route\"\n\n# By marker\nuv run pytest -m \"not e2e\"\n\n# Combine filters\nuv run pytest -k \"test_validate\" -m \"not slow\"\n</code></pre>"},{"location":"testing/running-tests/#troubleshooting","title":"Troubleshooting","text":""},{"location":"testing/running-tests/#tests-skip-due-to-missing-credentials","title":"Tests Skip Due to Missing Credentials","text":"<pre><code>SKIPPED [1] tests/e2e/...: Missing GITHUB_TOKEN\n</code></pre> <p>Fix: Create <code>.env</code> with credentials:</p> <pre><code>cp .env.example .env\n# Edit .env with your tokens\n</code></pre>"},{"location":"testing/running-tests/#module-not-found","title":"Module Not Found","text":"<pre><code>ModuleNotFoundError: No module named 'agent_hub'\n</code></pre> <p>Fix: Use <code>uv run</code>:</p> <pre><code>uv run pytest  # Correct\npytest          # Wrong\n</code></pre>"},{"location":"testing/running-tests/#slow-tests","title":"Slow Tests","text":"<pre><code># Skip slow tests\nuv run pytest -m \"not slow\"\n\n# Run only fast tests\nuv run pytest tests/unit/ tests/contract/\n</code></pre>"},{"location":"testing/writing-tests/","title":"Writing Tests","text":"<p>How to write tests for Farmer Code following TDD principles.</p>"},{"location":"testing/writing-tests/#tdd-workflow-non-negotiable","title":"TDD Workflow (NON-NEGOTIABLE)","text":"<ol> <li>Write test first (Red)</li> <li>Run test - should fail</li> <li>Write minimal implementation (Green)</li> <li>Run test - should pass</li> <li>Refactor (Clean)</li> </ol>"},{"location":"testing/writing-tests/#test-structure","title":"Test Structure","text":""},{"location":"testing/writing-tests/#unit-test-template","title":"Unit Test Template","text":"<pre><code>\"\"\"Unit tests for [component].\"\"\"\nimport pytest\nfrom [module] import [Class]\n\n\nclass Test[ClassName]:\n    \"\"\"Test suite for [ClassName].\"\"\"\n\n    def test_[behavior]_when_[condition](self):\n        \"\"\"[What should happen] when [condition].\"\"\"\n        # Arrange\n        instance = [Class](...)\n\n        # Act\n        result = instance.method(...)\n\n        # Assert\n        assert result == expected\n</code></pre>"},{"location":"testing/writing-tests/#e2e-test-template","title":"E2E Test Template","text":"<pre><code>\"\"\"E2E tests for [journey].\"\"\"\nimport pytest\nfrom [module] import [Service]\n\n\n@pytest.mark.e2e\n@pytest.mark.journey(\"[DOMAIN]-[NNN]\")\nclass Test[JourneyName]E2E:\n    \"\"\"E2E tests for [DOMAIN]-[NNN]: [Journey Name].\"\"\"\n\n    def test_[step]_e2e(self):\n        \"\"\"Test [step description] end-to-end.\"\"\"\n        # Full integration test\n        service = [Service](...)\n        result = service.do_something(...)\n        assert result.success\n</code></pre>"},{"location":"testing/writing-tests/#naming-conventions","title":"Naming Conventions","text":""},{"location":"testing/writing-tests/#test-files","title":"Test Files","text":"<pre><code>tests/\n\u251c\u2500\u2500 unit/[module]/\n\u2502   \u2514\u2500\u2500 test_[component].py      # test_validator.py\n\u251c\u2500\u2500 integration/[module]/\n\u2502   \u2514\u2500\u2500 test_[feature].py        # test_dispatch.py\n\u251c\u2500\u2500 contract/[module]/\n\u2502   \u2514\u2500\u2500 test_[schema]_schema.py  # test_question_schema.py\n\u2514\u2500\u2500 e2e/[module]/\n    \u2514\u2500\u2500 test_[journey].py        # test_route_question.py\n</code></pre>"},{"location":"testing/writing-tests/#test-functions","title":"Test Functions","text":"<pre><code># Pattern: test_[what]_[when/condition]\ndef test_answer_is_accepted_when_confidence_above_threshold():\n    ...\n\ndef test_question_routes_to_architect_for_design_topic():\n    ...\n\ndef test_escalation_created_when_confidence_below_threshold():\n    ...\n</code></pre>"},{"location":"testing/writing-tests/#fixtures","title":"Fixtures","text":""},{"location":"testing/writing-tests/#module-fixtures","title":"Module Fixtures","text":"<p>Create in <code>tests/[type]/[module]/conftest.py</code>:</p> <pre><code># tests/unit/agent_hub/conftest.py\nimport pytest\nfrom agent_hub import Question\n\n\n@pytest.fixture\ndef sample_question():\n    \"\"\"Create a sample question for testing.\"\"\"\n    return Question(\n        id=\"q-test\",\n        topic=\"architecture\",\n        question=\"How should we structure the API?\",\n        feature_id=\"test-feature\",\n    )\n\n\n@pytest.fixture\ndef high_confidence_answer(sample_question):\n    \"\"\"Create a high-confidence answer.\"\"\"\n    return Answer(\n        question_id=sample_question.id,\n        answered_by=\"@duc\",\n        answer=\"Use REST with resource-based URLs.\",\n        rationale=\"Standard pattern for this type of API.\",\n        confidence=90,\n        model_used=\"opus\",\n        duration_seconds=2.5,\n    )\n</code></pre>"},{"location":"testing/writing-tests/#global-fixtures","title":"Global Fixtures","text":"<p>Create in <code>tests/conftest.py</code>:</p> <pre><code># tests/conftest.py\nimport pytest\nfrom pathlib import Path\n\n\n@pytest.fixture\ndef temp_dir(tmp_path):\n    \"\"\"Create a temporary directory for tests.\"\"\"\n    return tmp_path\n\n\n@pytest.fixture\ndef mock_github():\n    \"\"\"Mock GitHub service.\"\"\"\n    from unittest.mock import Mock\n    return Mock()\n</code></pre>"},{"location":"testing/writing-tests/#mocking","title":"Mocking","text":""},{"location":"testing/writing-tests/#mock-external-services","title":"Mock External Services","text":"<pre><code>from unittest.mock import Mock, patch\n\n\ndef test_dispatch_calls_subprocess(self):\n    with patch(\"subprocess.run\") as mock_run:\n        mock_run.return_value.stdout = '{\"answer\": \"Use OAuth2\"}'\n        mock_run.return_value.returncode = 0\n\n        dispatcher = AgentDispatcher()\n        handle = dispatcher.dispatch(config, question)\n\n        mock_run.assert_called_once()\n        assert handle.status == AgentStatus.COMPLETED\n</code></pre>"},{"location":"testing/writing-tests/#mock-dependencies","title":"Mock Dependencies","text":"<pre><code>def test_hub_uses_config(self):\n    mock_config = Mock(spec=RoutingConfig)\n    mock_config.get_agent_for_topic.return_value = AgentDefinition(\n        name=\"@duc\", model=\"opus\"\n    )\n\n    hub = AgentHub(config=mock_config)\n    response = hub.ask_expert(topic=\"architecture\", question=\"...\")\n\n    mock_config.get_agent_for_topic.assert_called_with(\"architecture\")\n</code></pre>"},{"location":"testing/writing-tests/#testing-exceptions","title":"Testing Exceptions","text":"<pre><code>def test_raises_error_when_no_agent_available(self):\n    config = RoutingConfig(agents=[])  # No agents\n\n    with pytest.raises(UnknownTopicError) as exc_info:\n        hub = AgentHub(config)\n        hub.ask_expert(topic=\"unknown\", question=\"...\")\n\n    assert \"No agent available\" in str(exc_info.value)\n</code></pre>"},{"location":"testing/writing-tests/#parametrized-tests","title":"Parametrized Tests","text":"<pre><code>@pytest.mark.parametrize(\"confidence,expected_outcome\", [\n    (90, ValidationOutcome.ACCEPTED),\n    (80, ValidationOutcome.ACCEPTED),\n    (79, ValidationOutcome.ESCALATE),\n    (50, ValidationOutcome.ESCALATE),\n])\ndef test_validation_outcomes(self, confidence, expected_outcome):\n    answer = create_answer(confidence=confidence)\n    result = validator.validate(answer)\n    assert result.outcome == expected_outcome\n</code></pre>"},{"location":"testing/writing-tests/#journey-markers","title":"Journey Markers","text":"<p>E2E tests MUST have journey markers:</p> <pre><code>@pytest.mark.e2e\n@pytest.mark.journey(\"AH-001\")\ndef test_route_question_to_architect_e2e():\n    \"\"\"Test AH-001: Route Question to Expert Agent.\n\n    Steps tested:\n    - Step 1: Create question with architecture topic\n    - Step 2: Route to appropriate expert\n    - Step 3: Verify response received\n    \"\"\"\n    ...\n</code></pre>"},{"location":"testing/writing-tests/#test-documentation","title":"Test Documentation","text":"<p>Each test should have a docstring explaining:</p> <pre><code>def test_escalation_includes_uncertainty_reasons(self):\n    \"\"\"Escalation request includes reasons for low confidence.\n\n    Given:\n        - Answer with 65% confidence\n        - Uncertainty reasons: [\"Missing context\", \"Ambiguous question\"]\n\n    When:\n        - Validation triggers escalation\n\n    Then:\n        - EscalationRequest contains uncertainty_reasons list\n        - GitHub comment format includes reasons\n    \"\"\"\n    ...\n</code></pre>"},{"location":"testing/writing-tests/#common-patterns","title":"Common Patterns","text":""},{"location":"testing/writing-tests/#testing-file-operations","title":"Testing File Operations","text":"<pre><code>def test_logs_written_to_file(self, tmp_path):\n    log_path = tmp_path / \"logs\" / \"qa\"\n    logger = QALogger(log_path)\n\n    logger.log_exchange(entry)\n\n    log_file = log_path / f\"{entry.feature_id}.jsonl\"\n    assert log_file.exists()\n    assert entry.id in log_file.read_text()\n</code></pre>"},{"location":"testing/writing-tests/#testing-state-changes","title":"Testing State Changes","text":"<pre><code>def test_state_transitions_correctly(self):\n    machine = StateMachine()\n\n    # Initial state\n    assert machine.current_state == WorkflowState.IDLE\n\n    # Transition\n    machine.transition(\"phase_1_start\")\n    assert machine.current_state == WorkflowState.PHASE_1\n\n    # Invalid transition\n    with pytest.raises(InvalidStateTransition):\n        machine.transition(\"approval_received\")  # Can't skip to end\n</code></pre>"},{"location":"testing/writing-tests/#checklist","title":"Checklist","text":"<p>Before submitting PR, verify:</p> <ul> <li>[ ] Tests written BEFORE implementation</li> <li>[ ] All tests pass (<code>uv run pytest</code>)</li> <li>[ ] E2E tests have journey markers</li> <li>[ ] New code has 80%+ coverage</li> <li>[ ] Test names describe behavior</li> <li>[ ] Docstrings explain test purpose</li> </ul>"},{"location":"user-journeys/","title":"User Journey Documentation Guide","text":"<p>This directory contains all user journey documentation for Farmer Code orchestrator.</p> <p>\ud83d\udcca View all journeys \u2192 - Complete list with status and test coverage</p>"},{"location":"user-journeys/#what-are-user-journeys","title":"What are User Journeys?","text":"<p>User journeys document end-to-end workflows from a user's perspective. Each journey: - Has a unique ID (e.g., <code>ORC-001</code>) - Maps to one or more E2E tests - Tracks implementation status and test coverage - Links to related journeys and features</p>"},{"location":"user-journeys/#journey-structure","title":"Journey Structure","text":"<p>Each journey is documented in a separate markdown file following this structure:</p> <pre><code># [DOMAIN-NNN]: [Journey Name]\n\n**Actor**: [Who performs this journey]\n**Goal**: [What they want to accomplish]\n**Preconditions**: [What must be true before starting]\n**Priority**: [P1/P2/P3]\n\n## Steps:\n1-N. [Detailed steps with expected outcomes]\n\n## Success Criteria:\n- [Measurable outcomes]\n\n## E2E Test Coverage:\n- Test file, markers, coverage status\n\n## Related Journeys:\n- Links to other journeys\n</code></pre>"},{"location":"user-journeys/#journey-domains","title":"Journey Domains","text":"<p>User journeys are organized by domain using 2-4 letter prefixes:</p> Domain Description Example IDs ORC Orchestrator - AI agent workflow orchestration ORC-001, ORC-002 GH GitHub - Direct GitHub integration operations GH-001, GH-002 UI User Interface - Web/TUI user interactions UI-001, UI-002"},{"location":"user-journeys/#journey-id-format","title":"Journey ID Format","text":"<p>Journey IDs follow the pattern: <code>[DOMAIN]-[NNN]</code></p> <ul> <li>DOMAIN: 2-4 letter domain code (uppercase)</li> <li>NNN: 3-digit sequential number (001, 002, 003, ...)</li> <li>Examples: <code>ORC-001</code>, <code>GH-023</code>, <code>UI-007</code></li> </ul>"},{"location":"user-journeys/#journey-development-workflow","title":"Journey Development Workflow","text":"<ol> <li>During Specification: Identify journeys and assign unique IDs</li> <li>During Planning: Map journeys to user stories and tasks</li> <li>During Test Design: Design E2E tests for each journey</li> <li>During Implementation: Tag E2E tests with <code>@pytest.mark.journey(\"DOMAIN-NNN\")</code></li> <li>During Review: Verify journey coverage in test reports</li> <li>Ongoing: Update journey docs when behavior changes</li> </ol>"},{"location":"user-journeys/#adding-a-new-journey","title":"Adding a New Journey","text":""},{"location":"user-journeys/#1-assign-journey-id","title":"1. Assign Journey ID","text":"<p>Get next sequential number for the domain: <pre><code># Check existing journeys in domain\nls docs/user-journeys/ORC-*.md\n# Assign next number (e.g., ORC-006)\n</code></pre></p>"},{"location":"user-journeys/#2-create-journey-file","title":"2. Create Journey File","text":"<p>Create <code>DOMAIN-NNN-[descriptive-name].md</code> following the template structure above.</p>"},{"location":"user-journeys/#3-update-journey-list","title":"3. Update Journey List","text":"<p>Add your journey to JOURNEYS.md table.</p>"},{"location":"user-journeys/#4-implement-and-tag-tests","title":"4. Implement and Tag Tests","text":"<p>When implementing E2E tests, add the journey marker: <pre><code>@pytest.mark.e2e\n@pytest.mark.journey(\"ORC-006\")\ndef test_your_journey():\n    \"\"\"Test ORC-006: Your Journey Name\"\"\"\n    # Test implementation\n</code></pre></p>"},{"location":"user-journeys/#5-verify-coverage","title":"5. Verify Coverage","text":"<p>Run journey-tagged tests to verify: <pre><code># See all journey-tagged tests\npytest --co -m journey\n\n# Run your journey's tests\npytest -m \"journey('ORC-006')\" -v\n</code></pre></p>"},{"location":"user-journeys/#running-journey-tests","title":"Running Journey Tests","text":"<pre><code># Run all journey-tagged tests\npytest -m journey -v\n\n# Run specific journey\npytest -m \"journey('ORC-001')\" -v\n\n# Generate journey coverage report (shown automatically at end)\npytest -m journey\n\n# List all journey-tagged tests without running\npytest --co -m journey\n</code></pre>"},{"location":"user-journeys/#journey-coverage-report","title":"Journey Coverage Report","text":"<p>When you run journey-tagged tests, you'll see a coverage summary:</p> <pre><code>=================== User Journey Test Coverage ===================\n\nORC-001: \u2705 PASSED (1/1 tests passing, 100% coverage)\nORC-005: \u2705 PASSED (1/1 tests passing, 100% coverage)\n\nJourney Coverage: 2/2 journeys passing\n</code></pre> <p>This helps track which user journeys are fully tested and working.</p>"},{"location":"user-journeys/#journey-coverage-goals","title":"Journey Coverage Goals","text":"<ul> <li>P1 Journeys: 100% E2E test coverage required before v1.0 release</li> <li>P2 Journeys: 80% E2E test coverage recommended for v1.1</li> <li>P3 Journeys: 50% E2E test coverage minimum for v2.0</li> </ul>"},{"location":"user-journeys/#files-in-this-directory","title":"Files in This Directory","text":"<ul> <li>JOURNEYS.md - Complete list of all journeys with status</li> <li>README.md - This file (journey documentation guide)</li> <li>ORC-001-create-issue.md - Create issue for new feature request</li> <li>ORC-002-agent-feedback.md - Agent provides feedback via comment</li> <li>ORC-003-workflow-progression.md - Progress issue through workflow phases</li> <li>ORC-004-link-pull-request.md - Link pull request to feature issue</li> <li>ORC-005-full-sdlc-workflow.md - Complete 8-phase SDLC workflow</li> <li>WT-001-create-worktree.md - Create worktree for feature development</li> <li>WT-002-init-plans.md - Initialize plans folder structure</li> <li>WT-003-commit-push.md - Commit and push feature changes</li> <li>WT-004-cleanup-worktree.md - Cleanup worktree after feature completion</li> </ul>"},{"location":"user-journeys/#related-documentation","title":"Related Documentation","text":"<ul> <li>JOURNEYS.md - View all journeys with status and coverage</li> <li>Constitution - Principle XI - Journey standards</li> <li>SDLC Workflow Reference - The 8-phase workflow</li> <li>E2E Test Guide (future) - How to write journey tests</li> </ul>"},{"location":"user-journeys/AH-001-route-question/","title":"AH-001: Route Question to Expert Agent","text":"<p>Actor: Orchestration Agent (@baron PM Agent or similar) Goal: Route a question to the appropriate expert agent via <code>ask_expert()</code> and receive a structured HubResponse Preconditions: - Hub configuration loaded with agent definitions and topics - Expert agents defined (architect, product, etc.) - Valid topic configured in routing config</p> <p>Priority: P1 (MVP - Foundation for Agent Hub)</p>"},{"location":"user-journeys/AH-001-route-question/#overview","title":"Overview","text":"<p>This journey represents the core ask_expert flow of the Agent Hub. Unlike the legacy <code>route_question()</code> API, <code>ask_expert()</code> provides a higher-level interface that: - Returns a structured <code>HubResponse</code> with answer, confidence, and session_id - Automatically validates confidence and escalates when needed - Creates sessions for multi-turn conversations - Validates topics and provides helpful error messages</p>"},{"location":"user-journeys/AH-001-route-question/#steps","title":"Steps","text":""},{"location":"user-journeys/AH-001-route-question/#1-call-ask_expert-with-topic-and-question","title":"1. Call ask_expert with Topic and Question","text":"<ul> <li>Action: Orchestration agent calls <code>hub.ask_expert(topic, question, context, feature_id)</code></li> <li>Expected outcome: Request is validated and processed</li> <li>System behavior:</li> <li>Validates topic is configured (raises <code>UnknownTopicError</code> if not)</li> <li>Creates new session or reuses existing session_id</li> <li>Builds Question object with validated parameters</li> </ul>"},{"location":"user-journeys/AH-001-route-question/#2-route-to-expert-agent","title":"2. Route to Expert Agent","text":"<ul> <li>Action: Hub resolves which agent handles the topic</li> <li>Expected outcome: Correct agent is selected based on:</li> <li>Topic overrides in config (highest priority)</li> <li>Agent topic mappings</li> <li>Default to human if no match</li> <li>System behavior:</li> <li>Uses <code>RoutingConfig.get_agent_for_topic()</code> for resolution</li> <li>If routing directly to human, returns PENDING_HUMAN immediately</li> </ul>"},{"location":"user-journeys/AH-001-route-question/#3-dispatch-and-get-answer","title":"3. Dispatch and Get Answer","text":"<ul> <li>Action: Hub dispatches question to expert agent via CLI</li> <li>Expected outcome: Agent provides structured JSON answer</li> <li>System behavior:</li> <li>AgentRouter spawns <code>claude --model {model} --print -p \"{prompt}\"</code></li> <li>Parses answer with rationale, confidence, uncertainty_reasons</li> <li>Records response duration</li> </ul>"},{"location":"user-journeys/AH-001-route-question/#4-validate-confidence","title":"4. Validate Confidence","text":"<ul> <li>Action: Hub validates answer confidence against threshold</li> <li>Expected outcome: Determines if answer is acceptable or needs escalation</li> <li>System behavior:</li> <li>Default threshold: 80%</li> <li>Topic-specific thresholds from overrides</li> <li>If below threshold, creates escalation</li> </ul>"},{"location":"user-journeys/AH-001-route-question/#5-return-hubresponse","title":"5. Return HubResponse","text":"<ul> <li>Action: Hub returns structured response to caller</li> <li>Expected outcome: HubResponse with all relevant fields</li> <li>System behavior:</li> <li>Status: RESOLVED (high confidence) or PENDING_HUMAN (escalated)</li> <li>Includes session_id for follow-up questions</li> <li>Includes escalation_id if escalated</li> </ul>"},{"location":"user-journeys/AH-001-route-question/#success-criteria","title":"Success Criteria","text":"<ul> <li>Question routed to correct agent based on topic</li> <li>HubResponse returned with answer, confidence, session_id</li> <li>Low confidence answers trigger PENDING_HUMAN status</li> <li>Unknown topics raise UnknownTopicError with available topics list</li> <li>Session created for conversation tracking</li> </ul>"},{"location":"user-journeys/AH-001-route-question/#e2e-test-coverage","title":"E2E Test Coverage","text":"<ul> <li>Test file: <code>tests/e2e/agent_hub/test_route_question.py</code></li> <li>Journey marker: <code>@pytest.mark.journey(\"AH-001\")</code></li> <li>Test class: <code>TestAskExpertE2E</code></li> <li>Covered steps: All 5 steps (100% coverage)</li> <li>Test status: Passing</li> </ul>"},{"location":"user-journeys/AH-001-route-question/#test-implementation-details","title":"Test Implementation Details","text":"<pre><code>@pytest.mark.journey(\"AH-001\")\nclass TestAskExpertE2E:\n    def test_ask_expert_routes_and_returns_response_e2e(self):\n        \"\"\"Routes authentication topic to architect and returns HubResponse.\"\"\"\n\n    def test_ask_expert_low_confidence_triggers_escalation_e2e(self):\n        \"\"\"Low confidence answer triggers PENDING_HUMAN status.\"\"\"\n\n    def test_ask_expert_unknown_topic_returns_error_e2e(self):\n        \"\"\"Unknown topic raises UnknownTopicError.\"\"\"\n</code></pre>"},{"location":"user-journeys/AH-001-route-question/#error-scenarios-tested","title":"Error Scenarios Tested","text":"Scenario Expected Behavior Test Location Unknown topic Raises <code>UnknownTopicError</code> with available topics <code>test_hub.py::test_unknown_topic_includes_available_topics</code> Low confidence Returns PENDING_HUMAN with escalation_id <code>test_route_question.py::test_ask_expert_low_confidence_triggers_escalation_e2e</code> Agent dispatch failure Raises <code>AgentDispatchError</code> <code>test_router.py</code> Agent timeout Raises <code>AgentTimeoutError</code> <code>test_router.py</code>"},{"location":"user-journeys/AH-001-route-question/#related-journeys","title":"Related Journeys","text":"<ul> <li>AH-002: Session Management (multi-turn conversations)</li> <li>AH-003: Confidence Escalation (low confidence handling)</li> <li>AH-004: Pending Escalation Tracking (check escalation status)</li> <li>AH-005: Audit Logging (Q&amp;A exchange logging)</li> <li>KR-001: Route Question (legacy lower-level API)</li> </ul>"},{"location":"user-journeys/AH-001-route-question/#api-reference","title":"API Reference","text":"<pre><code># Basic usage\nresponse = hub.ask_expert(\n    topic=\"authentication\",\n    question=\"What auth method should we use for the API?\",\n    context=\"Building REST API for mobile clients\",\n    feature_id=\"005-user-auth\"\n)\n\n# Check response status\nif response.status == ResponseStatus.RESOLVED:\n    print(f\"Answer: {response.answer}\")\n    print(f\"Confidence: {response.confidence}%\")\nelif response.status == ResponseStatus.PENDING_HUMAN:\n    print(f\"Escalated: {response.escalation_id}\")\n    # Poll check_escalation() for resolution\n</code></pre>"},{"location":"user-journeys/AH-001-route-question/#implementation-references","title":"Implementation References","text":"<ul> <li>Spec: <code>specs/005-agent-hub-refactor/spec.md</code> (User Story 1)</li> <li>Contract: <code>specs/005-agent-hub-refactor/contracts/agent-hub-api.md</code></li> <li>Code: <code>src/agent_hub/hub.py::ask_expert()</code></li> <li>Router: <code>src/agent_hub/router.py::AgentRouter</code></li> <li>Tests: <code>tests/e2e/agent_hub/test_route_question.py</code></li> <li>Unit Tests: <code>tests/unit/agent_hub/test_hub.py</code></li> </ul>"},{"location":"user-journeys/AH-001-route-question/#notes","title":"Notes","text":"<ul> <li>Questions are built internally from topic, question, context parameters</li> <li>Session IDs are UUIDs generated automatically</li> <li>Topic validation happens before routing</li> <li>Confidence validation uses ConfidenceValidator from Phase 2 (KR-002)</li> <li>Escalation uses EscalationHandler from Phase 3 (KR-003)</li> </ul>"},{"location":"user-journeys/AH-002-session-management/","title":"AH-002: Maintain Conversation Sessions","text":"<p>Actor: Orchestration Agent (@baron PM Agent or similar) Goal: Maintain multi-turn conversation sessions with context preservation Preconditions: - AgentHub initialized with SessionManager - Valid session created via ask_expert() - Hub configuration loaded with agent definitions</p> <p>Priority: P1 (Essential for multi-turn conversations)</p>"},{"location":"user-journeys/AH-002-session-management/#overview","title":"Overview","text":"<p>This journey covers session management for multi-turn conversations with expert agents. Sessions preserve conversation context across multiple questions, enabling follow-up questions and coherent dialogue: - Sessions track all messages (questions and answers) - Context is preserved for follow-up questions - Sessions can be closed to prevent further messages - Session state is queryable via get_session()</p>"},{"location":"user-journeys/AH-002-session-management/#steps","title":"Steps","text":""},{"location":"user-journeys/AH-002-session-management/#1-session-creation-via-ask_expert","title":"1. Session Creation via ask_expert","text":"<ul> <li>Action: Orchestration agent calls <code>hub.ask_expert()</code> (without session_id)</li> <li>Expected outcome: New session created automatically</li> <li>System behavior:</li> <li>SessionManager.create() generates unique session ID</li> <li>Session initialized with agent_id, feature_id, ACTIVE status</li> <li>Session ID returned in HubResponse.session_id</li> </ul>"},{"location":"user-journeys/AH-002-session-management/#2-message-recording","title":"2. Message Recording","text":"<ul> <li>Action: Hub records question and answer in session</li> <li>Expected outcome: Messages preserved with metadata</li> <li>System behavior:</li> <li>USER message added with question content</li> <li>ASSISTANT message added with answer, confidence, rationale</li> <li>Timestamps recorded for each message</li> <li>Session updated_at refreshed</li> </ul>"},{"location":"user-journeys/AH-002-session-management/#3-follow-up-questions-session-reuse","title":"3. Follow-up Questions (Session Reuse)","text":"<ul> <li>Action: Orchestration agent calls <code>hub.ask_expert(session_id=existing_id)</code></li> <li>Expected outcome: Same session reused, context preserved</li> <li>System behavior:</li> <li>SessionManager.exists() validates session_id</li> <li>New messages appended to existing message history</li> <li>Same session_id returned in HubResponse</li> </ul>"},{"location":"user-journeys/AH-002-session-management/#4-query-session-state","title":"4. Query Session State","text":"<ul> <li>Action: Orchestration agent calls <code>hub.get_session(session_id)</code></li> <li>Expected outcome: Full session with message history returned</li> <li>System behavior:</li> <li>Returns Session object with all messages</li> <li>Includes status, created_at, updated_at</li> <li>Raises SessionNotFoundError if not found</li> </ul>"},{"location":"user-journeys/AH-002-session-management/#5-close-session","title":"5. Close Session","text":"<ul> <li>Action: Orchestration agent calls <code>hub.close_session(session_id)</code></li> <li>Expected outcome: Session marked as CLOSED</li> <li>System behavior:</li> <li>Session status changed to SessionStatus.CLOSED</li> <li>Subsequent add_message calls raise SessionClosedError</li> <li>Session remains queryable via get_session()</li> </ul>"},{"location":"user-journeys/AH-002-session-management/#success-criteria","title":"Success Criteria","text":"<ul> <li>Sessions created with unique UUID identifiers</li> <li>Message history preserved across multiple ask_expert calls</li> <li>Session can be reused by passing session_id parameter</li> <li>get_session() returns complete conversation history</li> <li>close_session() prevents new messages</li> <li>SessionNotFoundError raised for invalid session IDs</li> </ul>"},{"location":"user-journeys/AH-002-session-management/#e2e-test-coverage","title":"E2E Test Coverage","text":"<ul> <li>Test file: <code>tests/e2e/agent_hub/test_session_management.py</code></li> <li>Journey marker: <code>@pytest.mark.journey(\"AH-002\")</code></li> <li>Test class: <code>TestSessionManagementE2E</code></li> <li>Covered steps: All 5 steps (100% coverage)</li> <li>Test status: Passing (6/6 tests)</li> </ul>"},{"location":"user-journeys/AH-002-session-management/#test-implementation-details","title":"Test Implementation Details","text":"<pre><code>@pytest.mark.journey(\"AH-002\")\nclass TestSessionManagementE2E:\n    def test_ask_expert_creates_session_e2e(self):\n        \"\"\"ask_expert creates a session and returns session_id.\"\"\"\n\n    def test_session_preserves_context_across_questions_e2e(self):\n        \"\"\"Session preserves context across multiple questions.\"\"\"\n\n    def test_get_session_returns_full_history_e2e(self):\n        \"\"\"get_session returns complete conversation history.\"\"\"\n\n    def test_close_session_prevents_new_messages_e2e(self):\n        \"\"\"Closing a session changes status to CLOSED.\"\"\"\n\n    def test_get_nonexistent_session_raises_error_e2e(self):\n        \"\"\"Getting a nonexistent session raises SessionNotFoundError.\"\"\"\n\n    def test_session_tracks_multiple_turn_conversation_e2e(self):\n        \"\"\"Complete multi-turn conversation tracking.\"\"\"\n</code></pre>"},{"location":"user-journeys/AH-002-session-management/#error-scenarios-tested","title":"Error Scenarios Tested","text":"Scenario Expected Behavior Test Location Get nonexistent session Raises <code>SessionNotFoundError</code> <code>test_session_management.py::test_get_nonexistent_session_raises_error_e2e</code> Add message to closed session Raises <code>SessionClosedError</code> <code>test_session.py::test_add_message_to_closed_session_raises_error</code> Close nonexistent session Raises <code>SessionNotFoundError</code> <code>test_session.py::test_close_nonexistent_session_raises_error</code>"},{"location":"user-journeys/AH-002-session-management/#related-journeys","title":"Related Journeys","text":"<ul> <li>AH-001: Route Question (creates initial session)</li> <li>AH-003: Confidence Escalation (escalations linked to sessions)</li> <li>AH-004: Pending Escalation Tracking (human responses added to session)</li> <li>AH-005: Audit Logging (session_id included in logs)</li> </ul>"},{"location":"user-journeys/AH-002-session-management/#api-reference","title":"API Reference","text":"<pre><code># First question creates session\nresponse1 = hub.ask_expert(\n    topic=\"database\",\n    question=\"Which database should we use?\",\n    feature_id=\"005-db-setup\"\n)\nsession_id = response1.session_id  # UUID\n\n# Follow-up question reuses session\nresponse2 = hub.ask_expert(\n    topic=\"caching\",\n    question=\"What about caching?\",\n    session_id=session_id  # Reuse session\n)\nassert response1.session_id == response2.session_id\n\n# Query session state\nsession = hub.get_session(session_id)\nprint(f\"Messages: {len(session.messages)}\")\nfor msg in session.messages:\n    print(f\"  [{msg.role}]: {msg.content[:50]}...\")\n\n# Close session when done\nhub.close_session(session_id)\nassert hub.get_session(session_id).status == SessionStatus.CLOSED\n</code></pre>"},{"location":"user-journeys/AH-002-session-management/#implementation-references","title":"Implementation References","text":"<ul> <li>Spec: <code>specs/005-agent-hub-refactor/spec.md</code> (User Story 2)</li> <li>Contract: <code>specs/005-agent-hub-refactor/contracts/agent-hub-api.md</code></li> <li>Hub Code: <code>src/agent_hub/hub.py::get_session()</code>, <code>close_session()</code></li> <li>SessionManager: <code>src/agent_hub/session.py::SessionManager</code></li> <li>Models: <code>src/agent_hub/models.py::Session</code>, <code>Message</code>, <code>MessageRole</code></li> <li>E2E Tests: <code>tests/e2e/agent_hub/test_session_management.py</code></li> <li>Unit Tests: <code>tests/unit/agent_hub/test_session.py</code></li> </ul>"},{"location":"user-journeys/AH-002-session-management/#notes","title":"Notes","text":"<ul> <li>Sessions use in-memory storage by default (can be extended for persistence)</li> <li>Session IDs are UUIDs generated via uuid.uuid4()</li> <li>Messages are appended, never modified</li> <li>Closed sessions remain queryable but cannot accept new messages</li> <li>MessageRole enum: USER, ASSISTANT, HUMAN (for human escalation responses)</li> </ul>"},{"location":"user-journeys/AH-003-confidence-escalation/","title":"AH-003: Validate Confidence and Escalate","text":"<p>Actor: Orchestration Agent (@baron PM Agent or similar) Goal: Low-confidence answers trigger human escalation with pending status Preconditions: - AgentHub initialized with ConfidenceValidator and EscalationHandler - Confidence thresholds configured (default 80%) - Expert agent provides answer with confidence score</p> <p>Priority: P2 (Essential for quality assurance)</p>"},{"location":"user-journeys/AH-003-confidence-escalation/#overview","title":"Overview","text":"<p>This journey covers confidence validation and human escalation within the ask_expert flow. When an expert agent provides a low-confidence answer, the Hub automatically: - Validates the confidence against topic-specific thresholds - Creates an escalation request for human review - Returns PENDING_HUMAN status with escalation_id - Preserves uncertainty reasons for human context</p>"},{"location":"user-journeys/AH-003-confidence-escalation/#steps","title":"Steps","text":""},{"location":"user-journeys/AH-003-confidence-escalation/#1-expert-agent-returns-answer","title":"1. Expert Agent Returns Answer","text":"<ul> <li>Action: Expert agent provides answer via ask_expert()</li> <li>Expected outcome: Answer includes confidence score and optional uncertainty_reasons</li> <li>System behavior:</li> <li>AgentRouter parses JSON response from CLI</li> <li>Answer model validated with confidence 0-100</li> </ul>"},{"location":"user-journeys/AH-003-confidence-escalation/#2-validate-confidence-against-threshold","title":"2. Validate Confidence Against Threshold","text":"<ul> <li>Action: Hub validates confidence using ConfidenceValidator</li> <li>Expected outcome: Validation determines ACCEPTED or ESCALATE</li> <li>System behavior:</li> <li>Checks for topic-specific threshold override</li> <li>Falls back to default threshold (80%)</li> <li>Returns AnswerValidationResult with outcome</li> </ul>"},{"location":"user-journeys/AH-003-confidence-escalation/#3-create-escalation-if-low-confidence","title":"3. Create Escalation (If Low Confidence)","text":"<ul> <li>Action: Hub creates escalation request when confidence &lt; threshold</li> <li>Expected outcome: EscalationRequest created with full context</li> <li>System behavior:</li> <li>EscalationHandler.create_escalation() generates escalation</li> <li>Includes original question, tentative answer, threshold used</li> <li>Escalation stored for later retrieval</li> </ul>"},{"location":"user-journeys/AH-003-confidence-escalation/#4-return-pending_human-response","title":"4. Return PENDING_HUMAN Response","text":"<ul> <li>Action: Hub returns HubResponse with escalation details</li> <li>Expected outcome: Response indicates human review needed</li> <li>System behavior:</li> <li>status = ResponseStatus.PENDING_HUMAN</li> <li>escalation_id set for tracking</li> <li>Original answer and uncertainty_reasons preserved</li> </ul>"},{"location":"user-journeys/AH-003-confidence-escalation/#5-high-confidence-path-no-escalation","title":"5. High Confidence Path (No Escalation)","text":"<ul> <li>Action: Hub returns RESOLVED for high-confidence answers</li> <li>Expected outcome: Response ready for immediate use</li> <li>System behavior:</li> <li>status = ResponseStatus.RESOLVED</li> <li>escalation_id = None</li> <li>Answer can be used directly</li> </ul>"},{"location":"user-journeys/AH-003-confidence-escalation/#success-criteria","title":"Success Criteria","text":"<ul> <li>Low confidence (&lt; threshold) triggers PENDING_HUMAN status</li> <li>Escalation_id returned for tracking human review</li> <li>Topic-specific thresholds honored (e.g., security = 95%)</li> <li>High confidence answers return RESOLVED immediately</li> <li>Uncertainty reasons preserved in response</li> </ul>"},{"location":"user-journeys/AH-003-confidence-escalation/#e2e-test-coverage","title":"E2E Test Coverage","text":"<ul> <li>Test file: <code>tests/e2e/agent_hub/test_escalation_flow.py</code></li> <li>Journey marker: <code>@pytest.mark.journey(\"AH-003\")</code></li> <li>Test class: <code>TestConfidenceEscalationE2E</code></li> <li>Covered steps: All 5 steps (100% coverage)</li> <li>Test status: Passing (5/5 tests)</li> </ul>"},{"location":"user-journeys/AH-003-confidence-escalation/#test-implementation-details","title":"Test Implementation Details","text":"<pre><code>@pytest.mark.journey(\"AH-003\")\nclass TestConfidenceEscalationE2E:\n    def test_ask_expert_low_confidence_creates_escalation_e2e(self):\n        \"\"\"Low confidence answer creates escalation with proper fields.\"\"\"\n\n    def test_ask_expert_topic_override_triggers_escalation_e2e(self):\n        \"\"\"Topic override threshold can trigger escalation.\"\"\"\n\n    def test_ask_expert_high_confidence_no_escalation_e2e(self):\n        \"\"\"High confidence answers don't create escalation.\"\"\"\n\n    def test_ask_expert_escalation_preserves_uncertainty_reasons_e2e(self):\n        \"\"\"Escalation response includes uncertainty reasons.\"\"\"\n\n    def test_ask_expert_escalation_with_session_context_e2e(self):\n        \"\"\"Escalation works correctly within session context.\"\"\"\n</code></pre>"},{"location":"user-journeys/AH-003-confidence-escalation/#error-scenarios-tested","title":"Error Scenarios Tested","text":"Scenario Expected Behavior Test Location Low confidence (&lt; 80%) PENDING_HUMAN status, escalation_id set <code>test_ask_expert_low_confidence_creates_escalation_e2e</code> Topic override threshold 88% fails 95% security threshold <code>test_ask_expert_topic_override_triggers_escalation_e2e</code> High confidence (&gt;= 80%) RESOLVED status, no escalation <code>test_ask_expert_high_confidence_no_escalation_e2e</code> Multiple uncertainty reasons All reasons preserved in response <code>test_ask_expert_escalation_preserves_uncertainty_reasons_e2e</code>"},{"location":"user-journeys/AH-003-confidence-escalation/#related-journeys","title":"Related Journeys","text":"<ul> <li>AH-001: Route Question (prerequisite - routing to expert)</li> <li>AH-002: Session Management (session context preserved during escalation)</li> <li>AH-004: Track Pending Escalations (check escalation status)</li> <li>KR-002: Validate Answer Confidence (underlying validator)</li> <li>KR-003: Escalate to Human (escalation handler)</li> </ul>"},{"location":"user-journeys/AH-003-confidence-escalation/#api-reference","title":"API Reference","text":"<pre><code># Low confidence triggers escalation\nresponse = hub.ask_expert(\n    topic=\"security\",\n    question=\"What encryption should we use?\",\n    feature_id=\"005-security\"\n)\n\nif response.status == ResponseStatus.PENDING_HUMAN:\n    print(f\"Escalated: {response.escalation_id}\")\n    print(f\"Confidence: {response.confidence}%\")\n    print(f\"Reasons: {response.uncertainty_reasons}\")\n    # Human will review via check_escalation()\nelif response.status == ResponseStatus.RESOLVED:\n    print(f\"Answer: {response.answer}\")\n    print(f\"Confidence: {response.confidence}%\")\n</code></pre>"},{"location":"user-journeys/AH-003-confidence-escalation/#topic-specific-thresholds","title":"Topic-Specific Thresholds","text":"<pre><code># Config with topic override\nconfig = ConfigLoader.load_from_dict({\n    \"defaults\": {\"confidence_threshold\": 80},\n    \"agents\": {\n        \"architect\": {\n            \"name\": \"@duc\",\n            \"topics\": [\"security\", \"compliance\"],\n        },\n    },\n    \"overrides\": {\n        \"security\": {\n            \"agent\": \"architect\",\n            \"confidence_threshold\": 95,  # Higher for security\n        },\n    },\n})\n\n# 88% passes default but fails security threshold\nresponse = hub.ask_expert(topic=\"security\", ...)\n# status = PENDING_HUMAN (88% &lt; 95%)\n</code></pre>"},{"location":"user-journeys/AH-003-confidence-escalation/#implementation-references","title":"Implementation References","text":"<ul> <li>Spec: <code>specs/005-agent-hub-refactor/spec.md</code> (User Story 3)</li> <li>Contract: <code>specs/005-agent-hub-refactor/contracts/agent-hub-api.md</code></li> <li>Hub Code: <code>src/agent_hub/hub.py::ask_expert()</code> (lines 136-166)</li> <li>Validator: <code>src/agent_hub/validator.py::ConfidenceValidator</code></li> <li>Escalation: <code>src/agent_hub/escalation.py::EscalationHandler</code></li> <li>E2E Tests: <code>tests/e2e/agent_hub/test_escalation_flow.py</code></li> <li>Unit Tests: <code>tests/unit/agent_hub/test_validator.py</code></li> </ul>"},{"location":"user-journeys/AH-003-confidence-escalation/#notes","title":"Notes","text":"<ul> <li>Default confidence threshold: 80%</li> <li>Topic overrides can set higher (security) or lower (documentation) thresholds</li> <li>Escalation preserves full context for human reviewer</li> <li>Uncertainty reasons help human understand agent's concerns</li> <li>Escalation stored in <code>self._escalations</code> dict for later retrieval</li> <li>Session messages still recorded even when escalated</li> </ul>"},{"location":"user-journeys/AH-004-pending-escalation/","title":"AH-004: Track Pending Escalations","text":"<p>Actor: Orchestration Agent (@baron PM Agent or similar) Goal: Agents can check escalation status and receive resolved answers Preconditions: - AgentHub initialized with EscalationHandler - Prior escalation created via ask_expert (AH-003) - Human reviewer available to respond</p> <p>Priority: P2 (Essential for complete escalation workflow)</p>"},{"location":"user-journeys/AH-004-pending-escalation/#overview","title":"Overview","text":"<p>This journey covers tracking and resolving pending escalations. After a low-confidence answer triggers an escalation (AH-003), the calling agent can: - Poll escalation status using check_escalation() - Process human responses via add_human_response() - Receive resolved answers or re-route instructions - Access human feedback through session history</p>"},{"location":"user-journeys/AH-004-pending-escalation/#steps","title":"Steps","text":""},{"location":"user-journeys/AH-004-pending-escalation/#1-check-escalation-status","title":"1. Check Escalation Status","text":"<ul> <li>Action: Agent calls check_escalation(escalation_id)</li> <li>Expected outcome: Returns EscalationRequest with current status</li> <li>System behavior:</li> <li>Looks up escalation in internal storage</li> <li>Returns pending, resolved, or expired status</li> <li>Raises EscalationError if not found</li> </ul>"},{"location":"user-journeys/AH-004-pending-escalation/#2-human-confirms-tentative-answer","title":"2. Human Confirms Tentative Answer","text":"<ul> <li>Action: Human reviewer confirms the agent's tentative answer</li> <li>Expected outcome: Escalation resolved with original answer</li> <li>System behavior:</li> <li>add_human_response(action=CONFIRM) called</li> <li>Escalation status set to \"resolved\"</li> <li>EscalationResult.escalation_resolved = True</li> <li>Original tentative answer becomes final</li> </ul>"},{"location":"user-journeys/AH-004-pending-escalation/#3-human-corrects-answer","title":"3. Human Corrects Answer","text":"<ul> <li>Action: Human reviewer provides corrected answer</li> <li>Expected outcome: New answer with 100% confidence</li> <li>System behavior:</li> <li>add_human_response(action=CORRECT, corrected_answer=\"...\")</li> <li>New Answer created with human as author</li> <li>Confidence set to 100%</li> <li>Escalation resolved</li> </ul>"},{"location":"user-journeys/AH-004-pending-escalation/#4-human-adds-context-needs-reroute","title":"4. Human Adds Context (Needs Reroute)","text":"<ul> <li>Action: Human provides additional context for re-query</li> <li>Expected outcome: Updated question ready for re-routing</li> <li>System behavior:</li> <li>add_human_response(action=ADD_CONTEXT, additional_context=\"...\")</li> <li>EscalationResult.needs_reroute = True</li> <li>Updated Question with appended context returned</li> <li>Caller can re-invoke ask_expert with new context</li> </ul>"},{"location":"user-journeys/AH-004-pending-escalation/#5-human-response-fed-back-to-session","title":"5. Human Response Fed Back to Session","text":"<ul> <li>Action: Human response automatically added to session</li> <li>Expected outcome: Session history includes human feedback</li> <li>System behavior:</li> <li>Message with role=HUMAN added to session</li> <li>Metadata includes responder, action, escalation_id</li> <li>Context preserved for future queries</li> </ul>"},{"location":"user-journeys/AH-004-pending-escalation/#success-criteria","title":"Success Criteria","text":"<ul> <li>check_escalation returns correct pending/resolved status</li> <li>CONFIRM action resolves with original answer</li> <li>CORRECT action creates new answer with 100% confidence</li> <li>ADD_CONTEXT sets needs_reroute flag</li> <li>Human messages appear in session history</li> <li>Non-existent escalation IDs raise EscalationError</li> </ul>"},{"location":"user-journeys/AH-004-pending-escalation/#e2e-test-coverage","title":"E2E Test Coverage","text":"<ul> <li>Test file: <code>tests/e2e/agent_hub/test_escalation_flow.py</code></li> <li>Journey marker: <code>@pytest.mark.journey(\"AH-004\")</code></li> <li>Test class: <code>TestPendingEscalationE2E</code></li> <li>Covered steps: All 5 steps (100% coverage)</li> <li>Test status: Passing (6/6 tests)</li> </ul>"},{"location":"user-journeys/AH-004-pending-escalation/#test-implementation-details","title":"Test Implementation Details","text":"<pre><code>@pytest.mark.journey(\"AH-004\")\nclass TestPendingEscalationE2E:\n    def test_check_escalation_returns_status_e2e(self):\n        \"\"\"Check escalation returns pending status.\"\"\"\n\n    def test_add_human_response_confirms_and_resolves_e2e(self):\n        \"\"\"CONFIRM action resolves the escalation.\"\"\"\n\n    def test_add_human_response_corrects_answer_e2e(self):\n        \"\"\"CORRECT action creates new 100% confidence answer.\"\"\"\n\n    def test_add_human_response_adds_context_for_reroute_e2e(self):\n        \"\"\"ADD_CONTEXT sets needs_reroute flag.\"\"\"\n\n    def test_human_response_fed_back_to_session_e2e(self):\n        \"\"\"Human response appears in session history.\"\"\"\n\n    def test_full_escalation_workflow_e2e(self):\n        \"\"\"Complete workflow: create, check, resolve.\"\"\"\n</code></pre>"},{"location":"user-journeys/AH-004-pending-escalation/#error-scenarios-tested","title":"Error Scenarios Tested","text":"Scenario Expected Behavior Test Location Escalation not found EscalationError raised <code>test_check_escalation_not_found_raises_error</code> (unit) CONFIRM action Resolves with original answer <code>test_add_human_response_confirms_and_resolves_e2e</code> CORRECT action New answer at 100% confidence <code>test_add_human_response_corrects_answer_e2e</code> ADD_CONTEXT action needs_reroute=True <code>test_add_human_response_adds_context_for_reroute_e2e</code> Session feedback HUMAN message added <code>test_human_response_fed_back_to_session_e2e</code>"},{"location":"user-journeys/AH-004-pending-escalation/#related-journeys","title":"Related Journeys","text":"<ul> <li>AH-001: Route Question (routing after ADD_CONTEXT)</li> <li>AH-002: Session Management (human feedback in sessions)</li> <li>AH-003: Confidence Escalation (creates escalations tracked here)</li> <li>AH-005: Audit Trail Logging (logs escalation resolutions)</li> </ul>"},{"location":"user-journeys/AH-004-pending-escalation/#api-reference","title":"API Reference","text":"<pre><code># Check escalation status\nescalation = hub.check_escalation(escalation_id)\nprint(f\"Status: {escalation.status}\")  # pending, resolved\n\n# Human confirms the answer\nresult = hub.add_human_response(\n    escalation_id=escalation_id,\n    action=HumanAction.CONFIRM,\n    responder=\"@farmer1st\",\n)\nassert result.escalation_resolved is True\n\n# Human corrects the answer\nresult = hub.add_human_response(\n    escalation_id=escalation_id,\n    action=HumanAction.CORRECT,\n    corrected_answer=\"Use Argon2id for password hashing\",\n    responder=\"@farmer1st\",\n)\nassert result.final_answer.confidence == 100\n\n# Human adds context for re-query\nresult = hub.add_human_response(\n    escalation_id=escalation_id,\n    action=HumanAction.ADD_CONTEXT,\n    additional_context=\"We need FIPS compliance\",\n    responder=\"@farmer1st\",\n)\nif result.needs_reroute:\n    # Re-query with updated context\n    new_response = hub.ask_expert(\n        topic=result.updated_question.topic,\n        question=result.updated_question.question,\n        context=result.updated_question.context,\n        feature_id=result.updated_question.feature_id,\n    )\n</code></pre>"},{"location":"user-journeys/AH-004-pending-escalation/#session-history-after-human-response","title":"Session History After Human Response","text":"<pre><code>session = hub.get_session(session_id)\nfor msg in session.messages:\n    if msg.role == MessageRole.HUMAN:\n        print(f\"Human ({msg.metadata['responder']}): {msg.content}\")\n        print(f\"Action: {msg.metadata['action']}\")\n</code></pre>"},{"location":"user-journeys/AH-004-pending-escalation/#implementation-references","title":"Implementation References","text":"<ul> <li>Spec: <code>specs/005-agent-hub-refactor/spec.md</code> (User Story 4)</li> <li>Contract: <code>specs/005-agent-hub-refactor/contracts/agent-hub-api.md</code></li> <li>Hub Code: <code>src/agent_hub/hub.py</code> (lines 315-409)</li> <li>Escalation Handler: <code>src/agent_hub/escalation.py</code></li> <li>E2E Tests: <code>tests/e2e/agent_hub/test_escalation_flow.py</code></li> <li>Unit Tests: <code>tests/unit/agent_hub/test_hub.py</code></li> </ul>"},{"location":"user-journeys/AH-004-pending-escalation/#notes","title":"Notes","text":"<ul> <li>Escalations are stored in <code>self._escalations</code> dict (in-memory for now)</li> <li>Future enhancement: persist to database for durability</li> <li>Human responses are fed back to the session that created the escalation</li> <li>NEEDS_REROUTE returns updated question with appended context</li> <li>Escalation status transitions: pending -&gt; resolved (or expired)</li> <li>Human responder must match pattern <code>@?[a-z0-9][a-z0-9-]*$</code></li> </ul>"},{"location":"user-journeys/AH-005-audit-logging/","title":"AH-005: Audit Trail Logging","text":"<p>Actor: Orchestration Agent (@baron PM Agent or similar) Goal: All Q&amp;A exchanges logged with full context for audit Preconditions: - AgentHub initialized with log_dir parameter - QALogger enabled for the hub instance</p> <p>Priority: P3 (Essential for retrospectives and knowledge improvement)</p>"},{"location":"user-journeys/AH-005-audit-logging/#overview","title":"Overview","text":"<p>This journey covers automatic audit trail logging of all Q&amp;A exchanges. When ask_expert is called, the AgentHub automatically: - Creates a QALogEntry with full exchange details - Includes session_id for conversation context - Captures escalation details when applicable - Writes logs to feature-specific JSONL files - Supports retrieval by feature_id</p>"},{"location":"user-journeys/AH-005-audit-logging/#steps","title":"Steps","text":""},{"location":"user-journeys/AH-005-audit-logging/#1-enable-logging-on-agenthub","title":"1. Enable Logging on AgentHub","text":"<ul> <li>Action: Initialize AgentHub with log_dir parameter</li> <li>Expected outcome: QALogger created for specified directory</li> <li>System behavior:</li> <li><code>log_dir</code> creates QALogger instance</li> <li>Directory created if it doesn't exist</li> <li>Each feature gets its own JSONL file</li> </ul>"},{"location":"user-journeys/AH-005-audit-logging/#2-ask-expert-logs-exchange","title":"2. Ask Expert Logs Exchange","text":"<ul> <li>Action: Call ask_expert() with any question</li> <li>Expected outcome: Exchange automatically logged</li> <li>System behavior:</li> <li>QALogEntry created with question, answer, validation</li> <li>Routing decision captured</li> <li>Duration tracked</li> <li>Log appended to feature JSONL file</li> </ul>"},{"location":"user-journeys/AH-005-audit-logging/#3-session-id-captured-in-logs","title":"3. Session ID Captured in Logs","text":"<ul> <li>Action: Exchange occurs within a session</li> <li>Expected outcome: session_id included in log entry</li> <li>System behavior:</li> <li>Log entry includes session_id field</li> <li>Enables correlation of multi-turn conversations</li> <li>Session history traceable via logs</li> </ul>"},{"location":"user-journeys/AH-005-audit-logging/#4-escalation-details-logged","title":"4. Escalation Details Logged","text":"<ul> <li>Action: Low-confidence answer triggers escalation</li> <li>Expected outcome: Escalation details included in log</li> <li>System behavior:</li> <li>EscalationRequest attached to log entry</li> <li>Escalation status recorded (pending)</li> <li>Threshold that triggered escalation captured</li> </ul>"},{"location":"user-journeys/AH-005-audit-logging/#5-retrieve-logs-by-feature","title":"5. Retrieve Logs by Feature","text":"<ul> <li>Action: Call get_logs_for_feature(feature_id)</li> <li>Expected outcome: All exchanges for feature returned</li> <li>System behavior:</li> <li>Reads feature's JSONL log file</li> <li>Returns list of log entries as dicts</li> <li>Empty list if no logs exist</li> </ul>"},{"location":"user-journeys/AH-005-audit-logging/#success-criteria","title":"Success Criteria","text":"<ul> <li>All ask_expert calls create log entries</li> <li>Log entries include session_id</li> <li>Escalation details captured when applicable</li> <li>Routing decision recorded</li> <li>Logs retrievable by feature_id</li> <li>Logging disabled when log_dir is None</li> </ul>"},{"location":"user-journeys/AH-005-audit-logging/#e2e-test-coverage","title":"E2E Test Coverage","text":"<ul> <li>Test file: <code>tests/e2e/agent_hub/test_qa_logging.py</code></li> <li>Journey marker: <code>@pytest.mark.journey(\"AH-005\")</code></li> <li>Test class: <code>TestAgentHubAuditLoggingE2E</code></li> <li>Covered steps: All 5 steps (100% coverage)</li> <li>Test status: Passing (5/5 tests)</li> </ul>"},{"location":"user-journeys/AH-005-audit-logging/#test-implementation-details","title":"Test Implementation Details","text":"<pre><code>@pytest.mark.journey(\"AH-005\")\nclass TestAgentHubAuditLoggingE2E:\n    def test_ask_expert_logs_exchange_automatically_e2e(self):\n        \"\"\"Exchanges are automatically logged.\"\"\"\n\n    def test_ask_expert_logs_escalation_details_e2e(self):\n        \"\"\"Escalation details included in logs.\"\"\"\n\n    def test_ask_expert_logs_session_id_e2e(self):\n        \"\"\"Session ID captured in log entries.\"\"\"\n\n    def test_multiple_ask_expert_calls_all_logged_e2e(self):\n        \"\"\"Multiple exchanges all logged.\"\"\"\n\n    def test_ask_expert_logs_routing_decision_e2e(self):\n        \"\"\"Routing decision recorded in logs.\"\"\"\n</code></pre>"},{"location":"user-journeys/AH-005-audit-logging/#error-scenarios-tested","title":"Error Scenarios Tested","text":"Scenario Expected Behavior Test Location Logging enabled All exchanges logged <code>test_ask_expert_logs_exchange_automatically_e2e</code> Escalation occurs Escalation in log <code>test_ask_expert_logs_escalation_details_e2e</code> Session context session_id in log <code>test_ask_expert_logs_session_id_e2e</code> Multiple calls All calls logged <code>test_multiple_ask_expert_calls_all_logged_e2e</code> Routing tracked Decision recorded <code>test_ask_expert_logs_routing_decision_e2e</code>"},{"location":"user-journeys/AH-005-audit-logging/#related-journeys","title":"Related Journeys","text":"<ul> <li>AH-001: Route Question (routing decision logged)</li> <li>AH-002: Session Management (session_id in logs)</li> <li>AH-003: Confidence Escalation (escalation details logged)</li> <li>AH-004: Track Pending Escalations (escalation status logged)</li> <li>KR-004: Log Q&amp;A Exchange (underlying logger)</li> </ul>"},{"location":"user-journeys/AH-005-audit-logging/#api-reference","title":"API Reference","text":"<pre><code># Enable logging when creating AgentHub\nhub = AgentHub(config, log_dir=\"/path/to/logs\")\n\n# Ask expert - exchange automatically logged\nresponse = hub.ask_expert(\n    topic=\"architecture\",\n    question=\"What pattern should we use?\",\n    feature_id=\"005-arch\",\n)\n\n# Retrieve logs for a feature\nlogs = hub.get_logs_for_feature(\"005-arch\")\nfor log in logs:\n    print(f\"Question: {log['question']['question']}\")\n    print(f\"Session: {log['session_id']}\")\n    print(f\"Confidence: {log['answer']['confidence']}%\")\n    if log['escalation']:\n        print(f\"Escalated: {log['escalation']['id']}\")\n</code></pre>"},{"location":"user-journeys/AH-005-audit-logging/#log-entry-structure","title":"Log Entry Structure","text":"<pre><code>{\n    \"id\": \"uuid\",\n    \"feature_id\": \"005-arch\",\n    \"question\": {...},           # Full Question object\n    \"answer\": {...},             # Full Answer object\n    \"validation_result\": {...},  # Outcome, threshold\n    \"escalation\": {...} | None,  # If escalated\n    \"final_answer\": {...},       # Final answer used\n    \"routing_decision\": \"Routed to architect (@duc) based on topic 'architecture'\",\n    \"total_duration_seconds\": 3.5,\n    \"session_id\": \"uuid\",        # Session context (T067)\n    \"created_at\": \"2026-01-05T...\"\n}\n</code></pre>"},{"location":"user-journeys/AH-005-audit-logging/#implementation-references","title":"Implementation References","text":"<ul> <li>Spec: <code>specs/005-agent-hub-refactor/spec.md</code> (User Story 5)</li> <li>Hub Code: <code>src/agent_hub/hub.py</code> (lines 465-514)</li> <li>Logger: <code>src/agent_hub/logger.py</code></li> <li>Models: <code>src/agent_hub/models.py::QALogEntry</code></li> <li>E2E Tests: <code>tests/e2e/agent_hub/test_qa_logging.py</code></li> <li>Unit Tests: <code>tests/unit/agent_hub/test_logger.py</code></li> </ul>"},{"location":"user-journeys/AH-005-audit-logging/#notes","title":"Notes","text":"<ul> <li>Logs stored as JSONL (one JSON object per line)</li> <li>Each feature gets its own log file: <code>{feature_id}.jsonl</code></li> <li>Logging is optional - pass <code>log_dir=None</code> to disable</li> <li>session_id enables correlation with session history</li> <li>Escalation details preserved for retrospective analysis</li> <li>Logs are append-only for audit trail integrity</li> </ul>"},{"location":"user-journeys/BRN-001-create-specification/","title":"BRN-001: Create Feature Specification Autonomously","text":"<p>Actor: Developer / Product Owner Goal: Create a complete feature specification (spec.md) from a natural language description Preconditions: - Baron agent is configured in <code>.claude/agents/baron/</code> - Claude CLI is installed and authenticated - <code>.specify/templates/spec-template.md</code> exists - <code>.specify/memory/constitution.md</code> is accessible</p> <p>Priority: P1 (Critical - Entry point for speckit workflow)</p>"},{"location":"user-journeys/BRN-001-create-specification/#steps","title":"Steps","text":""},{"location":"user-journeys/BRN-001-create-specification/#1-dispatch-baron-with-feature-description","title":"1. Dispatch Baron with Feature Description","text":"<ul> <li>Action: Call <code>BaronDispatcher.dispatch_specify()</code> with <code>SpecifyRequest</code></li> <li>Expected outcome: Baron agent is launched with the specify workflow</li> <li>System behavior:</li> <li>Builds dispatch prompt from <code>SpecifyRequest</code></li> <li>Loads system prompt from <code>.claude/agents/baron/system-prompt.md</code></li> <li>Executes via <code>ClaudeCLIRunner</code></li> </ul>"},{"location":"user-journeys/BRN-001-create-specification/#2-baron-creates-feature-directory","title":"2. Baron Creates Feature Directory","text":"<ul> <li>Action: Baron runs <code>.specify/scripts/bash/create-new-feature.sh</code></li> <li>Expected outcome: Feature directory created with format <code>specs/NNN-short-name/</code></li> <li>System behavior:</li> <li>Determines next feature number (or uses provided number)</li> <li>Creates branch with feature ID</li> <li>Initializes spec.md from template</li> </ul>"},{"location":"user-journeys/BRN-001-create-specification/#3-baron-loads-templates-and-constitution","title":"3. Baron Loads Templates and Constitution","text":"<ul> <li>Action: Baron reads spec-template.md and constitution.md</li> <li>Expected outcome: Template structure and principles available for spec generation</li> <li>System behavior:</li> <li>Reads <code>.specify/templates/spec-template.md</code></li> <li>Reads <code>.specify/memory/constitution.md</code></li> <li>Extracts mandatory sections and quality requirements</li> </ul>"},{"location":"user-journeys/BRN-001-create-specification/#4-baron-analyzes-feature-description","title":"4. Baron Analyzes Feature Description","text":"<ul> <li>Action: Baron parses natural language description to extract requirements</li> <li>Expected outcome: Key concepts identified (actors, actions, data, constraints)</li> <li>System behavior:</li> <li>Identifies user roles and personas</li> <li>Extracts functional requirements</li> <li>Determines success criteria</li> <li>Notes assumptions and dependencies</li> </ul>"},{"location":"user-journeys/BRN-001-create-specification/#5-baron-consults-experts-optional","title":"5. Baron Consults Experts (Optional)","text":"<ul> <li>Action: Baron uses <code>ask_expert</code> MCP tool for clarification</li> <li>Expected outcome: Domain-specific questions answered by appropriate expert</li> <li>System behavior:</li> <li>Routes architecture questions to @duc</li> <li>Routes product questions to @veuve</li> <li>Routes testing questions to @marie</li> <li>Maximum 3 expert consultations per workflow</li> </ul>"},{"location":"user-journeys/BRN-001-create-specification/#6-baron-fills-template-sections","title":"6. Baron Fills Template Sections","text":"<ul> <li>Action: Baron populates all mandatory spec sections</li> <li>Expected outcome: Complete spec.md with all required sections</li> <li>System behavior:</li> <li>Fills Summary, User Stories, Functional Requirements</li> <li>Fills Success Criteria, Scope, Assumptions</li> <li>Marks unclear items with <code>[NEEDS CLARIFICATION]</code></li> <li>Limits clarification markers to 3 maximum</li> </ul>"},{"location":"user-journeys/BRN-001-create-specification/#7-baron-creates-quality-checklist","title":"7. Baron Creates Quality Checklist","text":"<ul> <li>Action: Baron generates requirements checklist</li> <li>Expected outcome: Checklist file created at <code>specs/NNN-feature/checklists/requirements.md</code></li> <li>System behavior:</li> <li>Validates spec against quality criteria</li> <li>Documents content quality checks</li> <li>Tracks requirement completeness</li> </ul>"},{"location":"user-journeys/BRN-001-create-specification/#8-baron-returns-structured-result","title":"8. Baron Returns Structured Result","text":"<ul> <li>Action: Baron outputs JSON result between markers</li> <li>Expected outcome: <code>SpecifyResult</code> parsed with success status, paths, and metadata</li> <li>System behavior:</li> <li>Outputs <code>&lt;!-- BARON_RESULT_START --&gt;</code> marker</li> <li>Outputs JSON with success, spec_path, feature_id, branch_name, duration_seconds</li> <li>Outputs <code>&lt;!-- BARON_RESULT_END --&gt;</code> marker</li> </ul>"},{"location":"user-journeys/BRN-001-create-specification/#success-criteria","title":"Success Criteria","text":"<ul> <li>Spec Created: <code>spec.md</code> exists in feature directory</li> <li>Mandatory Sections Complete: Summary, User Stories, Functional Requirements, Success Criteria all populated</li> <li>Branch Created: Git branch exists with feature ID format</li> <li>Checklist Generated: <code>checklists/requirements.md</code> exists</li> <li>Result Parseable: JSON result between markers can be parsed into <code>SpecifyResult</code></li> <li>Duration Tracked: <code>duration_seconds</code> accurately reflects execution time</li> </ul>"},{"location":"user-journeys/BRN-001-create-specification/#integration-test-coverage","title":"Integration Test Coverage","text":"<ul> <li>Test file: <code>tests/integration/baron/test_specify_workflow.py</code></li> <li>Journey marker: <code>@pytest.mark.journey(\"BRN-001\")</code></li> <li>Test class: <code>TestSpecifyWorkflow</code></li> <li>Covered steps: Steps 1, 6, 7, 8 (mocked runner)</li> <li>Real agent test: <code>TestSpecifyWorkflowRealAgent</code> (manual execution)</li> </ul>"},{"location":"user-journeys/BRN-001-create-specification/#test-implementation-details","title":"Test Implementation Details","text":"<pre><code>@pytest.mark.journey(\"BRN-001\")\n@pytest.mark.integration\ndef test_dispatch_specify_creates_spec(dispatcher, mock_runner):\n    \"\"\"\n    Integration test for BRN-001: Create Feature Specification\n\n    Verifies:\n    - Step 1: Dispatch with feature description\n    - Step 8: Result parsing with spec path and feature ID\n    \"\"\"\n    request = SpecifyRequest(\n        feature_description=\"Add user authentication with OAuth2 support\"\n    )\n    result = dispatcher.dispatch_specify(request)\n\n    assert result.success is True\n    assert result.spec_path is not None\n</code></pre>"},{"location":"user-journeys/BRN-001-create-specification/#error-scenarios","title":"Error Scenarios","text":"Scenario Expected Behavior Test Location Empty description <code>ValidationError</code> raised <code>tests/unit/orchestrator/test_baron_models.py</code> Template not found <code>success: false</code> with error message <code>tests/integration/baron/test_specify_workflow.py</code> CLI not available <code>DispatchError</code> raised <code>tests/unit/orchestrator/test_baron_dispatch.py</code> Missing result markers <code>ParseError</code> raised <code>tests/unit/orchestrator/test_baron_dispatch.py</code> Invalid JSON in result <code>ParseError</code> raised <code>tests/unit/orchestrator/test_baron_dispatch.py</code>"},{"location":"user-journeys/BRN-001-create-specification/#related-journeys","title":"Related Journeys","text":"<ul> <li>BRN-002: Generate Implementation Plan (next step after spec creation)</li> <li>BRN-003: Generate Task List (follows plan generation)</li> <li>BRN-006: Constitution Compliance (applies to all Baron workflows)</li> </ul>"},{"location":"user-journeys/BRN-001-create-specification/#implementation-references","title":"Implementation References","text":"<ul> <li>Spec: <code>specs/006-baron-pm-agent/spec.md</code> (User Story 1)</li> <li>Plan: <code>specs/006-baron-pm-agent/plan.md</code></li> <li>Agent Config: <code>.claude/agents/baron/config.yaml</code></li> <li>System Prompt: <code>.claude/agents/baron/system-prompt.md</code></li> <li>Workflow: <code>.claude/agents/baron/workflows/specify.md</code></li> <li>Dispatcher: <code>src/orchestrator/baron_dispatch.py::dispatch_specify()</code></li> <li>Models: <code>src/orchestrator/baron_models.py</code></li> <li>Unit Tests: <code>tests/unit/orchestrator/test_baron_dispatch.py</code></li> <li>Integration Tests: <code>tests/integration/baron/test_specify_workflow.py</code></li> </ul>"},{"location":"user-journeys/BRN-001-create-specification/#notes","title":"Notes","text":"<ul> <li>This journey represents the entry point for the speckit workflow</li> <li>Baron is a prompt-driven Claude agent invoked via CLI subprocess</li> <li>Baron is NOT implemented using the <code>claude_code_sdk</code> Python library</li> <li>Most logic resides in prompts (<code>.claude/agents/baron/</code>)</li> <li>Python code is minimal (BaronDispatcher only)</li> <li>Expert consultation limited to 3 questions per workflow</li> <li>Clarification markers limited to 3 per spec</li> <li>Average execution time: 30-60 seconds (varies by feature complexity)</li> </ul>"},{"location":"user-journeys/BRN-002-generate-plan/","title":"BRN-002: Generate Implementation Plan","text":"<p>Actor: Developer / Architect Goal: Create a complete implementation plan with design artifacts from a feature specification Preconditions: - Baron agent is configured in <code>.claude/agents/baron/</code> - Claude CLI is installed and authenticated - spec.md exists for the feature - <code>.specify/templates/plan-template.md</code> exists - <code>.specify/memory/constitution.md</code> is accessible</p> <p>Priority: P1 (Critical - Required before task generation)</p>"},{"location":"user-journeys/BRN-002-generate-plan/#steps","title":"Steps","text":""},{"location":"user-journeys/BRN-002-generate-plan/#1-dispatch-baron-with-spec-path","title":"1. Dispatch Baron with Spec Path","text":"<ul> <li>Action: Call <code>BaronDispatcher.dispatch_plan()</code> with <code>PlanRequest</code></li> <li>Expected outcome: Baron agent is launched with the plan workflow</li> <li>System behavior:</li> <li>Builds dispatch prompt from <code>PlanRequest</code> including spec_path</li> <li>Loads system prompt from <code>.claude/agents/baron/system-prompt.md</code></li> <li>Executes via <code>ClaudeCLIRunner</code></li> </ul>"},{"location":"user-journeys/BRN-002-generate-plan/#2-baron-reads-specification","title":"2. Baron Reads Specification","text":"<ul> <li>Action: Baron reads spec.md from the provided path</li> <li>Expected outcome: Full spec loaded with requirements and success criteria</li> <li>System behavior:</li> <li>Reads spec.md file</li> <li>Extracts summary, user stories, functional requirements</li> <li>Identifies assumptions and constraints</li> </ul>"},{"location":"user-journeys/BRN-002-generate-plan/#3-baron-runs-setup-script","title":"3. Baron Runs Setup Script","text":"<ul> <li>Action: Baron executes <code>.specify/scripts/bash/setup-plan.sh --json</code></li> <li>Expected outcome: Plan directory prepared with template</li> <li>System behavior:</li> <li>Creates plan.md from template</li> <li>Sets up artifact directories</li> <li>Returns JSON with paths</li> </ul>"},{"location":"user-journeys/BRN-002-generate-plan/#4-baron-loads-constitution","title":"4. Baron Loads Constitution","text":"<ul> <li>Action: Baron reads <code>.specify/memory/constitution.md</code></li> <li>Expected outcome: Constitution principles loaded for compliance checking</li> <li>System behavior:</li> <li>Reads constitution document</li> <li>Identifies applicable principles (TDD, YAGNI, User Journeys)</li> <li>Prepares constitution check section</li> </ul>"},{"location":"user-journeys/BRN-002-generate-plan/#5-phase-0-research","title":"5. Phase 0: Research","text":"<ul> <li>Action: Baron generates research.md to resolve unknowns</li> <li>Expected outcome: All technology decisions documented with rationale</li> <li>System behavior:</li> <li>Identifies unknowns from spec (technology, architecture)</li> <li>Consults experts via <code>ask_expert</code> MCP tool (max 3 questions)</li> <li>Documents decisions, rationale, and alternatives</li> </ul>"},{"location":"user-journeys/BRN-002-generate-plan/#6-phase-1-design-artifacts","title":"6. Phase 1: Design Artifacts","text":"<ul> <li>Action: Baron generates data-model.md, contracts/, quickstart.md</li> <li>Expected outcome: Complete design documentation</li> <li>System behavior:</li> <li>Creates data-model.md with entities and relationships</li> <li>Creates OpenAPI/GraphQL schemas in contracts/</li> <li>Creates quickstart.md with development setup</li> </ul>"},{"location":"user-journeys/BRN-002-generate-plan/#7-baron-fills-plan-template","title":"7. Baron Fills Plan Template","text":"<ul> <li>Action: Baron completes plan.md with all sections</li> <li>Expected outcome: Complete implementation plan</li> <li>System behavior:</li> <li>Fills Technical Context section</li> <li>Fills Constitution Check section</li> <li>Fills User Journey Mapping (REQUIRED per Principle XI)</li> <li>Documents architecture decisions</li> </ul>"},{"location":"user-journeys/BRN-002-generate-plan/#8-baron-updates-agent-context","title":"8. Baron Updates Agent Context","text":"<ul> <li>Action: Baron runs <code>.specify/scripts/bash/update-agent-context.sh claude</code></li> <li>Expected outcome: Agent context updated with new technologies</li> <li>System behavior:</li> <li>Updates <code>.claude/CLAUDE.md</code> with technology stack</li> <li>Preserves manual additions</li> </ul>"},{"location":"user-journeys/BRN-002-generate-plan/#9-baron-returns-structured-result","title":"9. Baron Returns Structured Result","text":"<ul> <li>Action: Baron outputs JSON result between markers</li> <li>Expected outcome: <code>PlanResult</code> parsed with success status, paths, and metadata</li> <li>System behavior:</li> <li>Outputs <code>&lt;!-- BARON_RESULT_START --&gt;</code> marker</li> <li>Outputs JSON with plan_path, research_path, data_model_path, contracts_dir, quickstart_path</li> <li>Outputs <code>&lt;!-- BARON_RESULT_END --&gt;</code> marker</li> </ul>"},{"location":"user-journeys/BRN-002-generate-plan/#success-criteria","title":"Success Criteria","text":"<ul> <li>Plan Created: <code>plan.md</code> exists with all required sections</li> <li>Research Complete: <code>research.md</code> documents all technology decisions</li> <li>Data Model Defined: <code>data-model.md</code> defines entities and relationships</li> <li>Contracts Generated: <code>contracts/</code> contains API schemas</li> <li>Quickstart Written: <code>quickstart.md</code> provides development setup</li> <li>Constitution Checked: Constitution check section is filled</li> <li>User Journeys Mapped: Each user story has a journey ID</li> <li>Result Parseable: JSON result can be parsed into <code>PlanResult</code></li> </ul>"},{"location":"user-journeys/BRN-002-generate-plan/#integration-test-coverage","title":"Integration Test Coverage","text":"<ul> <li>Test file: <code>tests/integration/baron/test_plan_workflow.py</code></li> <li>Journey marker: <code>@pytest.mark.journey(\"BRN-002\")</code></li> <li>Test class: <code>TestPlanWorkflow</code></li> <li>Covered steps: Steps 1, 2, 6, 9 (mocked runner)</li> <li>Real agent test: <code>TestPlanWorkflowRealAgent</code> (manual execution)</li> </ul>"},{"location":"user-journeys/BRN-002-generate-plan/#test-implementation-details","title":"Test Implementation Details","text":"<pre><code>@pytest.mark.journey(\"BRN-002\")\n@pytest.mark.integration\ndef test_dispatch_plan_creates_all_artifacts(dispatcher, mock_runner):\n    \"\"\"\n    Integration test for BRN-002: Generate Implementation Plan\n\n    Verifies:\n    - Step 1: Dispatch with spec path\n    - Step 9: Result parsing with all artifact paths\n    \"\"\"\n    request = PlanRequest(spec_path=Path(\"specs/009-test-feature/spec.md\"))\n    result = dispatcher.dispatch_plan(request)\n\n    assert result.success is True\n    assert result.plan_path is not None\n    assert result.research_path is not None\n</code></pre>"},{"location":"user-journeys/BRN-002-generate-plan/#error-scenarios","title":"Error Scenarios","text":"Scenario Expected Behavior Test Location Spec not found <code>success: false</code> with error <code>tests/integration/baron/test_plan_workflow.py</code> CLI not available <code>DispatchError</code> raised <code>tests/unit/orchestrator/test_baron_dispatch.py</code> Blocked on escalation <code>blocked_on_escalation: true</code> <code>tests/integration/baron/test_plan_workflow.py</code> Missing result markers <code>ParseError</code> raised <code>tests/unit/orchestrator/test_baron_dispatch.py</code> Invalid JSON in result <code>ParseError</code> raised <code>tests/unit/orchestrator/test_baron_dispatch.py</code>"},{"location":"user-journeys/BRN-002-generate-plan/#related-journeys","title":"Related Journeys","text":"<ul> <li>BRN-001: Create Feature Specification (prerequisite)</li> <li>BRN-003: Generate Task List (next step)</li> <li>BRN-004: Handle Pending Escalations (when blocked)</li> <li>BRN-005: Expert Consultation Flow (during research phase)</li> <li>BRN-006: Constitution Compliance (applied throughout)</li> </ul>"},{"location":"user-journeys/BRN-002-generate-plan/#implementation-references","title":"Implementation References","text":"<ul> <li>Spec: <code>specs/006-baron-pm-agent/spec.md</code> (User Story 2)</li> <li>Plan: <code>specs/006-baron-pm-agent/plan.md</code></li> <li>Agent Config: <code>.claude/agents/baron/config.yaml</code></li> <li>System Prompt: <code>.claude/agents/baron/system-prompt.md</code></li> <li>Workflow: <code>.claude/agents/baron/workflows/plan.md</code></li> <li>Example: <code>.claude/agents/baron/examples/plan-prompt.md</code></li> <li>Dispatcher: <code>src/orchestrator/baron_dispatch.py::dispatch_plan()</code></li> <li>Models: <code>src/orchestrator/baron_models.py</code></li> <li>Unit Tests: <code>tests/unit/orchestrator/test_baron_dispatch.py</code></li> <li>Integration Tests: <code>tests/integration/baron/test_plan_workflow.py</code></li> </ul>"},{"location":"user-journeys/BRN-002-generate-plan/#notes","title":"Notes","text":"<ul> <li>This journey follows BRN-001 (specification creation)</li> <li>Creates multiple design artifacts in Phase 1</li> <li>May block on expert consultation (async escalation)</li> <li>Constitution check is mandatory per Principle XI</li> <li>User journey mapping required for each user story</li> <li>Average execution time: 2-5 minutes (varies by complexity)</li> <li>Force research flag regenerates research.md even if it exists</li> </ul>"},{"location":"user-journeys/BRN-003-generate-tasks/","title":"BRN-003: Generate Task List","text":"<p>Actor: Developer / Tech Lead Goal: Create an actionable, dependency-ordered task list from an implementation plan Preconditions: - Baron agent is configured in <code>.claude/agents/baron/</code> - Claude CLI is installed and authenticated - plan.md exists for the feature - spec.md, data-model.md, and contracts/ exist - <code>.specify/templates/tasks-template.md</code> exists - <code>.specify/memory/constitution.md</code> is accessible</p> <p>Priority: P1 (Critical - Required for implementation phase)</p>"},{"location":"user-journeys/BRN-003-generate-tasks/#steps","title":"Steps","text":""},{"location":"user-journeys/BRN-003-generate-tasks/#1-dispatch-baron-with-plan-path","title":"1. Dispatch Baron with Plan Path","text":"<ul> <li>Action: Call <code>BaronDispatcher.dispatch_tasks()</code> with <code>TasksRequest</code></li> <li>Expected outcome: Baron agent is launched with the tasks workflow</li> <li>System behavior:</li> <li>Builds dispatch prompt from <code>TasksRequest</code> including plan_path</li> <li>Loads system prompt from <code>.claude/agents/baron/system-prompt.md</code></li> <li>Executes via <code>ClaudeCLIRunner</code></li> </ul>"},{"location":"user-journeys/BRN-003-generate-tasks/#2-baron-reads-plan-and-supporting-documents","title":"2. Baron Reads Plan and Supporting Documents","text":"<ul> <li>Action: Baron reads plan.md, spec.md, data-model.md, contracts/</li> <li>Expected outcome: Full context loaded for task generation</li> <li>System behavior:</li> <li>Reads plan.md with technical context</li> <li>Reads spec.md for user stories</li> <li>Reads data-model.md for entity definitions</li> <li>Reads contracts/ for API endpoints</li> </ul>"},{"location":"user-journeys/BRN-003-generate-tasks/#3-baron-loads-tasks-template","title":"3. Baron Loads Tasks Template","text":"<ul> <li>Action: Baron reads <code>.specify/templates/tasks-template.md</code></li> <li>Expected outcome: Template structure understood</li> <li>System behavior:</li> <li>Parses template sections</li> <li>Notes format requirements (IDs, markers)</li> </ul>"},{"location":"user-journeys/BRN-003-generate-tasks/#4-baron-loads-constitution","title":"4. Baron Loads Constitution","text":"<ul> <li>Action: Baron reads <code>.specify/memory/constitution.md</code></li> <li>Expected outcome: TDD requirements identified</li> <li>System behavior:</li> <li>Reads Principle I: Test-First Development</li> <li>Enforces tests before implementation ordering</li> </ul>"},{"location":"user-journeys/BRN-003-generate-tasks/#5-baron-extracts-user-stories","title":"5. Baron Extracts User Stories","text":"<ul> <li>Action: Baron identifies user stories from spec.md</li> <li>Expected outcome: User stories mapped to journey IDs</li> <li>System behavior:</li> <li>Lists all user stories with IDs</li> <li>Maps to journey IDs from plan.md</li> <li>Groups related functionality</li> </ul>"},{"location":"user-journeys/BRN-003-generate-tasks/#6-baron-generates-task-list","title":"6. Baron Generates Task List","text":"<ul> <li>Action: Baron creates tasks organized by user story and phase</li> <li>Expected outcome: Complete task list with TDD ordering</li> <li>System behavior:</li> <li>Creates setup tasks</li> <li>Creates test tasks BEFORE implementation (TDD)</li> <li>Creates implementation tasks</li> <li>Creates integration test tasks</li> <li>Creates documentation tasks</li> </ul>"},{"location":"user-journeys/BRN-003-generate-tasks/#7-baron-applies-parallel-markers","title":"7. Baron Applies Parallel Markers","text":"<ul> <li>Action: Baron marks tasks that can run in parallel</li> <li>Expected outcome: <code>[P]</code> markers on independent tasks</li> <li>System behavior:</li> <li>Identifies tasks with no dependencies</li> <li>Marks with <code>[P]</code> for parallel execution</li> </ul>"},{"location":"user-journeys/BRN-003-generate-tasks/#8-baron-adds-checkpoints","title":"8. Baron Adds Checkpoints","text":"<ul> <li>Action: Baron adds phase boundaries and checkpoints</li> <li>Expected outcome: Clear phase structure with completion criteria</li> <li>System behavior:</li> <li>Groups tasks into phases</li> <li>Adds checkpoint markers</li> <li>Notes dependencies between phases</li> </ul>"},{"location":"user-journeys/BRN-003-generate-tasks/#9-baron-returns-structured-result","title":"9. Baron Returns Structured Result","text":"<ul> <li>Action: Baron outputs JSON result between markers</li> <li>Expected outcome: <code>TasksResult</code> parsed with task counts</li> <li>System behavior:</li> <li>Counts total tasks</li> <li>Counts test tasks (for TDD verification)</li> <li>Outputs duration</li> </ul>"},{"location":"user-journeys/BRN-003-generate-tasks/#success-criteria","title":"Success Criteria","text":"<ul> <li>Tasks Created: <code>tasks.md</code> exists with all required sections</li> <li>TDD Ordering: Test tasks appear before implementation tasks</li> <li>User Stories Covered: Every user story has associated tasks</li> <li>Parallel Markers: Independent tasks marked with <code>[P]</code></li> <li>Journey IDs: Integration tests reference journey IDs</li> <li>Documentation Tasks: User journey docs included</li> <li>Result Parseable: JSON result can be parsed into <code>TasksResult</code></li> <li>Test Count Positive: <code>test_count &gt; 0</code> (TDD requirement)</li> </ul>"},{"location":"user-journeys/BRN-003-generate-tasks/#integration-test-coverage","title":"Integration Test Coverage","text":"<ul> <li>Test file: <code>tests/integration/baron/test_tasks_workflow.py</code></li> <li>Journey marker: <code>@pytest.mark.journey(\"BRN-003\")</code></li> <li>Test class: <code>TestTasksWorkflow</code></li> <li>Covered steps: Steps 1, 2, 6, 9 (mocked runner)</li> <li>Real agent test: <code>TestTasksWorkflowRealAgent</code> (manual execution)</li> </ul>"},{"location":"user-journeys/BRN-003-generate-tasks/#test-implementation-details","title":"Test Implementation Details","text":"<pre><code>@pytest.mark.journey(\"BRN-003\")\n@pytest.mark.integration\ndef test_dispatch_tasks_verifies_tdd_ordering(dispatcher, mock_runner):\n    \"\"\"\n    Integration test for BRN-003: Generate Task List\n\n    Verifies:\n    - Step 6: Tasks generated with TDD ordering\n    - Step 9: Result includes test_count for TDD verification\n    \"\"\"\n    request = TasksRequest(plan_path=Path(\"specs/009-test-feature/plan.md\"))\n    result = dispatcher.dispatch_tasks(request)\n\n    assert result.success is True\n    assert result.test_count &gt; 0, \"TDD requires test tasks\"\n    assert result.test_count &lt;= result.task_count\n</code></pre>"},{"location":"user-journeys/BRN-003-generate-tasks/#error-scenarios","title":"Error Scenarios","text":"Scenario Expected Behavior Test Location Plan not found <code>success: false</code> with error <code>tests/integration/baron/test_tasks_workflow.py</code> CLI not available <code>DispatchError</code> raised <code>tests/unit/orchestrator/test_baron_dispatch.py</code> Missing result markers <code>ParseError</code> raised <code>tests/unit/orchestrator/test_baron_dispatch.py</code> Invalid JSON in result <code>ParseError</code> raised <code>tests/unit/orchestrator/test_baron_dispatch.py</code>"},{"location":"user-journeys/BRN-003-generate-tasks/#related-journeys","title":"Related Journeys","text":"<ul> <li>BRN-001: Create Feature Specification (prerequisite)</li> <li>BRN-002: Generate Implementation Plan (prerequisite)</li> <li>BRN-006: Constitution Compliance (TDD enforcement)</li> </ul>"},{"location":"user-journeys/BRN-003-generate-tasks/#implementation-references","title":"Implementation References","text":"<ul> <li>Spec: <code>specs/006-baron-pm-agent/spec.md</code> (User Story 3)</li> <li>Plan: <code>specs/006-baron-pm-agent/plan.md</code></li> <li>Agent Config: <code>.claude/agents/baron/config.yaml</code></li> <li>System Prompt: <code>.claude/agents/baron/system-prompt.md</code></li> <li>Workflow: <code>.claude/agents/baron/workflows/tasks.md</code></li> <li>Example: <code>.claude/agents/baron/examples/tasks-prompt.md</code></li> <li>Dispatcher: <code>src/orchestrator/baron_dispatch.py::dispatch_tasks()</code></li> <li>Models: <code>src/orchestrator/baron_models.py</code></li> <li>Unit Tests: <code>tests/unit/orchestrator/test_baron_dispatch.py</code></li> <li>Integration Tests: <code>tests/integration/baron/test_tasks_workflow.py</code></li> </ul>"},{"location":"user-journeys/BRN-003-generate-tasks/#notes","title":"Notes","text":"<ul> <li>This journey follows BRN-002 (plan generation)</li> <li>Final step before implementation begins</li> <li>TDD enforcement is non-negotiable per Constitution Principle I</li> <li>Test tasks must appear before implementation tasks</li> <li><code>test_count</code> should be 30-50% of <code>task_count</code> for good TDD coverage</li> <li>Average execution time: 30-60 seconds</li> <li>Large features may have 50+ tasks</li> </ul>"},{"location":"user-journeys/JOURNEYS/","title":"User Journeys","text":"<p>Complete list of all user journeys for Farmer Code orchestrator.</p>"},{"location":"user-journeys/JOURNEYS/#journey-domains","title":"Journey Domains","text":"Domain Description ORC Orchestrator - AI agent workflow orchestration and SDLC management WT Worktree - Git worktree and branch management for isolated development AH Agent Hub - Central coordination layer for agent interactions (legacy) BRN Baron PM Agent - Product management agent for speckit workflows SVC Services Architecture - Microservices-based agent orchestration GH GitHub - Direct GitHub integration operations (future) UI User Interface - Web/TUI user interactions (future)"},{"location":"user-journeys/JOURNEYS/#all-journeys","title":"All Journeys","text":"Journey ID Name Priority Status Test Coverage E2E Tests ORC-001 Create Issue for New Feature Request P1 \u2705 Implemented \u2705 100% 1/1 passing ORC-002 Agent Provides Feedback via Comment P2 \ud83d\udccb Planned \u23f3 0% 0/0 tests ORC-003 Progress Issue Through Workflow Phases P2 \ud83d\udccb Planned \u23f3 0% 0/0 tests ORC-004 Link Pull Request to Feature Issue P3 \ud83d\udccb Planned \u23f3 0% 0/0 tests ORC-005 Complete 8-Phase SDLC Workflow P1 \u2705 Implemented \u2705 100% 1/1 passing WT-001 Create Worktree for Feature Development P1 \u2705 Implemented \u2705 100% 1/1 passing WT-002 Initialize Plans Folder Structure P1 \u2705 Implemented \u2705 100% 1/1 passing WT-003 Commit and Push Feature Changes P2 \u2705 Implemented \u2705 100% 1/1 passing WT-004 Cleanup Worktree After Feature Completion P2 \u2705 Implemented \u2705 100% 1/1 passing AH-001 Route Question to Expert Agent P1 \u2705 Implemented \u2705 100% 3/3 passing AH-002 Maintain Conversation Sessions P1 \u2705 Implemented \u2705 100% 6/6 passing AH-003 Validate Confidence and Escalate P2 \u2705 Implemented \u2705 100% 5/5 passing AH-004 Track Pending Escalations P2 \u2705 Implemented \u2705 100% 6/6 passing AH-005 Audit Trail Logging P3 \u2705 Implemented \u2705 100% 5/5 passing BRN-001 Create Feature Specification P1 \u2705 Implemented \u2705 100% 6/6 passing BRN-002 Generate Implementation Plan P1 \u2705 Implemented \u2705 100% 7/7 passing BRN-003 Generate Task List P1 \u2705 Implemented \u2705 100% 7/7 passing BRN-004 Handle Pending Escalations P2 \ud83d\udccb Planned \u23f3 0% 0/0 tests BRN-005 Expert Consultation Flow P2 \ud83d\udccb Planned \u23f3 0% 0/0 tests BRN-006 Constitution Compliance P2 \ud83d\udccb Planned \u23f3 0% 0/0 tests SVC-001 Orchestrator Workflow Execution P1 \u2705 Implemented \u2705 100% 3/3 passing SVC-002 Expert Agent Consultation P1 \u2705 Implemented \u2705 100% 5/5 passing SVC-003 Human Review Escalation P1 \u2705 Implemented \u2705 100% 4/4 passing SVC-004 Multi-Turn Session P2 \u2705 Implemented \u2705 100% 6/6 passing SVC-005 Stateless Agent Invocation P1 \u2705 Implemented \u2705 100% 8/8 passing SVC-006 Local Development Setup P2 \u2705 Implemented \u2705 100% 2/2 passing SVC-007 Audit Log Query P3 \u2705 Implemented \u2705 100% 5/5 passing"},{"location":"user-journeys/JOURNEYS/#status-legend","title":"Status Legend","text":"<ul> <li>\u2705 Implemented: Fully implemented with passing tests</li> <li>\ud83d\udea7 In Progress: Currently being developed</li> <li>\ud83d\udccb Planned: Designed but not yet implemented</li> <li>\u23f8\ufe0f Paused: Development temporarily halted</li> <li>\u274c Deprecated: No longer supported</li> </ul>"},{"location":"user-journeys/JOURNEYS/#coverage-by-priority","title":"Coverage by Priority","text":""},{"location":"user-journeys/JOURNEYS/#p1-journeys-critical-required-for-mvp","title":"P1 Journeys (Critical - Required for MVP)","text":"ID Name Status Coverage ORC-001 Create Issue for New Feature Request \u2705 Implemented 100% ORC-005 Complete 8-Phase SDLC Workflow \u2705 Implemented 100% (partial) WT-001 Create Worktree for Feature Development \u2705 Implemented 100% WT-002 Initialize Plans Folder Structure \u2705 Implemented 100% AH-001 Route Question to Expert Agent \u2705 Implemented 100% AH-002 Maintain Conversation Sessions \u2705 Implemented 100% BRN-001 Create Feature Specification \u2705 Implemented 100% BRN-002 Generate Implementation Plan \u2705 Implemented 100% BRN-003 Generate Task List \u2705 Implemented 100% SVC-001 Orchestrator Workflow Execution \u2705 Implemented 100% SVC-002 Expert Agent Consultation \u2705 Implemented 100% SVC-003 Human Review Escalation \u2705 Implemented 100% SVC-005 Stateless Agent Invocation \u2705 Implemented 100% <p>P1 Coverage: 13/13 implemented (100%)</p>"},{"location":"user-journeys/JOURNEYS/#p2-journeys-important-post-mvp","title":"P2 Journeys (Important - Post-MVP)","text":"ID Name Status Coverage ORC-002 Agent Provides Feedback via Comment \ud83d\udccb Planned 0% ORC-003 Progress Issue Through Workflow Phases \ud83d\udccb Planned 0% WT-003 Commit and Push Feature Changes \u2705 Implemented 100% WT-004 Cleanup Worktree After Feature Completion \u2705 Implemented 100% AH-003 Validate Confidence and Escalate \u2705 Implemented 100% AH-004 Track Pending Escalations \u2705 Implemented 100% BRN-004 Handle Pending Escalations \ud83d\udccb Planned 0% BRN-005 Expert Consultation Flow \ud83d\udccb Planned 0% BRN-006 Constitution Compliance \ud83d\udccb Planned 0% SVC-004 Multi-Turn Session \u2705 Implemented 100% SVC-006 Local Development Setup \u2705 Implemented 100% <p>P2 Coverage: 6/11 implemented (55%)</p>"},{"location":"user-journeys/JOURNEYS/#p3-journeys-nice-to-have","title":"P3 Journeys (Nice to Have)","text":"ID Name Status Coverage ORC-004 Link Pull Request to Feature Issue \ud83d\udccb Planned 0% AH-005 Audit Trail Logging \u2705 Implemented 100% SVC-007 Audit Log Query \u2705 Implemented 100% <p>P3 Coverage: 2/3 implemented (67%)</p>"},{"location":"user-journeys/JOURNEYS/#test-coverage-visualization","title":"Test Coverage Visualization","text":"<pre><code>Overall Journey Coverage:\nORC-001: \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 100% (1/1 E2E tests passing)\nORC-002: \u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591   0% (not yet implemented)\nORC-003: \u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591   0% (not yet implemented)\nORC-004: \u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591   0% (not yet implemented)\nORC-005: \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 100% (1/1 E2E tests passing)\nWT-001:  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 100% (1/1 E2E tests passing)\nWT-002:  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 100% (1/1 E2E tests passing)\nWT-003:  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 100% (1/1 E2E tests passing)\nWT-004:  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 100% (1/1 E2E tests passing)\nAH-001:  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 100% (3/3 E2E tests passing)\nAH-002:  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 100% (6/6 E2E tests passing)\nAH-003:  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 100% (5/5 E2E tests passing)\nAH-004:  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 100% (6/6 E2E tests passing)\nAH-005:  \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 100% (5/5 E2E tests passing)\nBRN-001: \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 100% (6/6 E2E tests passing)\nBRN-002: \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 100% (7/7 E2E tests passing)\nBRN-003: \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 100% (7/7 E2E tests passing)\nBRN-004: \u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591   0% (not yet implemented)\nBRN-005: \u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591   0% (not yet implemented)\nBRN-006: \u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591\u2591   0% (not yet implemented)\nSVC-001: \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 100% (3/3 E2E tests passing)\nSVC-002: \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 100% (5/5 E2E tests passing)\nSVC-003: \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 100% (4/4 E2E tests passing)\nSVC-004: \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 100% (6/6 E2E tests passing)\nSVC-005: \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 100% (8/8 E2E tests passing)\nSVC-006: \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 100% (2/2 E2E tests passing)\nSVC-007: \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588 100% (5/5 E2E tests passing)\n\nTotal: 21/27 journeys implemented (78%)\nP1 Journeys: 13/13 implemented (100%) \u2705\nP2 Journeys: 6/11 implemented (55%)\nP3 Journeys: 2/3 implemented (67%)\n</code></pre>"},{"location":"user-journeys/JOURNEYS/#journeys-by-feature","title":"Journeys by Feature","text":""},{"location":"user-journeys/JOURNEYS/#feature-001-github-integration-core","title":"Feature 001: GitHub Integration Core","text":"User Story Journeys Status US1: Create and Track Issues ORC-001 \u2705 Implemented US2: Capture Agent Feedback ORC-002 \ud83d\udccb Planned US3: Manage Workflow State ORC-003 \ud83d\udccb Planned US4: Link PRs to Issues ORC-004 \ud83d\udccb Planned All Stories Combined ORC-005 \u2705 Partial"},{"location":"user-journeys/JOURNEYS/#feature-002-git-worktree-manager","title":"Feature 002: Git Worktree Manager","text":"User Story Journeys Status US1: Create Worktree WT-001 \u2705 Implemented US2: Manage Plans Folder WT-002 \u2705 Implemented US3: Commit and Push Changes WT-003 \u2705 Implemented US4: Cleanup Worktree WT-004 \u2705 Implemented"},{"location":"user-journeys/JOURNEYS/#feature-003-orchestrator-state-machine","title":"Feature 003: Orchestrator State Machine","text":"User Story Journeys Status US1-3: State Machine Phases ORC-005 \u2705 Implemented"},{"location":"user-journeys/JOURNEYS/#feature-005-agent-hub","title":"Feature 005: Agent Hub","text":"User Story Journeys Status US1: Route Questions to Experts AH-001 \u2705 Implemented US2: Maintain Conversation Sessions AH-002 \u2705 Implemented US3: Validate Confidence and Escalate AH-003 \u2705 Implemented US4: Track Pending Escalations AH-004 \u2705 Implemented US5: Audit Trail Logging AH-005 \u2705 Implemented"},{"location":"user-journeys/JOURNEYS/#feature-006-baron-pm-agent","title":"Feature 006: Baron PM Agent","text":"User Story Journeys Status US1: Create Feature Specification BRN-001 \u2705 Implemented US2: Generate Implementation Plan BRN-002 \u2705 Implemented US3: Generate Task List BRN-003 \u2705 Implemented US4: Handle Pending Escalations BRN-004 \ud83d\udccb Planned US5: Expert Consultation Flow BRN-005 \ud83d\udccb Planned US6: Constitution Compliance BRN-006 \ud83d\udccb Planned"},{"location":"user-journeys/JOURNEYS/#feature-008-services-architecture","title":"Feature 008: Services Architecture","text":"User Story Journeys Status US1: Orchestrator Workflow Execution SVC-001 \u2705 Implemented US2: Expert Agent Consultation SVC-002 \u2705 Implemented US3: Human Review Escalation SVC-003 \u2705 Implemented US4: Multi-Turn Session SVC-004 \u2705 Implemented US5: Stateless Agent Invocation SVC-005 \u2705 Implemented US6: Local Development Setup SVC-006 \u2705 Implemented US7: Audit Log Query SVC-007 \u2705 Implemented"},{"location":"user-journeys/JOURNEYS/#future-features","title":"Future Features","text":"Feature Journeys Status Feature 007: TUI Interface UI-001 to UI-010 \ud83d\udd2e Not yet planned"},{"location":"user-journeys/JOURNEYS/#running-journey-tests","title":"Running Journey Tests","text":"<pre><code># Run all journey-tagged tests\npytest -m journey -v\n\n# Run specific journey\npytest -m \"journey('ORC-001')\" -v\n\n# Generate journey coverage report (automatically shown at end of test run)\npytest -m journey\n\n# See which tests are tagged with journeys\npytest --co -m journey\n</code></pre>"},{"location":"user-journeys/JOURNEYS/#journey-coverage-goals","title":"Journey Coverage Goals","text":"<p>Release Criteria: - v1.0 (MVP): All P1 journeys 100% tested \u2705 ACHIEVED - v1.1: 80%+ of P2 journeys tested - v1.2: All P2 journeys 100% tested - v2.0: All P3 journeys tested</p> <p>Current Status: v1.0 MVP ready (P1 journeys complete)</p>"},{"location":"user-journeys/JOURNEYS/#related-documentation","title":"Related Documentation","text":"<ul> <li>Journey Documentation Guide - How to write and maintain journey docs</li> <li>Constitution - Principle XI - Journey standards</li> <li>E2E Test Guide - How to write journey tests (future)</li> <li>SDLC Workflow Reference - The 8-phase workflow</li> </ul>"},{"location":"user-journeys/JOURNEYS/#last-updated","title":"Last Updated","text":"<p>Date: 2026-01-05 By: Feature 008 Services Architecture - All User Stories Complete (P1 MVP) Next Review: After implementing Baron P2 features (US4-6)</p>"},{"location":"user-journeys/ORC-001-create-issue/","title":"ORC-001: Create Issue for New Feature Request","text":"<p>Actor: Product Owner / Development Lead Goal: Create a GitHub issue to track a new feature through the 8-phase SDLC workflow Preconditions: - GitHub App is installed on target repository - User has repository access - <code>.env</code> file configured with GitHub App credentials</p> <p>Priority: P1 (Critical - Foundation for entire workflow)</p>"},{"location":"user-journeys/ORC-001-create-issue/#steps","title":"Steps","text":""},{"location":"user-journeys/ORC-001-create-issue/#1-initialize-githubservice","title":"1. Initialize GitHubService","text":"<ul> <li>Action: Instantiate <code>GitHubService</code> with App credentials</li> <li>Expected outcome: Service successfully authenticates with GitHub</li> <li>System behavior:</li> <li>Validates PEM file exists and has correct permissions (600)</li> <li>Generates JWT for GitHub App authentication</li> <li>Fetches installation access token (cached for 1 hour)</li> </ul>"},{"location":"user-journeys/ORC-001-create-issue/#2-create-issue-with-required-metadata","title":"2. Create Issue with Required Metadata","text":"<ul> <li>Action: Call <code>create_issue()</code> with title, body, labels, and assignees</li> <li>Expected outcome: Issue is created on GitHub with:</li> <li>Unique issue number</li> <li><code>state: \"open\"</code></li> <li>Initial label (e.g., <code>status:new</code>)</li> <li>Assignment to architect agent (e.g., <code>@duc</code>)</li> <li>System behavior:</li> <li>Validates input with Pydantic (title 1-256 chars, non-empty)</li> <li>Makes POST /repos/{owner}/{repo}/issues API call</li> <li>Handles rate limits and retries (3 attempts, 1s delay)</li> <li>Returns fully populated <code>Issue</code> model</li> </ul>"},{"location":"user-journeys/ORC-001-create-issue/#3-verify-issue-is-retrievable","title":"3. Verify Issue is Retrievable","text":"<ul> <li>Action: Fetch issue by number using <code>get_issue(issue_number)</code></li> <li>Expected outcome: Retrieved issue matches created issue</li> <li>System behavior:</li> <li>Makes GET /repos/{owner}/{repo}/issues/{number} API call</li> <li>Parses GitHub response into <code>Issue</code> model</li> <li>Returns issue with all fields populated</li> </ul>"},{"location":"user-journeys/ORC-001-create-issue/#4-verify-issue-appears-in-lists","title":"4. Verify Issue Appears in Lists","text":"<ul> <li>Action: Query issues using <code>list_issues()</code> with filters</li> <li>Expected outcome: Created issue appears in:</li> <li>Open issues list (<code>state=\"open\"</code>)</li> <li>Label-filtered lists (<code>labels=[\"status:new\"]</code>)</li> <li>System behavior:</li> <li>Makes GET /repos/{owner}/{repo}/issues API call with query params</li> <li>Handles eventual consistency (may require polling)</li> <li>Returns list of matching issues</li> </ul>"},{"location":"user-journeys/ORC-001-create-issue/#success-criteria","title":"Success Criteria","text":"<p>\u2705 Issue Created: Issue number &gt; 0, state = \"open\" \u2705 Metadata Populated: Title, body, labels, assignees all match input \u2705 Retrievable: <code>get_issue()</code> returns identical data \u2705 Indexed: Issue appears in filtered lists (with eventual consistency handling) \u2705 Persisted: Issue visible in GitHub web UI \u2705 Logged: Structured JSON logs capture operation with context</p>"},{"location":"user-journeys/ORC-001-create-issue/#e2e-test-coverage","title":"E2E Test Coverage","text":"<ul> <li>Test file: <code>tests/e2e/test_github_operations.py</code></li> <li>Journey marker: <code>@pytest.mark.journey(\"ORC-001\")</code></li> <li>Test method: <code>TestFullIssueLifecycle::test_full_issue_lifecycle</code></li> <li>Covered steps: All 4 steps (100% coverage)</li> <li>Test status: \u2705 Passing (as of 2026-01-02)</li> </ul>"},{"location":"user-journeys/ORC-001-create-issue/#test-implementation-details","title":"Test Implementation Details","text":"<pre><code>@pytest.mark.e2e\n@pytest.mark.journey(\"ORC-001\")\ndef test_full_issue_lifecycle(service, auto_cleanup_issue):\n    \"\"\"\n    E2E test for ORC-001: Create Issue for New Feature Request\n\n    Verifies:\n    - Step 1: Service initialization (via fixture)\n    - Step 2: Issue creation with metadata\n    - Step 3: Issue retrieval by number\n    - Step 4: Issue appears in lists (with polling for eventual consistency)\n    \"\"\"\n    # Test implementation validates all success criteria\n</code></pre>"},{"location":"user-journeys/ORC-001-create-issue/#eventual-consistency-handling","title":"Eventual Consistency Handling","text":"<p>GitHub API has eventual consistency for list/filter operations. The test uses polling helpers: - <code>wait_for_issue_in_list()</code>: Polls until issue appears in list (10s timeout, 0.5s interval) - Ensures test reliability despite GitHub's indexing delay</p>"},{"location":"user-journeys/ORC-001-create-issue/#error-scenarios-tested","title":"Error Scenarios Tested","text":"Scenario Expected Behavior Test Location Empty title <code>ValidationError</code> raised <code>tests/contract/test_service_interface.py::test_create_issue_with_missing_required_field</code> Title too long (&gt;256 chars) <code>ValidationError</code> raised Same as above Invalid credentials <code>AuthenticationError</code> raised <code>tests/unit/test_auth.py</code> (future) Rate limit exceeded <code>RateLimitExceeded</code> raised, retry after delay <code>tests/unit/test_client.py</code> (future) Network error Retry 3 times with 1s delay <code>tests/integration/test_service_integration.py</code>"},{"location":"user-journeys/ORC-001-create-issue/#related-journeys","title":"Related Journeys","text":"<ul> <li>ORC-005: Complete 8-Phase SDLC Workflow (includes this journey as Phase 1)</li> <li>ORC-002: Agent Provides Feedback via Comment (next step after issue creation)</li> <li>ORC-003: Progress Issue Through Workflow Phases (state transitions)</li> </ul>"},{"location":"user-journeys/ORC-001-create-issue/#implementation-references","title":"Implementation References","text":"<ul> <li>Spec: <code>specs/001-github-integration-core/spec.md</code> (User Story 1)</li> <li>Contract: <code>specs/001-github-integration-core/contracts/github_service.md</code></li> <li>Code: <code>src/github_integration/service.py::create_issue()</code></li> <li>Tests: <code>tests/e2e/test_github_operations.py::test_full_issue_lifecycle()</code></li> </ul>"},{"location":"user-journeys/ORC-001-create-issue/#notes","title":"Notes","text":"<ul> <li>This journey represents Phase 1 of the 8-phase SDLC workflow</li> <li>Labels used: <code>status:new</code> (initial state)</li> <li>Typical assignee: <code>@duc</code> (architecture agent)</li> <li>Average execution time: ~2 seconds (including GitHub API calls)</li> <li>Cleanup: Test issues tagged with <code>test:automated</code> are closed automatically</li> </ul>"},{"location":"user-journeys/ORC-002-agent-feedback/","title":"ORC-002: Agent Provides Feedback via Comment","text":"<p>Actor: AI Agent (e.g., @duc, @dede, @marie) Goal: Provide feedback on issue progress through structured GitHub comments Preconditions: - Issue exists (created via ORC-001) - Agent has completed assigned task - GitHubService available</p> <p>Priority: P2 (Important for workflow automation) Status: \ud83d\udccb Planned (not yet implemented)</p>"},{"location":"user-journeys/ORC-002-agent-feedback/#steps","title":"Steps","text":""},{"location":"user-journeys/ORC-002-agent-feedback/#1-agent-completes-task","title":"1. Agent Completes Task","text":"<ul> <li>Action: Agent finishes architecture design, implementation, or review</li> <li>Expected outcome: Agent has feedback to share with team</li> <li>System behavior: Agent determines next steps in workflow</li> </ul>"},{"location":"user-journeys/ORC-002-agent-feedback/#2-post-comment-with-signal","title":"2. Post Comment with Signal","text":"<ul> <li>Action: Call <code>add_comment(issue_number, body, mentions)</code> with structured content</li> <li>Expected outcome: Comment posted to GitHub issue</li> <li>System behavior:</li> <li>Makes POST /repos/{owner}/{repo}/issues/{issue_number}/comments</li> <li>Comment includes:<ul> <li>Status signal (\u2705 for completion, \u274c for blocking issue)</li> <li>Summary of work completed</li> <li>Mention of next agent (<code>@agent-name</code>)</li> <li>Artifacts created (links to files)</li> </ul> </li> </ul>"},{"location":"user-journeys/ORC-002-agent-feedback/#3-extract-comment-metadata","title":"3. Extract Comment Metadata","text":"<ul> <li>Action: Parse comment for signals and mentions</li> <li>Expected outcome: System extracts:</li> <li>Agent name</li> <li>Status (approved/rejected/question)</li> <li>Mentioned users</li> <li>Linked artifacts</li> <li>System behavior:</li> <li>Uses <code>Comment.contains_signal()</code> helper</li> <li>Uses <code>Comment.extract_mentions()</code> helper</li> <li>Updates workflow state based on signals</li> </ul>"},{"location":"user-journeys/ORC-002-agent-feedback/#4-notify-next-agent","title":"4. Notify Next Agent","text":"<ul> <li>Action: GitHub mentions trigger notifications</li> <li>Expected outcome: Next agent receives notification</li> <li>System behavior: GitHub sends notification to mentioned user</li> </ul>"},{"location":"user-journeys/ORC-002-agent-feedback/#success-criteria","title":"Success Criteria","text":"<p>\u2705 Comment Posted: Comment visible on issue \u2705 Signal Recognized: System detects \u2705 or \u274c status \u2705 Mentions Extracted: All @mentions parsed correctly \u2705 Workflow Progresses: Next agent notified and begins work \u2705 Audit Trail: Complete comment history visible</p>"},{"location":"user-journeys/ORC-002-agent-feedback/#e2e-test-coverage","title":"E2E Test Coverage","text":"<ul> <li>Test file: <code>tests/e2e/test_agent_comments.py</code> (future)</li> <li>Journey marker: <code>@pytest.mark.journey(\"ORC-002\")</code></li> <li>Test method: Not yet implemented</li> <li>Covered steps: 0/4 (0% coverage)</li> <li>Test status: \u23f3 Not implemented</li> </ul>"},{"location":"user-journeys/ORC-002-agent-feedback/#implementation-status","title":"Implementation Status","text":"<p>User Story 2 from <code>specs/001-github-integration-core/spec.md</code>: - Add Comment: <code>add_comment(issue_number, body, mentions)</code> \u2192 Not implemented - List Comments: <code>list_comments(issue_number)</code> \u2192 Not implemented - Comment Model: <code>Comment</code> with <code>contains_signal()</code> and <code>extract_mentions()</code> \u2192 Model exists, methods not implemented</p>"},{"location":"user-journeys/ORC-002-agent-feedback/#example-comment-structure","title":"Example Comment Structure","text":"<pre><code>\u2705 **Architecture specs complete**\n\nDesigned system with:\n- 3 Pydantic models (Issue, Comment, Label)\n- 5 service methods (create_issue, get_issue, list_issues, add_comment, list_comments)\n- Contract tests for all operations\n\n**Artifacts**:\n- spec.md\n- data-model.md\n- contracts/github_service.md\n\nReady for implementation planning. @dede please review and create plan.md\n</code></pre>"},{"location":"user-journeys/ORC-002-agent-feedback/#related-journeys","title":"Related Journeys","text":"<ul> <li>ORC-001: Create Issue (prerequisite - issue must exist)</li> <li>ORC-003: Progress Issue Through Workflow Phases (comments trigger state transitions)</li> <li>ORC-005: Complete SDLC Workflow (comments are Phase 3 communication)</li> </ul>"},{"location":"user-journeys/ORC-002-agent-feedback/#implementation-references","title":"Implementation References","text":"<ul> <li>Spec: <code>specs/001-github-integration-core/spec.md</code> (User Story 2)</li> <li>Contract: <code>specs/001-github-integration-core/contracts/github_service.md</code> (future)</li> <li>Model: <code>src/github_integration/models.py::Comment</code></li> <li>Service: <code>src/github_integration/service.py::add_comment()</code> (future)</li> </ul>"},{"location":"user-journeys/ORC-002-agent-feedback/#notes","title":"Notes","text":"<ul> <li>Comments use markdown formatting for rich content</li> <li>Signals (\u2705/\u274c) enable automated workflow detection</li> <li>Mentions (@agent-name) create GitHub notifications</li> <li>This journey is critical for Phase 3 (Implementation Plans) of ORC-005</li> </ul>"},{"location":"user-journeys/ORC-003-workflow-progression/","title":"ORC-003: Progress Issue Through Workflow Phases","text":"<p>Actor: Orchestrator System + AI Agents Goal: Transition issue through 8 workflow phases using labels to track state Preconditions: - Issue exists (created via ORC-001) - Labels configured in repository:   - <code>status:new</code>   - <code>status:specs-ready</code>   - <code>status:planned</code>   - <code>status:tests-designed</code>   - <code>status:implementation</code>   - <code>status:review</code>   - <code>status:done</code></p> <p>Priority: P2 (Important for workflow visibility) Status: \ud83d\udccb Planned (not yet implemented)</p>"},{"location":"user-journeys/ORC-003-workflow-progression/#steps","title":"Steps","text":""},{"location":"user-journeys/ORC-003-workflow-progression/#1-initialize-with-status-label","title":"1. Initialize with Status Label","text":"<ul> <li>Action: Add <code>status:new</code> label when issue is created</li> <li>Expected outcome: Issue has initial workflow state</li> <li>System behavior: <code>create_issue()</code> includes <code>labels=[\"status:new\"]</code></li> </ul>"},{"location":"user-journeys/ORC-003-workflow-progression/#2-progress-to-specs-ready-gate-1","title":"2. Progress to Specs Ready (Gate 1)","text":"<ul> <li>Action: Architect approves specs \u2192 update label</li> <li>Expected outcome: Label changes from <code>status:new</code> to <code>status:specs-ready</code></li> <li>System behavior:</li> <li>Call <code>update_issue(issue_number, labels=[\"status:specs-ready\"])</code></li> <li>Removes old status label</li> <li>Adds new status label</li> <li>Triggers notification to planning agents</li> </ul>"},{"location":"user-journeys/ORC-003-workflow-progression/#3-progress-through-remaining-phases","title":"3. Progress Through Remaining Phases","text":"<ul> <li>Action: Each gate approval advances workflow</li> <li>Expected outcome: Labels update according to state machine:   <pre><code>status:new \u2192 status:specs-ready \u2192 status:planned \u2192\nstatus:tests-designed \u2192 status:implementation \u2192\nstatus:review \u2192 status:done\n</code></pre></li> <li>System behavior: Each transition updates GitHub issue labels</li> </ul>"},{"location":"user-journeys/ORC-003-workflow-progression/#4-query-issues-by-workflow-state","title":"4. Query Issues by Workflow State","text":"<ul> <li>Action: Filter issues by status label</li> <li>Expected outcome: Can view all issues in specific workflow phase</li> <li>System behavior:</li> <li><code>list_issues(labels=[\"status:implementation\"])</code> returns all issues currently being implemented</li> <li>Enables workflow dashboard/kanban view</li> </ul>"},{"location":"user-journeys/ORC-003-workflow-progression/#5-track-label-history","title":"5. Track Label History","text":"<ul> <li>Action: View issue label change events</li> <li>Expected outcome: Complete audit trail of workflow progression</li> <li>System behavior: GitHub tracks label change events (visible in issue timeline)</li> </ul>"},{"location":"user-journeys/ORC-003-workflow-progression/#success-criteria","title":"Success Criteria","text":"<p>\u2705 State Transitions: Labels update correctly at each phase \u2705 Single Status: Issue has exactly one <code>status:*</code> label at any time \u2705 Queryable: Can filter issues by workflow phase \u2705 Audit Trail: Label change history visible in GitHub \u2705 Validation: Cannot skip phases (enforced by orchestrator) \u2705 Rollback: Can move backward if issues found (e.g., review \u2192 implementation)</p>"},{"location":"user-journeys/ORC-003-workflow-progression/#label-management","title":"Label Management","text":""},{"location":"user-journeys/ORC-003-workflow-progression/#status-labels-mutually-exclusive","title":"Status Labels (Mutually Exclusive)","text":"<p>Only one <code>status:*</code> label active at a time:</p> Label Phase Meaning Assigned To <code>status:new</code> 1 Issue created, awaiting specs @duc (architect) <code>status:specs-ready</code> 2 Specs approved (Gate 1) @dede/@dali (implementers) <code>status:planned</code> 3 Implementation plan ready (Gate 2) @marie (test designer) <code>status:tests-designed</code> 4 Tests designed (Gate 3) @dede/@dali (implementers) <code>status:implementation</code> 5 Tests + code being written Implementers <code>status:review</code> 6 Code review in progress @dede (reviewer) + human <code>status:done</code> 7-8 PR merged, feature deployed (closed)"},{"location":"user-journeys/ORC-003-workflow-progression/#additional-labels-non-status","title":"Additional Labels (Non-Status)","text":"<p>Can coexist with status labels: - <code>priority:p1</code>, <code>priority:p2</code>, <code>priority:p3</code> - <code>type:feature</code>, <code>type:bug</code>, <code>type:refactor</code> - <code>domain:backend</code>, <code>domain:frontend</code>, <code>domain:infra</code> - <code>test:automated</code> (for test cleanup)</p>"},{"location":"user-journeys/ORC-003-workflow-progression/#e2e-test-coverage","title":"E2E Test Coverage","text":"<ul> <li>Test file: <code>tests/e2e/test_workflow_labels.py</code> (future)</li> <li>Journey marker: <code>@pytest.mark.journey(\"ORC-003\")</code></li> <li>Test method: Not yet implemented</li> <li>Covered steps: 0/5 (0% coverage)</li> <li>Test status: \u23f3 Not implemented</li> </ul>"},{"location":"user-journeys/ORC-003-workflow-progression/#implementation-status","title":"Implementation Status","text":"<p>User Story 3 from <code>specs/001-github-integration-core/spec.md</code>: - Create Label: <code>create_label(name, color, description)</code> \u2192 Not implemented - Get Label: <code>get_label(name)</code> \u2192 Not implemented - List Labels: <code>list_labels()</code> \u2192 Not implemented - Add Label to Issue: <code>add_label(issue_number, label)</code> \u2192 Not implemented (use update_issue) - Remove Label from Issue: <code>remove_label(issue_number, label)</code> \u2192 Not implemented (use update_issue) - Update Issue Labels: <code>update_issue(issue_number, labels=[...])</code> \u2192 \u2705 Implemented</p>"},{"location":"user-journeys/ORC-003-workflow-progression/#workflow-state-machine","title":"Workflow State Machine","text":"<pre><code>stateDiagram-v2\n    [*] --&gt; new: create_issue()\n    new --&gt; specs_ready: Gate 1 (Specs Approved)\n    specs_ready --&gt; planned: Gate 2 (Plan Approved)\n    planned --&gt; tests_designed: Gate 3 (Tests Approved)\n    tests_designed --&gt; implementation: Begin TDD\n    implementation --&gt; review: Implementation Complete\n    review --&gt; implementation: Changes Requested\n    review --&gt; done: Gate 4 (Review Approved + PR Merged)\n    done --&gt; [*]: Issue Closed</code></pre>"},{"location":"user-journeys/ORC-003-workflow-progression/#related-journeys","title":"Related Journeys","text":"<ul> <li>ORC-001: Create Issue (sets initial <code>status:new</code> label)</li> <li>ORC-002: Agent Provides Feedback (comments trigger label changes)</li> <li>ORC-004: Link Pull Request (PR merge triggers <code>status:done</code>)</li> <li>ORC-005: Complete SDLC Workflow (labels track progress through all 8 phases)</li> </ul>"},{"location":"user-journeys/ORC-003-workflow-progression/#implementation-references","title":"Implementation References","text":"<ul> <li>Spec: <code>specs/001-github-integration-core/spec.md</code> (User Story 3)</li> <li>Contract: <code>specs/001-github-integration-core/contracts/github_service.md</code> (future)</li> <li>Model: <code>src/github_integration/models.py::Label</code> (exists)</li> <li>Service: <code>src/github_integration/service.py::update_issue()</code> (implemented)</li> </ul>"},{"location":"user-journeys/ORC-003-workflow-progression/#notes","title":"Notes","text":"<ul> <li>Label color coding helps visual distinction:</li> <li><code>status:new</code>: Gray (#EDEDED)</li> <li><code>status:specs-ready</code>: Blue (#0075CA)</li> <li><code>status:planned</code>: Green (#0E8A16)</li> <li><code>status:implementation</code>: Yellow (#FFA500)</li> <li><code>status:review</code>: Orange (#FF6347)</li> <li> <p><code>status:done</code>: Purple (#8B5CF6)</p> </li> <li> <p>Label transitions enforce workflow discipline</p> </li> <li>Enables dashboard views (Kanban board by label)</li> <li>Critical for ORC-005 (full SDLC workflow) visibility</li> </ul>"},{"location":"user-journeys/ORC-004-link-pull-request/","title":"ORC-004: Link Pull Request to Feature Issue","text":"<p>Actor: Implementation Agent + Human Reviewer Goal: Create pull request that links to feature issue for automatic closure on merge Preconditions: - Issue exists and is in <code>status:review</code> state - Implementation complete (all tests passing) - Feature branch created - Changes committed to branch</p> <p>Priority: P3 (Important but lower priority than core workflow) Status: \ud83d\udccb Planned (not yet implemented)</p>"},{"location":"user-journeys/ORC-004-link-pull-request/#steps","title":"Steps","text":""},{"location":"user-journeys/ORC-004-link-pull-request/#1-create-pull-request","title":"1. Create Pull Request","text":"<ul> <li>Action: Call <code>create_pull_request(title, body, base, head, linked_issues)</code></li> <li>Expected outcome: PR created on GitHub</li> <li>System behavior:</li> <li>Makes POST /repos/{owner}/{repo}/pulls API call</li> <li>PR body includes <code>Closes #&lt;issue_number&gt;</code> keyword</li> <li>Returns <code>PullRequest</code> model with PR number</li> </ul>"},{"location":"user-journeys/ORC-004-link-pull-request/#2-link-to-feature-issue","title":"2. Link to Feature Issue","text":"<ul> <li>Action: PR body contains <code>Closes #123</code> or similar keyword</li> <li>Expected outcome: GitHub recognizes issue linkage</li> <li>System behavior:</li> <li>GitHub parses PR body for issue keywords</li> <li>Creates link visible in PR and issue UI</li> <li>Sets up auto-close trigger</li> </ul>"},{"location":"user-journeys/ORC-004-link-pull-request/#3-verify-pr-metadata","title":"3. Verify PR Metadata","text":"<ul> <li>Action: Retrieve PR details with <code>get_pull_request(pr_number)</code></li> <li>Expected outcome: PR has correct:</li> <li>Title matching feature</li> <li>Base branch (typically <code>main</code>)</li> <li>Head branch (feature branch)</li> <li>Linked issues list</li> <li>System behavior:</li> <li>Makes GET /repos/{owner}/{repo}/pulls/{pr_number}</li> <li>Parses <code>body</code> for linked issues</li> <li>Returns <code>PullRequest</code> model</li> </ul>"},{"location":"user-journeys/ORC-004-link-pull-request/#4-list-feature-prs","title":"4. List Feature PRs","text":"<ul> <li>Action: Query PRs for specific feature</li> <li>Expected outcome: Can find all PRs related to issue</li> <li>System behavior:</li> <li><code>list_pull_requests(linked_issues=[123])</code> returns matching PRs</li> <li>Enables tracking multiple PRs per feature</li> </ul>"},{"location":"user-journeys/ORC-004-link-pull-request/#5-merge-pr-and-close-issue","title":"5. Merge PR and Close Issue","text":"<ul> <li>Action: Human approves Gate 4 \u2192 PR merged</li> <li>Expected outcome:</li> <li>PR merged to base branch</li> <li>Linked issue automatically closed</li> <li>Issue label updated to <code>status:done</code></li> <li>System behavior:</li> <li>GitHub auto-closes linked issues on PR merge</li> <li>Orchestrator can detect merge via webhooks (future) or polling</li> </ul>"},{"location":"user-journeys/ORC-004-link-pull-request/#success-criteria","title":"Success Criteria","text":"<p>\u2705 PR Created: Pull request visible on GitHub \u2705 Issue Linked: PR shows \"Closes #123\" reference \u2705 Metadata Correct: Title, branches, linked issues all accurate \u2705 Auto-Close: Issue closes automatically when PR merges \u2705 Traceability: Can navigate from issue \u2192 PR \u2192 commits \u2705 Audit Trail: Complete history from issue creation to PR merge</p>"},{"location":"user-journeys/ORC-004-link-pull-request/#e2e-test-coverage","title":"E2E Test Coverage","text":"<ul> <li>Test file: <code>tests/e2e/test_pull_requests.py</code> (future)</li> <li>Journey marker: <code>@pytest.mark.journey(\"ORC-004\")</code></li> <li>Test method: Not yet implemented</li> <li>Covered steps: 0/5 (0% coverage)</li> <li>Test status: \u23f3 Not implemented</li> </ul>"},{"location":"user-journeys/ORC-004-link-pull-request/#implementation-status","title":"Implementation Status","text":"<p>User Story 4 from <code>specs/001-github-integration-core/spec.md</code>: - Create PR: <code>create_pull_request(title, body, base, head, linked_issues)</code> \u2192 Not implemented - Get PR: <code>get_pull_request(pr_number)</code> \u2192 Not implemented - List PRs: <code>list_pull_requests(state, linked_issues)</code> \u2192 Not implemented - PR Model: <code>PullRequest</code> with <code>is_linked_to(issue_number)</code> \u2192 Model exists, method not implemented</p>"},{"location":"user-journeys/ORC-004-link-pull-request/#pr-body-format","title":"PR Body Format","text":"<pre><code># [Feature Name]\n\n## Summary\n- Implemented feature X\n- Added Y functionality\n- Fixed Z issue\n\n## Changes\n- `src/module/file.py`: Added feature implementation\n- `tests/test_file.py`: Added comprehensive tests\n- `docs/README.md`: Updated documentation\n\n## Test Results\n- \u2705 48/48 tests passing\n- \u2705 88% code coverage\n- \u2705 All contract tests passing\n- \u2705 E2E tests passing\n\n## Checklist\n- [x] Tests written and passing\n- [x] Documentation updated\n- [x] Constitution compliance verified\n- [x] No security vulnerabilities\n- [x] Code reviewed\n\nCloses #123\n\n\ud83e\udd16 Generated with [Claude Code](https://claude.com/claude-code)\n\nCo-Authored-By: Claude Opus 4.5 &lt;noreply@anthropic.com&gt;\n</code></pre>"},{"location":"user-journeys/ORC-004-link-pull-request/#linking-keywords","title":"Linking Keywords","text":"<p>GitHub recognizes these keywords for auto-closing issues: - <code>Closes #123</code> - <code>Fixes #123</code> - <code>Resolves #123</code> - <code>Closes: #123</code> - <code>Fixes: #123</code> - <code>Resolves: #123</code></p> <p>Multiple issues: <code>Closes #123, #124, #125</code></p>"},{"location":"user-journeys/ORC-004-link-pull-request/#pr-states-and-workflow","title":"PR States and Workflow","text":"<pre><code>stateDiagram-v2\n    [*] --&gt; open: create_pull_request()\n    open --&gt; review: Request Review\n    review --&gt; changes_requested: Changes Needed\n    changes_requested --&gt; review: Updates Pushed\n    review --&gt; approved: Gate 4 Approved\n    approved --&gt; merged: Merge PR\n    merged --&gt; [*]: Issue Auto-Closed</code></pre>"},{"location":"user-journeys/ORC-004-link-pull-request/#related-journeys","title":"Related Journeys","text":"<ul> <li>ORC-001: Create Issue (issue must exist before PR)</li> <li>ORC-003: Progress Issue Through Workflow Phases (PR merge triggers <code>status:done</code>)</li> <li>ORC-005: Complete SDLC Workflow (PR is Phase 6-7)</li> </ul>"},{"location":"user-journeys/ORC-004-link-pull-request/#implementation-references","title":"Implementation References","text":"<ul> <li>Spec: <code>specs/001-github-integration-core/spec.md</code> (User Story 4)</li> <li>Contract: <code>specs/001-github-integration-core/contracts/github_service.md</code> (future)</li> <li>Model: <code>src/github_integration/models.py::PullRequest</code> (exists)</li> <li>Service: <code>src/github_integration/service.py::create_pull_request()</code> (future)</li> </ul>"},{"location":"user-journeys/ORC-004-link-pull-request/#notes","title":"Notes","text":"<ul> <li>PRs enable code review before merge (Gate 4)</li> <li>Auto-close on merge prevents manual issue cleanup</li> <li>One issue can have multiple PRs (e.g., backend + frontend)</li> <li>PR templates can enforce checklist completion</li> <li>Draft PRs allow WIP sharing without triggering reviews</li> <li>This journey is critical for Phase 6-7 of ORC-005 (full SDLC workflow)</li> </ul>"},{"location":"user-journeys/ORC-005-full-sdlc-workflow/","title":"ORC-005: Complete 8-Phase SDLC Workflow","text":"<p>Actor: Development Team (Product Owner + AI Agents) Goal: Complete a full feature development cycle from idea to deployment using AI agent orchestration Preconditions: - GitHub App configured and installed - Farmer Code orchestrator running - Repository cloned with worktrees configured - AI agents (@duc, @dede, @marie, etc.) available</p> <p>Priority: P1 (Core value proposition of Farmer Code)</p>"},{"location":"user-journeys/ORC-005-full-sdlc-workflow/#overview","title":"Overview","text":"<p>This journey represents the complete end-to-end SDLC workflow managed by the Farmer Code orchestrator. It encompasses all 8 phases from feature request to deployment.</p>"},{"location":"user-journeys/ORC-005-full-sdlc-workflow/#8-phase-sdlc-workflow","title":"8-Phase SDLC Workflow","text":""},{"location":"user-journeys/ORC-005-full-sdlc-workflow/#phase-1-issue-worktree-creation","title":"Phase 1: Issue &amp; Worktree Creation","text":"<ul> <li>Actor: Product Owner / Dev Lead</li> <li>Action: Create GitHub issue for new feature</li> <li>Journey: ORC-001 (Create Issue for New Feature Request)</li> <li>Labels: <code>status:new</code></li> <li>Assignee: <code>@duc</code> (architect)</li> <li>Output: GitHub issue with unique number, Git worktree created</li> </ul>"},{"location":"user-journeys/ORC-005-full-sdlc-workflow/#phase-2-architecture-specs","title":"Phase 2: Architecture &amp; Specs","text":"<ul> <li>Actor: Architecture Agent (<code>@duc</code>)</li> <li>Action: Design system architecture and create specifications</li> <li>Journey: (Covered in ORC-001 for basic tracking)</li> <li>Labels: <code>status:new</code> \u2192 <code>status:specs-ready</code></li> <li>Artifacts:</li> <li><code>spec.md</code>: Feature specification with user stories</li> <li><code>plan.md</code>: Implementation plan</li> <li><code>data-model.md</code>: Data structures</li> <li><code>contracts/</code>: API contracts</li> <li>Gate 1: Human approval of architecture and specs</li> </ul>"},{"location":"user-journeys/ORC-005-full-sdlc-workflow/#phase-3-implementation-plans","title":"Phase 3: Implementation Plans","text":"<ul> <li>Actor: Implementation Agents (<code>@dede</code>, <code>@dali</code>, <code>@gus</code>)</li> <li>Action: Create detailed execution plans (Journey: ORC-002 - Agent Feedback)</li> <li>Labels: <code>status:specs-ready</code> \u2192 <code>status:planned</code></li> <li>Artifacts: <code>tasks.md</code> with dependency-ordered tasks</li> <li>Gate 2: Human approval of implementation plans</li> </ul>"},{"location":"user-journeys/ORC-005-full-sdlc-workflow/#phase-4-test-design","title":"Phase 4: Test Design","text":"<ul> <li>Actor: Test Agent (<code>@marie</code>)</li> <li>Action: Design comprehensive test suite</li> <li>Labels: <code>status:planned</code> \u2192 <code>status:tests-designed</code></li> <li>Artifacts: Test cases in <code>tests/</code> directories</li> <li>Gate 3: Human approval of test design</li> </ul>"},{"location":"user-journeys/ORC-005-full-sdlc-workflow/#phase-5-implementation-tdd","title":"Phase 5: Implementation (TDD)","text":"<ul> <li>Actor: Implementation Agents</li> <li>Action: Write tests first (RED), then implementation (GREEN), then refactor</li> <li>Journey: (Current feature implements create_issue, get_issue, list_issues, update_issue, close_issue)</li> <li>Labels: <code>status:tests-designed</code> \u2192 <code>status:implementation</code></li> <li>Output: All tests passing, code coverage \u226580%</li> </ul>"},{"location":"user-journeys/ORC-005-full-sdlc-workflow/#phase-6-code-review","title":"Phase 6: Code Review","text":"<ul> <li>Actor: Review Agent (<code>@dede</code>) + Human Reviewer</li> <li>Action: Review code against specs and constitution</li> <li>Journey: ORC-004 (Link Pull Request) - Create PR linking to issue</li> <li>Labels: <code>status:implementation</code> \u2192 <code>status:review</code></li> <li>Gate 4: Human approval of code review</li> </ul>"},{"location":"user-journeys/ORC-005-full-sdlc-workflow/#phase-7-merge-deploy","title":"Phase 7: Merge &amp; Deploy","text":"<ul> <li>Actor: Human + CI/CD</li> <li>Action: Merge PR to main branch, deploy to environment</li> <li>Labels: <code>status:review</code> \u2192 <code>status:done</code></li> <li>Output: Feature deployed, issue closed</li> </ul>"},{"location":"user-journeys/ORC-005-full-sdlc-workflow/#phase-8-verification","title":"Phase 8: Verification","text":"<ul> <li>Actor: Test Agent + Product Owner</li> <li>Action: Verify feature works in production environment</li> <li>Labels: <code>status:done</code> (remains)</li> <li>Output: Feature verified, issue remains closed</li> </ul>"},{"location":"user-journeys/ORC-005-full-sdlc-workflow/#current-implementation-status","title":"Current Implementation Status","text":"Phase Status Journey ID Test Coverage 1. Issue &amp; Worktree Creation \u2705 Implemented ORC-001 \u2705 100% 2. Architecture &amp; Specs \u2705 Implemented (ORC-001) \u2705 100% 3. Implementation Plans \ud83d\udccb Planned ORC-002 \u23f3 0% 4. Test Design \ud83d\udccb Planned (ORC-002) \u23f3 0% 5. Implementation (TDD) \u2705 Implemented (current) \u2705 100% 6. Code Review \ud83d\udccb Planned ORC-004 \u23f3 0% 7. Merge &amp; Deploy \ud83d\udccb Planned (ORC-004) \u23f3 0% 8. Verification \ud83d\udccb Planned (manual) \u23f3 0% <p>Note: Current implementation (Feature 001 - GitHub Integration Core) covers phases 1, 2, and 5. Remaining phases will be implemented in future features.</p>"},{"location":"user-journeys/ORC-005-full-sdlc-workflow/#success-criteria","title":"Success Criteria","text":"<p>\u2705 Issue Created: Feature tracked from creation to completion \u2705 Specs Approved: Architecture and design documents approved at Gate 1 \u2705 Plans Approved: Implementation plans approved at Gate 2 \u2705 Tests Approved: Test design approved at Gate 3 \u2705 Tests Passing: 100% of tests passing before merge \u2705 Code Reviewed: Code meets standards and approved at Gate 4 \u2705 Feature Deployed: Code merged to main and deployed \u2705 Feature Verified: Feature works in production environment</p>"},{"location":"user-journeys/ORC-005-full-sdlc-workflow/#e2e-test-coverage","title":"E2E Test Coverage","text":""},{"location":"user-journeys/ORC-005-full-sdlc-workflow/#current-test-partial-workflow","title":"Current Test (Partial Workflow)","text":"<ul> <li>Test file: <code>tests/e2e/test_github_operations.py</code></li> <li>Journey marker: <code>@pytest.mark.journey(\"ORC-005\")</code></li> <li>Test method: <code>TestFullIssueLifecycle::test_create_multiple_issues</code></li> <li>Covered phases: Phase 1 (Issue Creation), Phase 5 (Implementation verification)</li> <li>Test status: \u2705 Passing (as of 2026-01-02)</li> </ul> <pre><code>@pytest.mark.e2e\n@pytest.mark.journey(\"ORC-005\")\ndef test_create_multiple_issues(service, auto_cleanup_issue):\n    \"\"\"\n    E2E test for ORC-005: Complete SDLC Workflow (partial)\n\n    Currently tests:\n    - Phase 1: Creating multiple issues in sequence\n    - Phase 5: Verifying all issues are retrievable and indexed\n\n    Future expansion:\n    - Phase 3: Agent comments with feedback\n    - Phase 6: PR creation and linking\n    - Phase 7: Label transitions tracking workflow state\n    \"\"\"\n    # Creates 3 issues and verifies retrieval and list appearance\n</code></pre>"},{"location":"user-journeys/ORC-005-full-sdlc-workflow/#future-test-coverage-full-workflow","title":"Future Test Coverage (Full Workflow)","text":"<p>When Phases 3, 4, 6, 7 are implemented, the E2E test will expand to cover: - Agent comments with signals (<code>@agent</code>, <code>\u2705</code>, <code>\u274c</code>) - Label transitions (<code>status:new</code> \u2192 <code>status:specs-ready</code> \u2192 ... \u2192 <code>status:done</code>) - PR creation linking to issue (<code>Closes #123</code>) - PR merge triggering issue closure</p>"},{"location":"user-journeys/ORC-005-full-sdlc-workflow/#label-state-machine","title":"Label State Machine","text":"<pre><code>stateDiagram-v2\n    [*] --&gt; status:new: Issue Created\n    status:new --&gt; status:specs-ready: Gate 1 Approved\n    status:specs-ready --&gt; status:planned: Gate 2 Approved\n    status:planned --&gt; status:tests-designed: Gate 3 Approved\n    status:tests-designed --&gt; status:implementation: Tests Written\n    status:implementation --&gt; status:review: Implementation Complete\n    status:review --&gt; status:done: Gate 4 Approved + PR Merged\n    status:done --&gt; [*]: Issue Closed</code></pre>"},{"location":"user-journeys/ORC-005-full-sdlc-workflow/#agent-communication-flow","title":"Agent Communication Flow","text":"<ol> <li>Product Owner creates issue \u2192 assigns <code>@duc</code></li> <li>@duc (Architect) comments: \"\u2705 Specs ready @dede\" \u2192 updates label to <code>status:specs-ready</code></li> <li>@dede (Backend Lead) comments: \"\u2705 Backend plan complete. @marie for tests\" \u2192 updates label</li> <li>@marie (Test Agent) comments: \"\u2705 Test plan approved. @dede @dali ready for implementation\"</li> <li>@dede/@dali implement \u2192 comment: \"\u2705 Implementation complete. Ready for review\"</li> <li>@dede (Reviewer) reviews \u2192 creates PR, comments: \"\u2705 Code review passed\"</li> <li>Human approves Gate 4 \u2192 PR merged \u2192 Issue auto-closed</li> </ol>"},{"location":"user-journeys/ORC-005-full-sdlc-workflow/#related-journeys","title":"Related Journeys","text":"<ul> <li>ORC-001: Create Issue (Phase 1 of this workflow)</li> <li>ORC-002: Agent Provides Feedback via Comment (Phase 3-4)</li> <li>ORC-003: Progress Issue Through Workflow Phases (Phase 2-7)</li> <li>ORC-004: Link Pull Request to Feature Issue (Phase 6-7)</li> </ul>"},{"location":"user-journeys/ORC-005-full-sdlc-workflow/#implementation-references","title":"Implementation References","text":"<ul> <li>Spec: <code>specs/001-github-integration-core/spec.md</code> (All user stories)</li> <li>Workflow Reference: <code>references/sdlc-workflow.md</code></li> <li>Constitution: Principle II (Specification-Driven Development), Principle IV (Human Approval Gates)</li> <li>Tests: <code>tests/e2e/test_github_operations.py</code></li> </ul>"},{"location":"user-journeys/ORC-005-full-sdlc-workflow/#performance-metrics","title":"Performance Metrics","text":"Metric Target Current Issue Creation Time &lt;2s ~1.5s \u2705 Full Workflow Duration &lt;2 hours N/A (not fully implemented) Gate Approval Time &lt;15 min Manual (varies) Test Execution Time &lt;5 min ~48s \u2705"},{"location":"user-journeys/ORC-005-full-sdlc-workflow/#notes","title":"Notes","text":"<ul> <li>This is the core value proposition of Farmer Code: AI-orchestrated SDLC</li> <li>Currently only Phases 1, 2, 5 are implemented (GitHub Integration Core)</li> <li>Future features will complete Phases 3, 4, 6, 7, 8</li> <li>Each phase has human approval gates to ensure quality and alignment</li> <li>All agent communication happens via GitHub issue comments for full transparency</li> </ul>"},{"location":"user-journeys/SVC-001-orchestrator-workflow/","title":"SVC-001: Orchestrator Workflow Execution","text":"<p>Domain: Services Architecture (SVC) Priority: P1 (MVP) Status: Implemented</p>"},{"location":"user-journeys/SVC-001-orchestrator-workflow/#overview","title":"Overview","text":"<p>Orchestrator manages SpecKit workflow execution, invoking agents exclusively through Agent Hub and maintaining workflow state in SQLite.</p>"},{"location":"user-journeys/SVC-001-orchestrator-workflow/#user-story","title":"User Story","text":"<p>As a user or external system, I want to trigger SpecKit workflows via the Orchestrator, so that I can execute specify, plan, tasks, and implement workflows with proper state management.</p>"},{"location":"user-journeys/SVC-001-orchestrator-workflow/#journey-steps","title":"Journey Steps","text":"<pre><code>sequenceDiagram\n    participant U as User/System\n    participant O as Orchestrator\n    participant DB as SQLite\n    participant H as Agent Hub\n    participant A as Agent (Baron)\n\n    U-&gt;&gt;O: POST /workflows (workflow_type, description)\n    O-&gt;&gt;DB: Create workflow record\n    O-&gt;&gt;O: Transition to IN_PROGRESS\n    O-&gt;&gt;DB: Record history\n    O--&gt;&gt;U: WorkflowResponse (pending/in_progress)\n\n    Note over O,A: Async Phase Execution\n    O-&gt;&gt;H: POST /invoke/baron (context)\n    H-&gt;&gt;A: POST /invoke (workflow_type)\n    A--&gt;&gt;H: InvokeResponse\n    H--&gt;&gt;O: InvokeResponse\n\n    O-&gt;&gt;O: Advance to WAITING_APPROVAL\n    U-&gt;&gt;O: POST /workflows/{id}/advance (human_approved)\n    O-&gt;&gt;O: Transition to next phase or COMPLETED\n    O-&gt;&gt;DB: Record history\n    O--&gt;&gt;U: WorkflowResponse (completed)</code></pre>"},{"location":"user-journeys/SVC-001-orchestrator-workflow/#step-1-create-workflow","title":"Step 1: Create Workflow","text":"<p>Endpoint: <code>POST /workflows</code></p> <p>Request: <pre><code>{\n  \"workflow_type\": \"specify\",\n  \"feature_description\": \"Add user authentication with OAuth2 support\",\n  \"context\": {\n    \"priority\": \"P1\",\n    \"requester\": \"product-team\"\n  }\n}\n</code></pre></p> <p>Response: <pre><code>{\n  \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"workflow_type\": \"specify\",\n  \"status\": \"in_progress\",\n  \"feature_id\": \"009-add-user-authentication\",\n  \"current_phase\": \"phase_1\",\n  \"result\": null,\n  \"created_at\": \"2026-01-05T12:00:00Z\"\n}\n</code></pre></p>"},{"location":"user-journeys/SVC-001-orchestrator-workflow/#step-2-get-workflow-status","title":"Step 2: Get Workflow Status","text":"<p>Endpoint: <code>GET /workflows/{id}</code></p> <p>Track workflow progress during execution:</p> <pre><code>{\n  \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"workflow_type\": \"specify\",\n  \"status\": \"waiting_approval\",\n  \"feature_id\": \"009-add-user-authentication\",\n  \"current_phase\": \"phase_1\",\n  \"result\": {\n    \"output\": \"# Feature Specification...\",\n    \"files_created\": [\"specs/009-add-user-auth/spec.md\"]\n  },\n  \"created_at\": \"2026-01-05T12:00:00Z\",\n  \"updated_at\": \"2026-01-05T12:05:00Z\"\n}\n</code></pre>"},{"location":"user-journeys/SVC-001-orchestrator-workflow/#step-3-advance-workflow","title":"Step 3: Advance Workflow","text":"<p>Endpoint: <code>POST /workflows/{id}/advance</code></p> <p>Human approves phase result:</p> <pre><code>{\n  \"trigger\": \"human_approved\",\n  \"phase_result\": {\n    \"approved\": true,\n    \"comments\": \"LGTM, proceed to next phase\"\n  }\n}\n</code></pre> <p>Response: <pre><code>{\n  \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"workflow_type\": \"specify\",\n  \"status\": \"completed\",\n  \"feature_id\": \"009-add-user-authentication\",\n  \"current_phase\": \"phase_2\",\n  \"result\": {\n    \"output\": \"Specification complete\",\n    \"files_created\": [\"specs/009-add-user-auth/spec.md\"]\n  },\n  \"completed_at\": \"2026-01-05T12:10:00Z\"\n}\n</code></pre></p>"},{"location":"user-journeys/SVC-001-orchestrator-workflow/#state-machine","title":"State Machine","text":"<pre><code>PENDING \u2192 IN_PROGRESS (workflow started)\n    \u2502\n    \u2514\u2500\u2500 Agent processing...\n        \u2502\n        \u2514\u2500\u2500 IN_PROGRESS \u2192 WAITING_APPROVAL (agent complete)\n                    \u2502\n                    \u251c\u2500\u2500 Human approves\n                    \u2502   \u2514\u2500\u2500 WAITING_APPROVAL \u2192 IN_PROGRESS (next phase)\n                    \u2502                       or COMPLETED (all phases done)\n                    \u2502\n                    \u2514\u2500\u2500 Human rejects\n                        \u2514\u2500\u2500 WAITING_APPROVAL \u2192 IN_PROGRESS (rework)\n                                            or FAILED (abort)\n\nAny state \u2192 FAILED (error occurred)\n</code></pre>"},{"location":"user-journeys/SVC-001-orchestrator-workflow/#workflow-types","title":"Workflow Types","text":"Type Description Agent specify Generate feature specification Baron plan Create implementation plan Baron tasks Generate task breakdown Baron implement Execute implementation Baron"},{"location":"user-journeys/SVC-001-orchestrator-workflow/#success-criteria","title":"Success Criteria","text":"Criterion Verification Workflow creation Returns valid UUID and feature_id State tracking Status updates correctly through lifecycle Agent invocation Routes through Agent Hub, not directly History recording All transitions recorded in workflow_history Concurrent support 10+ workflows can run simultaneously (SC-004) Overhead &lt; 1 second added to total workflow time (SC-003)"},{"location":"user-journeys/SVC-001-orchestrator-workflow/#test-mapping","title":"Test Mapping","text":"Test Type File Description Contract <code>services/orchestrator/tests/contract/test_workflows.py</code> POST /workflows contract Contract <code>services/orchestrator/tests/contract/test_get_workflow.py</code> GET /workflows/{id} contract Contract <code>services/orchestrator/tests/contract/test_advance.py</code> POST /workflows/{id}/advance contract Integration <code>services/orchestrator/tests/integration/test_state_machine.py</code> State machine transitions E2E <code>tests/e2e/test_orchestrator_workflow.py</code> Full journey with SVC-001 marker"},{"location":"user-journeys/SVC-001-orchestrator-workflow/#running-tests","title":"Running Tests","text":"<pre><code># Contract tests\ncd services/orchestrator\nuv run pytest tests/contract/ -m contract\n\n# Integration tests\nuv run pytest tests/integration/ -m integration\n\n# E2E tests (requires running services)\ncd ../..\nuv run pytest tests/e2e/test_orchestrator_workflow.py -m \"e2e and journey\"\n</code></pre>"},{"location":"user-journeys/SVC-001-orchestrator-workflow/#api-reference","title":"API Reference","text":""},{"location":"user-journeys/SVC-001-orchestrator-workflow/#post-workflows","title":"POST /workflows","text":"<p>Create and start a new workflow.</p> Parameter Type Required Description workflow_type string Yes specify, plan, tasks, or implement feature_description string Yes Description (min 10 chars) context object No Additional context"},{"location":"user-journeys/SVC-001-orchestrator-workflow/#get-workflowsworkflow_id","title":"GET /workflows/{workflow_id}","text":"<p>Get workflow by ID.</p> Parameter Type Required Description workflow_id uuid (path) Yes Workflow UUID"},{"location":"user-journeys/SVC-001-orchestrator-workflow/#post-workflowsworkflow_idadvance","title":"POST /workflows/{workflow_id}/advance","text":"<p>Advance workflow to next state.</p> Parameter Type Required Description workflow_id uuid (path) Yes Workflow UUID trigger string Yes agent_complete, human_approved, human_rejected phase_result object No Result from completed phase"},{"location":"user-journeys/SVC-001-orchestrator-workflow/#get-health","title":"GET /health","text":"<p>Get Orchestrator health status.</p> <p>Response: <pre><code>{\n  \"status\": \"healthy\",\n  \"version\": \"0.1.0\",\n  \"uptime_seconds\": 3600\n}\n</code></pre></p>"},{"location":"user-journeys/SVC-001-orchestrator-workflow/#configuration","title":"Configuration","text":"Environment Variable Default Description DATABASE_URL sqlite:///./data/orchestrator.db SQLite database path AGENT_HUB_URL http://localhost:8000 Agent Hub service URL"},{"location":"user-journeys/SVC-001-orchestrator-workflow/#related-documentation","title":"Related Documentation","text":"<ul> <li>Services Overview</li> <li>Orchestrator Contract</li> <li>SVC-002: Agent Consultation</li> <li>SVC-005: Stateless Agent</li> </ul>"},{"location":"user-journeys/SVC-002-agent-consultation/","title":"SVC-002: Agent Consultation via Agent Hub","text":"<p>Domain: Services Architecture (SVC) Priority: P1 (MVP) Status: Implemented</p>"},{"location":"user-journeys/SVC-002-agent-consultation/#overview","title":"Overview","text":"<p>Agent Hub routes expert questions to appropriate agents based on topic, validates response confidence, and handles low-confidence escalation.</p>"},{"location":"user-journeys/SVC-002-agent-consultation/#user-story","title":"User Story","text":"<p>As an Orchestrator or external service, I want to ask topic-based questions through Agent Hub, so that I can get expert answers with confidence validation and automatic escalation.</p>"},{"location":"user-journeys/SVC-002-agent-consultation/#journey-steps","title":"Journey Steps","text":"<pre><code>sequenceDiagram\n    participant O as Orchestrator\n    participant H as Agent Hub\n    participant A as Agent Service\n    participant GH as GitHub (escalation)\n\n    O-&gt;&gt;H: POST /ask/{topic} (question, context)\n    H-&gt;&gt;H: Route topic \u2192 agent\n    H-&gt;&gt;A: POST /invoke (topic as workflow)\n    A--&gt;&gt;H: InvokeResponse (answer, confidence)\n    H-&gt;&gt;H: Validate confidence\n    alt Confidence &gt;= threshold\n        H--&gt;&gt;O: AskExpertResponse (status: resolved)\n    else Confidence &lt; threshold\n        H-&gt;&gt;GH: Create escalation issue\n        H--&gt;&gt;O: AskExpertResponse (status: pending_human)\n    end</code></pre>"},{"location":"user-journeys/SVC-002-agent-consultation/#step-1-topic-routing","title":"Step 1: Topic Routing","text":"<p>Endpoint: <code>POST /ask/{topic}</code></p> <p>Request: <pre><code>{\n  \"question\": \"Should we use JWT or session-based auth?\",\n  \"context\": \"Building a multi-tenant SaaS application\",\n  \"feature_id\": \"008-auth-system\"\n}\n</code></pre></p> <p>Topic Routing: | Topic | Agent | Capabilities | |-------|-------|--------------| | architecture | baron | System design, patterns | | security | charles | Auth, encryption, compliance | | testing | marie | Test strategy, coverage | | frontend | dali | UI/UX, React, accessibility |</p>"},{"location":"user-journeys/SVC-002-agent-consultation/#step-2-agent-invocation","title":"Step 2: Agent Invocation","text":"<p>Agent Hub invokes the routed agent:</p> <pre><code>{\n  \"workflow_type\": \"architecture\",\n  \"context\": {\n    \"question\": \"Should we use JWT or session-based auth?\",\n    \"topic\": \"architecture\",\n    \"additional_context\": \"Building a multi-tenant SaaS application\",\n    \"feature_id\": \"008-auth-system\"\n  }\n}\n</code></pre>"},{"location":"user-journeys/SVC-002-agent-consultation/#step-3-confidence-validation","title":"Step 3: Confidence Validation","text":"<p>Agent Hub validates the response confidence:</p> Threshold Topic Action 85% Default Escalate if below 90% security Higher bar for security topics 80% testing Slightly lower for test advice"},{"location":"user-journeys/SVC-002-agent-consultation/#step-4-response-or-escalation","title":"Step 4: Response or Escalation","text":"<p>High Confidence Response (status: resolved): <pre><code>{\n  \"answer\": \"For a multi-tenant SaaS, JWT with short expiry and refresh tokens is recommended...\",\n  \"rationale\": \"Based on your scalability needs and stateless architecture preference\",\n  \"confidence\": 92,\n  \"status\": \"resolved\",\n  \"session_id\": \"550e8400-e29b-41d4-a716-446655440000\"\n}\n</code></pre></p> <p>Low Confidence Response (status: pending_human): <pre><code>{\n  \"answer\": \"I have some thoughts but need human verification...\",\n  \"confidence\": 72,\n  \"uncertainty_reasons\": [\n    \"Compliance requirements unclear\",\n    \"Integration constraints unknown\"\n  ],\n  \"status\": \"pending_human\",\n  \"session_id\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"escalation_id\": \"660e8400-e29b-41d4-a716-446655440001\"\n}\n</code></pre></p>"},{"location":"user-journeys/SVC-002-agent-consultation/#direct-agent-invocation","title":"Direct Agent Invocation","text":"<p>For direct agent control, use <code>/invoke/{agent}</code>:</p> <p>Endpoint: <code>POST /invoke/{agent}</code></p> <p>Request: <pre><code>{\n  \"workflow_type\": \"specify\",\n  \"context\": {\n    \"feature_description\": \"User authentication system\"\n  },\n  \"parameters\": {\n    \"priority\": \"P1\"\n  }\n}\n</code></pre></p> <p>Response: <pre><code>{\n  \"success\": true,\n  \"result\": {\n    \"output\": \"# Feature Specification...\",\n    \"files_created\": [\"specs/008-auth/spec.md\"]\n  },\n  \"confidence\": 88,\n  \"metadata\": {\n    \"duration_ms\": 12500,\n    \"model_used\": \"claude-3-5-sonnet-20241022\"\n  }\n}\n</code></pre></p>"},{"location":"user-journeys/SVC-002-agent-consultation/#success-criteria","title":"Success Criteria","text":"Criterion Verification Topic routing Unknown topic returns 404 Agent invocation Forwards to correct agent Confidence validation Threshold checked per topic Escalation creation Low confidence triggers escalation Error handling Agent failures return proper errors"},{"location":"user-journeys/SVC-002-agent-consultation/#test-mapping","title":"Test Mapping","text":"Test Type File Description Contract <code>services/agent-hub/tests/contract/test_invoke.py</code> /invoke/{agent} contract Contract <code>services/agent-hub/tests/contract/test_ask.py</code> /ask/{topic} contract Integration <code>services/agent-hub/tests/integration/test_confidence.py</code> Confidence validation E2E <code>tests/e2e/test_agent_consultation.py</code> Full journey with SVC-002 marker"},{"location":"user-journeys/SVC-002-agent-consultation/#running-tests","title":"Running Tests","text":"<pre><code># Contract tests\ncd services/agent-hub\nuv run pytest tests/contract/ -m contract\n\n# Integration tests\nuv run pytest tests/integration/ -m integration\n\n# E2E tests (requires running services)\ncd ../..\nuv run pytest tests/e2e/test_agent_consultation.py -m \"e2e and journey\"\n</code></pre>"},{"location":"user-journeys/SVC-002-agent-consultation/#api-reference","title":"API Reference","text":""},{"location":"user-journeys/SVC-002-agent-consultation/#post-asktopic","title":"POST /ask/{topic}","text":"<p>Ask an expert by topic.</p> Parameter Type Required Description topic string (path) Yes Topic for routing question string Yes Question to ask (min 10 chars) context string No Additional context feature_id string Yes Feature ID for logging session_id uuid No Session for multi-turn"},{"location":"user-journeys/SVC-002-agent-consultation/#post-invokeagent","title":"POST /invoke/{agent}","text":"<p>Invoke a specific agent.</p> Parameter Type Required Description agent string (path) Yes Agent name workflow_type string Yes Workflow type context object Yes Context for workflow parameters object No Additional parameters session_id uuid No Optional session ID"},{"location":"user-journeys/SVC-002-agent-consultation/#get-health","title":"GET /health","text":"<p>Get Agent Hub health status.</p> <p>Response: <pre><code>{\n  \"status\": \"healthy\",\n  \"version\": \"0.1.0\",\n  \"uptime_seconds\": 3600,\n  \"connected_agents\": [\"baron\", \"duc\", \"marie\"]\n}\n</code></pre></p>"},{"location":"user-journeys/SVC-002-agent-consultation/#related-documentation","title":"Related Documentation","text":"<ul> <li>Services Overview</li> <li>Agent Hub Architecture</li> <li>Agent Hub Contract</li> <li>SVC-005: Stateless Agent</li> </ul>"},{"location":"user-journeys/SVC-003-human-escalation/","title":"SVC-003: Human Escalation","text":"<p>Domain: Services Architecture (SVC) Priority: P1 Status: Implemented</p>"},{"location":"user-journeys/SVC-003-human-escalation/#overview","title":"Overview","text":"<p>Agent Hub escalates low-confidence responses for human review. When an agent's confidence is below the threshold, an escalation is created and optionally posted to GitHub for human input.</p>"},{"location":"user-journeys/SVC-003-human-escalation/#user-story","title":"User Story","text":"<p>As a system administrator, I want to review agent responses that are uncertain, so that I can ensure accuracy for critical decisions.</p>"},{"location":"user-journeys/SVC-003-human-escalation/#journey-steps","title":"Journey Steps","text":"<pre><code>sequenceDiagram\n    participant U as User/System\n    participant H as Agent Hub\n    participant DB as SQLite\n    participant A as Agent (Baron)\n    participant G as GitHub\n\n    U-&gt;&gt;H: POST /ask/{topic} (question)\n    H-&gt;&gt;A: POST /invoke (question)\n    A--&gt;&gt;H: InvokeResponse (confidence: 60)\n    H-&gt;&gt;H: Check threshold (60 &lt; 80)\n    H-&gt;&gt;DB: Create escalation record\n    H--&gt;&gt;U: AskExpertResponse (status: pending_human)\n\n    Note over H,G: Optional: Post to GitHub\n    H-&gt;&gt;G: POST /repos/.../comments\n    G--&gt;&gt;H: Comment ID\n\n    Note over G,H: Human reviews on GitHub\n    G-&gt;&gt;H: Human responds /confirm\n\n    U-&gt;&gt;H: POST /escalations/{id}\n    H-&gt;&gt;DB: Update escalation (resolved)\n    H--&gt;&gt;U: EscalationResponse (human_action: confirm)</code></pre>"},{"location":"user-journeys/SVC-003-human-escalation/#step-1-question-triggers-escalation","title":"Step 1: Question Triggers Escalation","text":"<p>Endpoint: <code>POST /ask/{topic}</code></p> <p>Request: <pre><code>{\n  \"question\": \"Should we use microservices or monolith for this startup?\",\n  \"feature_id\": \"008-architecture-decision\"\n}\n</code></pre></p> <p>Response (low confidence): <pre><code>{\n  \"answer\": \"Based on your startup context, I recommend...\",\n  \"confidence\": 60,\n  \"uncertainty_reasons\": [\n    \"Trade-offs depend heavily on team size and experience\",\n    \"Future scaling needs are unclear\"\n  ],\n  \"status\": \"pending_human\",\n  \"session_id\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"escalation_id\": \"7c9e6679-7425-40de-944b-e07fc1f90ae7\"\n}\n</code></pre></p>"},{"location":"user-journeys/SVC-003-human-escalation/#step-2-get-escalation-details","title":"Step 2: Get Escalation Details","text":"<p>Endpoint: <code>GET /escalations/{id}</code></p> <p>Response: <pre><code>{\n  \"id\": \"7c9e6679-7425-40de-944b-e07fc1f90ae7\",\n  \"status\": \"pending\",\n  \"question\": \"Should we use microservices or monolith for this startup?\",\n  \"tentative_answer\": \"Based on your startup context, I recommend...\",\n  \"confidence\": 60,\n  \"uncertainty_reasons\": [\n    \"Trade-offs depend heavily on team size and experience\",\n    \"Future scaling needs are unclear\"\n  ],\n  \"human_action\": null,\n  \"human_response\": null,\n  \"human_responder\": null,\n  \"created_at\": \"2026-01-05T12:00:00Z\",\n  \"resolved_at\": null\n}\n</code></pre></p>"},{"location":"user-journeys/SVC-003-human-escalation/#step-3-human-submits-response","title":"Step 3: Human Submits Response","text":"<p>Endpoint: <code>POST /escalations/{id}</code></p> <p>Request (confirm): <pre><code>{\n  \"action\": \"confirm\",\n  \"responder\": \"@jane\"\n}\n</code></pre></p> <p>Request (correct): <pre><code>{\n  \"action\": \"correct\",\n  \"response\": \"Start with a modular monolith. Your 3-person team will benefit from simpler deployment and debugging.\",\n  \"responder\": \"@jane\"\n}\n</code></pre></p> <p>Request (add context): <pre><code>{\n  \"action\": \"add_context\",\n  \"response\": \"We expect to reach 1M users in 6 months and have 10 engineers joining.\",\n  \"responder\": \"@jane\"\n}\n</code></pre></p> <p>Response: <pre><code>{\n  \"id\": \"7c9e6679-7425-40de-944b-e07fc1f90ae7\",\n  \"status\": \"resolved\",\n  \"question\": \"Should we use microservices or monolith for this startup?\",\n  \"tentative_answer\": \"Based on your startup context, I recommend...\",\n  \"confidence\": 60,\n  \"uncertainty_reasons\": [\n    \"Trade-offs depend heavily on team size and experience\",\n    \"Future scaling needs are unclear\"\n  ],\n  \"human_action\": \"correct\",\n  \"human_response\": \"Start with a modular monolith...\",\n  \"human_responder\": \"@jane\",\n  \"created_at\": \"2026-01-05T12:00:00Z\",\n  \"resolved_at\": \"2026-01-05T14:30:00Z\"\n}\n</code></pre></p>"},{"location":"user-journeys/SVC-003-human-escalation/#human-actions","title":"Human Actions","text":"Action Description Response Required confirm Accept the tentative answer as correct No correct Provide the correct answer Yes add_context Add more information for re-evaluation Yes"},{"location":"user-journeys/SVC-003-human-escalation/#confidence-thresholds","title":"Confidence Thresholds","text":"Topic Threshold Description security 95% Security decisions require high confidence compliance 95% Compliance advice needs certainty default 80% General topics"},{"location":"user-journeys/SVC-003-human-escalation/#escalation-states","title":"Escalation States","text":"State Description pending Awaiting human review resolved Human has responded expired Escalation expired without response"},{"location":"user-journeys/SVC-003-human-escalation/#github-integration-optional","title":"GitHub Integration (Optional)","text":"<p>When configured, escalations can be posted as GitHub issue comments:</p> <pre><code>## Human Review Required\n\n**Confidence:** 60%\n\n### Question\nShould we use microservices or monolith for this startup?\n\n### Tentative Answer\nBased on your startup context, I recommend...\n\n### Uncertainty Reasons\n- Trade-offs depend heavily on team size and experience\n- Future scaling needs are unclear\n\n### How to Respond\n\nReply to this comment with one of the following:\n\n- `/confirm` - Accept the tentative answer as correct\n- `/correct &lt;your answer&gt;` - Provide the correct answer\n- `/context &lt;additional info&gt;` - Add more context for re-evaluation\n\n---\n_Escalation ID: 7c9e6679-7425-40de-944b-e07fc1f90ae7_\n</code></pre>"},{"location":"user-journeys/SVC-003-human-escalation/#success-criteria","title":"Success Criteria","text":"Criterion Verification Low confidence triggers escalation Responses below threshold create escalation (SC-007) Escalation persisted Escalation stored in database Human can respond POST /escalations/{id} updates status Response types supported confirm, correct, add_context all work Already resolved handled Resubmitting returns 409 Conflict"},{"location":"user-journeys/SVC-003-human-escalation/#test-mapping","title":"Test Mapping","text":"Test Type File Description Contract <code>services/agent-hub/tests/contract/test_escalations_get.py</code> GET /escalations/{id} Contract <code>services/agent-hub/tests/contract/test_escalations_respond.py</code> POST /escalations/{id} Integration <code>services/agent-hub/tests/integration/test_escalation_create.py</code> Escalation creation Integration <code>services/agent-hub/tests/integration/test_github_escalation.py</code> GitHub comment posting E2E <code>tests/e2e/test_human_escalation.py</code> Full journey with SVC-003 marker"},{"location":"user-journeys/SVC-003-human-escalation/#running-tests","title":"Running Tests","text":"<pre><code># Contract tests\ncd services/agent-hub\nuv run pytest tests/contract/test_escalations*.py -m contract\n\n# Integration tests\nuv run pytest tests/integration/test_escalation*.py tests/integration/test_github*.py -m integration\n\n# E2E tests (requires running services)\ncd ../..\nuv run pytest tests/e2e/test_human_escalation.py -m \"e2e and journey\"\n</code></pre>"},{"location":"user-journeys/SVC-003-human-escalation/#api-reference","title":"API Reference","text":""},{"location":"user-journeys/SVC-003-human-escalation/#get-escalationsescalation_id","title":"GET /escalations/{escalation_id}","text":"<p>Get escalation by ID.</p> Parameter Type Required Description escalation_id uuid (path) Yes Escalation UUID <p>Response Codes: - 200: Escalation found - 400: Invalid UUID format - 404: Escalation not found</p>"},{"location":"user-journeys/SVC-003-human-escalation/#post-escalationsescalation_id","title":"POST /escalations/{escalation_id}","text":"<p>Submit human response to escalation.</p> Parameter Type Required Description escalation_id uuid (path) Yes Escalation UUID action string (body) Yes confirm, correct, or add_context response string (body) For correct The correct answer responder string (body) Yes Human identifier (@username) <p>Response Codes: - 200: Response accepted - 400: Invalid action or missing required fields - 404: Escalation not found - 409: Already resolved</p>"},{"location":"user-journeys/SVC-003-human-escalation/#configuration","title":"Configuration","text":"Environment Variable Default Description GITHUB_TOKEN - GitHub API token for posting comments GITHUB_REPO farmer1st/farmer-code Repository for escalation comments ESCALATION_THRESHOLD 80 Default confidence threshold"},{"location":"user-journeys/SVC-003-human-escalation/#related-documentation","title":"Related Documentation","text":"<ul> <li>Services Overview</li> <li>Agent Hub Contract</li> <li>SVC-002: Agent Consultation</li> <li>SVC-004: Multi-Turn Session</li> </ul>"},{"location":"user-journeys/SVC-004-multi-turn-session/","title":"SVC-004: Multi-Turn Session","text":"<p>Domain: Services Architecture (SVC) Priority: P2 Status: Implemented</p>"},{"location":"user-journeys/SVC-004-multi-turn-session/#overview","title":"Overview","text":"<p>Agent Hub maintains session state for multi-turn conversations, preserving context across exchanges to enable coherent follow-up questions.</p>"},{"location":"user-journeys/SVC-004-multi-turn-session/#user-story","title":"User Story","text":"<p>As a user or external system, I want to have multi-turn conversations with agents, so that I can ask follow-up questions without repeating context.</p>"},{"location":"user-journeys/SVC-004-multi-turn-session/#journey-steps","title":"Journey Steps","text":"<pre><code>sequenceDiagram\n    participant U as User/System\n    participant H as Agent Hub\n    participant DB as SQLite\n    participant A as Agent (Baron)\n\n    U-&gt;&gt;H: POST /sessions (agent_id)\n    H-&gt;&gt;DB: Create session record\n    H--&gt;&gt;U: SessionResponse (session_id: active)\n\n    U-&gt;&gt;H: POST /ask/{topic} (question, session_id)\n    H-&gt;&gt;DB: Get session context\n    H-&gt;&gt;A: POST /invoke (question + history)\n    A--&gt;&gt;H: InvokeResponse\n    H-&gt;&gt;DB: Store user + assistant messages\n    H--&gt;&gt;U: AskExpertResponse\n\n    U-&gt;&gt;H: POST /ask/{topic} (follow-up, session_id)\n    H-&gt;&gt;DB: Get session context (includes previous)\n    H-&gt;&gt;A: POST /invoke (follow-up + history)\n    A--&gt;&gt;H: InvokeResponse\n    H-&gt;&gt;DB: Store messages\n    H--&gt;&gt;U: AskExpertResponse\n\n    U-&gt;&gt;H: DELETE /sessions/{id}\n    H-&gt;&gt;DB: Mark session closed\n    H--&gt;&gt;U: SessionResponse (status: closed)</code></pre>"},{"location":"user-journeys/SVC-004-multi-turn-session/#step-1-create-session","title":"Step 1: Create Session","text":"<p>Endpoint: <code>POST /sessions</code></p> <p>Request: <pre><code>{\n  \"agent_id\": \"@baron\",\n  \"feature_id\": \"008-auth-system\"\n}\n</code></pre></p> <p>Response: <pre><code>{\n  \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"agent_id\": \"@baron\",\n  \"feature_id\": \"008-auth-system\",\n  \"status\": \"active\",\n  \"created_at\": \"2026-01-05T12:00:00Z\",\n  \"updated_at\": \"2026-01-05T12:00:00Z\"\n}\n</code></pre></p>"},{"location":"user-journeys/SVC-004-multi-turn-session/#step-2-first-exchange","title":"Step 2: First Exchange","text":"<p>Endpoint: <code>POST /ask/{topic}</code></p> <p>Request: <pre><code>{\n  \"question\": \"I'm building a user authentication system with OAuth2\",\n  \"feature_id\": \"008-auth-system\",\n  \"session_id\": \"550e8400-e29b-41d4-a716-446655440000\"\n}\n</code></pre></p> <p>Response: <pre><code>{\n  \"answer\": \"For OAuth2 authentication, I recommend...\",\n  \"confidence\": 88,\n  \"status\": \"resolved\",\n  \"session_id\": \"550e8400-e29b-41d4-a716-446655440000\"\n}\n</code></pre></p>"},{"location":"user-journeys/SVC-004-multi-turn-session/#step-3-follow-up-exchange","title":"Step 3: Follow-Up Exchange","text":"<p>Request: <pre><code>{\n  \"question\": \"Given what I just said, should I use JWT or sessions?\",\n  \"feature_id\": \"008-auth-system\",\n  \"session_id\": \"550e8400-e29b-41d4-a716-446655440000\"\n}\n</code></pre></p> <p>The agent receives the previous conversation context automatically.</p>"},{"location":"user-journeys/SVC-004-multi-turn-session/#step-4-get-session-history","title":"Step 4: Get Session History","text":"<p>Endpoint: <code>GET /sessions/{id}</code></p> <p>Response: <pre><code>{\n  \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"agent_id\": \"@baron\",\n  \"status\": \"active\",\n  \"messages\": [\n    {\n      \"id\": \"msg-1\",\n      \"role\": \"user\",\n      \"content\": \"I'm building a user authentication system with OAuth2\",\n      \"created_at\": \"2026-01-05T12:00:00Z\"\n    },\n    {\n      \"id\": \"msg-2\",\n      \"role\": \"assistant\",\n      \"content\": \"For OAuth2 authentication, I recommend...\",\n      \"metadata\": {\"confidence\": 88},\n      \"created_at\": \"2026-01-05T12:00:05Z\"\n    },\n    {\n      \"id\": \"msg-3\",\n      \"role\": \"user\",\n      \"content\": \"Given what I just said, should I use JWT or sessions?\",\n      \"created_at\": \"2026-01-05T12:01:00Z\"\n    },\n    {\n      \"id\": \"msg-4\",\n      \"role\": \"assistant\",\n      \"content\": \"Based on your OAuth2 setup, JWT tokens would be...\",\n      \"metadata\": {\"confidence\": 92},\n      \"created_at\": \"2026-01-05T12:01:10Z\"\n    }\n  ]\n}\n</code></pre></p>"},{"location":"user-journeys/SVC-004-multi-turn-session/#step-5-close-session","title":"Step 5: Close Session","text":"<p>Endpoint: <code>DELETE /sessions/{id}</code></p> <p>Response: <pre><code>{\n  \"id\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"agent_id\": \"@baron\",\n  \"status\": \"closed\",\n  \"created_at\": \"2026-01-05T12:00:00Z\",\n  \"updated_at\": \"2026-01-05T12:05:00Z\"\n}\n</code></pre></p>"},{"location":"user-journeys/SVC-004-multi-turn-session/#session-states","title":"Session States","text":"State Description active Session is available for exchanges closed Session manually closed, history preserved expired Session expired due to inactivity (1 hour default)"},{"location":"user-journeys/SVC-004-multi-turn-session/#success-criteria","title":"Success Criteria","text":"Criterion Verification Context preservation Previous messages included in agent context (SC-006) 5+ exchanges Session supports at least 5 consecutive exchanges Independent sessions Multiple sessions don't interfere Audit preservation Closed sessions retain message history Expired handling Expired sessions reject new messages"},{"location":"user-journeys/SVC-004-multi-turn-session/#test-mapping","title":"Test Mapping","text":"Test Type File Description Contract <code>services/agent-hub/tests/contract/test_sessions_create.py</code> POST /sessions Contract <code>services/agent-hub/tests/contract/test_sessions_get.py</code> GET /sessions/{id} Contract <code>services/agent-hub/tests/contract/test_sessions_close.py</code> DELETE /sessions/{id} Integration <code>services/agent-hub/tests/integration/test_session_context.py</code> Context preservation E2E <code>tests/e2e/test_multi_turn_session.py</code> Full journey with SVC-004 marker"},{"location":"user-journeys/SVC-004-multi-turn-session/#running-tests","title":"Running Tests","text":"<pre><code># Contract tests\ncd services/agent-hub\nuv run pytest tests/contract/test_sessions*.py -m contract\n\n# Integration tests\nuv run pytest tests/integration/test_session_context.py -m integration\n\n# E2E tests (requires running services)\ncd ../..\nuv run pytest tests/e2e/test_multi_turn_session.py -m \"e2e and journey\"\n</code></pre>"},{"location":"user-journeys/SVC-004-multi-turn-session/#api-reference","title":"API Reference","text":""},{"location":"user-journeys/SVC-004-multi-turn-session/#post-sessions","title":"POST /sessions","text":"<p>Create a new session.</p> Parameter Type Required Description agent_id string Yes Agent identifier (e.g., @baron) feature_id string No Feature ID for grouping"},{"location":"user-journeys/SVC-004-multi-turn-session/#get-sessionssession_id","title":"GET /sessions/{session_id}","text":"<p>Get session with message history.</p> Parameter Type Required Description session_id uuid (path) Yes Session UUID"},{"location":"user-journeys/SVC-004-multi-turn-session/#delete-sessionssession_id","title":"DELETE /sessions/{session_id}","text":"<p>Close a session (preserves history).</p> Parameter Type Required Description session_id uuid (path) Yes Session UUID"},{"location":"user-journeys/SVC-004-multi-turn-session/#configuration","title":"Configuration","text":"Environment Variable Default Description DATABASE_URL sqlite:///./data/agent-hub.db Database path SESSION_EXPIRY_HOURS 1 Session expiry time"},{"location":"user-journeys/SVC-004-multi-turn-session/#related-documentation","title":"Related Documentation","text":"<ul> <li>Services Overview</li> <li>Agent Hub Contract</li> <li>SVC-002: Agent Consultation</li> </ul>"},{"location":"user-journeys/SVC-005-stateless-agent/","title":"SVC-005: Stateless Agent Invocation","text":"<p>Domain: Services Architecture (SVC) Priority: P1 (MVP) Status: Implemented</p>"},{"location":"user-journeys/SVC-005-stateless-agent/#overview","title":"Overview","text":"<p>Baron agent service receives requests with all context, processes via Claude SDK, and returns complete response without maintaining server-side state.</p>"},{"location":"user-journeys/SVC-005-stateless-agent/#user-story","title":"User Story","text":"<p>As a calling service (Agent Hub or Orchestrator), I want to invoke Baron with complete context in each request, so that I can get workflow outputs without managing agent state.</p>"},{"location":"user-journeys/SVC-005-stateless-agent/#journey-steps","title":"Journey Steps","text":"<pre><code>sequenceDiagram\n    participant C as Caller\n    participant B as Baron Service\n    participant SDK as Claude SDK\n\n    C-&gt;&gt;B: POST /invoke (workflow_type, context)\n    B-&gt;&gt;B: Validate request\n    B-&gt;&gt;B: Build prompt from context\n    B-&gt;&gt;SDK: Execute with system prompt\n    SDK--&gt;&gt;B: Agent response\n    B-&gt;&gt;B: Calculate confidence\n    B--&gt;&gt;C: InvokeResponse (result, confidence, metadata)</code></pre>"},{"location":"user-journeys/SVC-005-stateless-agent/#step-1-request-validation","title":"Step 1: Request Validation","text":"<p>Endpoint: <code>POST /invoke</code></p> <p>Request: <pre><code>{\n  \"workflow_type\": \"specify\",\n  \"context\": {\n    \"feature_description\": \"Add user authentication with OAuth2\"\n  },\n  \"parameters\": {\n    \"priority\": \"P1\"\n  }\n}\n</code></pre></p> <p>Validation: - <code>workflow_type</code> must be one of: specify, plan, tasks, implement - <code>context</code> must be non-empty - <code>parameters</code> is optional</p>"},{"location":"user-journeys/SVC-005-stateless-agent/#step-2-prompt-building","title":"Step 2: Prompt Building","text":"<p>Baron constructs prompts from context:</p> <ol> <li>System prompt: Workflow-specific instructions</li> <li>User prompt: Context formatted as markdown</li> </ol>"},{"location":"user-journeys/SVC-005-stateless-agent/#step-3-sdk-execution","title":"Step 3: SDK Execution","text":"<p>Baron invokes Claude Code SDK: - Uses workflow-specific system prompt - Passes formatted context as user prompt - Collects streaming response</p>"},{"location":"user-journeys/SVC-005-stateless-agent/#step-4-response","title":"Step 4: Response","text":"<p>Response: <pre><code>{\n  \"success\": true,\n  \"result\": {\n    \"output\": \"# Feature Specification...\",\n    \"files_created\": [\"specs/001-auth/spec.md\"]\n  },\n  \"confidence\": 92,\n  \"metadata\": {\n    \"duration_ms\": 15234,\n    \"model_used\": \"claude-3-5-sonnet-20241022\"\n  }\n}\n</code></pre></p>"},{"location":"user-journeys/SVC-005-stateless-agent/#success-criteria","title":"Success Criteria","text":"Criterion Verification Stateless No session storage on server Complete context All info passed in request Independent requests Parallel requests don't interfere Proper errors 400 for bad request, 500 for failures"},{"location":"user-journeys/SVC-005-stateless-agent/#test-mapping","title":"Test Mapping","text":"Test Type File Description Contract <code>services/agents/baron/tests/contract/test_invoke.py</code> API contract validation Contract <code>services/agents/baron/tests/contract/test_health.py</code> Health endpoint validation Integration <code>services/agents/baron/tests/integration/test_stateless.py</code> Stateless behavior E2E <code>tests/e2e/test_baron_stateless.py</code> Full journey with SVC-005 marker"},{"location":"user-journeys/SVC-005-stateless-agent/#running-tests","title":"Running Tests","text":"<pre><code># Contract tests\ncd services/agents/baron\nuv run pytest tests/contract/ -m contract\n\n# Integration tests\nuv run pytest tests/integration/ -m integration\n\n# E2E tests (requires running service)\ncd ../../..\nuv run pytest tests/e2e/test_baron_stateless.py -m \"e2e and journey\"\n</code></pre>"},{"location":"user-journeys/SVC-005-stateless-agent/#api-reference","title":"API Reference","text":""},{"location":"user-journeys/SVC-005-stateless-agent/#post-invoke","title":"POST /invoke","text":"<p>Invoke Baron with a workflow request.</p> Parameter Type Required Description workflow_type string Yes specify, plan, tasks, or implement context object Yes Context for the workflow parameters object No Additional parameters session_id uuid No Optional session ID for logging"},{"location":"user-journeys/SVC-005-stateless-agent/#get-health","title":"GET /health","text":"<p>Get Baron health status.</p> <p>Response: <pre><code>{\n  \"status\": \"healthy\",\n  \"version\": \"0.1.0\",\n  \"agent_name\": \"baron\",\n  \"capabilities\": {\n    \"workflow_types\": [\"specify\", \"plan\", \"tasks\", \"implement\"],\n    \"tools\": [\"Read\", \"Write\", \"Glob\", \"Grep\", \"Edit\"]\n  }\n}\n</code></pre></p>"},{"location":"user-journeys/SVC-005-stateless-agent/#related-documentation","title":"Related Documentation","text":"<ul> <li>Services Overview</li> <li>Baron Agent</li> <li>Agent Service Contract</li> </ul>"},{"location":"user-journeys/SVC-006-local-dev-setup/","title":"SVC-006: Local Development Setup","text":"<p>Domain: Services Architecture (SVC) Priority: P3 Status: Implemented</p>"},{"location":"user-journeys/SVC-006-local-dev-setup/#overview","title":"Overview","text":"<p>Developers can start all Farmer Code services locally with a single command using Docker Compose. This enables rapid development and testing of the complete service stack.</p>"},{"location":"user-journeys/SVC-006-local-dev-setup/#user-story","title":"User Story","text":"<p>As a developer, I want to start all services with a single command, so that I can develop and test the complete system locally.</p>"},{"location":"user-journeys/SVC-006-local-dev-setup/#journey-steps","title":"Journey Steps","text":"<pre><code>sequenceDiagram\n    participant D as Developer\n    participant DC as Docker Compose\n    participant O as Orchestrator\n    participant H as Agent Hub\n    participant B as Baron\n\n    D-&gt;&gt;DC: docker-compose up\n    DC-&gt;&gt;B: Start baron:8002\n    B--&gt;&gt;DC: Health check OK\n    DC-&gt;&gt;H: Start agent-hub:8001\n    H--&gt;&gt;DC: Health check OK\n    DC-&gt;&gt;O: Start orchestrator:8000\n    O--&gt;&gt;DC: Health check OK\n    DC--&gt;&gt;D: All services ready\n\n    Note over D: Services available at:\n    Note over D: localhost:8000 (Orchestrator)\n    Note over D: localhost:8001 (Agent Hub)\n    Note over D: localhost:8002 (Baron)</code></pre>"},{"location":"user-journeys/SVC-006-local-dev-setup/#step-1-clone-and-setup","title":"Step 1: Clone and Setup","text":"<pre><code># Clone the repository\ngit clone https://github.com/farmer1st/farmer-code.git\ncd farmer-code\n\n# Copy environment template\ncp .env.example .env\n\n# Edit .env with your API keys\n# Required: ANTHROPIC_API_KEY\n</code></pre>"},{"location":"user-journeys/SVC-006-local-dev-setup/#step-2-start-all-services","title":"Step 2: Start All Services","text":"<p>Production mode (optimized, no hot reload): <pre><code>docker-compose up\n</code></pre></p> <p>Development mode (with hot reload): <pre><code>docker-compose -f docker-compose.dev.yml up\n</code></pre></p>"},{"location":"user-journeys/SVC-006-local-dev-setup/#step-3-verify-services","title":"Step 3: Verify Services","text":"<p>All services should be healthy within 60 seconds:</p> <pre><code># Check Orchestrator\ncurl http://localhost:8000/health\n# {\"status\": \"healthy\", \"service\": \"orchestrator\"}\n\n# Check Agent Hub\ncurl http://localhost:8001/health\n# {\"status\": \"healthy\", \"service\": \"agent-hub\"}\n\n# Check Baron\ncurl http://localhost:8002/health\n# {\"status\": \"healthy\", \"service\": \"baron\"}\n</code></pre>"},{"location":"user-journeys/SVC-006-local-dev-setup/#step-4-test-workflow","title":"Step 4: Test Workflow","text":"<pre><code># Create a workflow via Orchestrator\ncurl -X POST http://localhost:8000/workflows \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"workflow_type\": \"specify\",\n    \"feature_id\": \"test-feature\",\n    \"context\": {\"feature_description\": \"Test feature\"}\n  }'\n</code></pre>"},{"location":"user-journeys/SVC-006-local-dev-setup/#service-ports","title":"Service Ports","text":"Service Port Description Orchestrator 8000 Workflow state management Agent Hub 8001 Central agent coordination Baron 8002 PM Agent (specify, plan, tasks)"},{"location":"user-journeys/SVC-006-local-dev-setup/#service-dependencies","title":"Service Dependencies","text":"<pre><code>Baron (8002)\n    \u2191\nAgent Hub (8001)\n    \u2191\nOrchestrator (8000)\n</code></pre> <p>Services start in dependency order: 1. Baron starts first (no dependencies) 2. Agent Hub starts after Baron is healthy 3. Orchestrator starts after Agent Hub is healthy</p>"},{"location":"user-journeys/SVC-006-local-dev-setup/#environment-variables","title":"Environment Variables","text":"<p>Required in <code>.env</code>:</p> Variable Description ANTHROPIC_API_KEY Claude API key for Baron agent <p>Optional:</p> Variable Default Description GITHUB_TOKEN - GitHub token for escalation comments GITHUB_REPO farmer1st/farmer-code Repository for escalations"},{"location":"user-journeys/SVC-006-local-dev-setup/#development-mode-features","title":"Development Mode Features","text":"<p>The <code>docker-compose.dev.yml</code> configuration includes:</p> <ul> <li>Hot reload: Code changes reflect immediately</li> <li>Debug logging: Verbose log output</li> <li>Volume mounts: Local source code mounted into containers</li> </ul> <pre><code># Start in development mode\ndocker-compose -f docker-compose.dev.yml up\n\n# Rebuild after dependency changes\ndocker-compose -f docker-compose.dev.yml up --build\n</code></pre>"},{"location":"user-journeys/SVC-006-local-dev-setup/#common-commands","title":"Common Commands","text":"<pre><code># Start all services (background)\ndocker-compose up -d\n\n# View logs\ndocker-compose logs -f\n\n# View logs for specific service\ndocker-compose logs -f agent-hub\n\n# Stop all services\ndocker-compose down\n\n# Stop and remove volumes (fresh start)\ndocker-compose down -v\n\n# Rebuild images\ndocker-compose build\n\n# Restart specific service\ndocker-compose restart agent-hub\n</code></pre>"},{"location":"user-journeys/SVC-006-local-dev-setup/#troubleshooting","title":"Troubleshooting","text":""},{"location":"user-journeys/SVC-006-local-dev-setup/#services-fail-to-start","title":"Services fail to start","text":"<p>Check that ports are not in use: <pre><code>lsof -i :8000\nlsof -i :8001\nlsof -i :8002\n</code></pre></p>"},{"location":"user-journeys/SVC-006-local-dev-setup/#health-checks-failing","title":"Health checks failing","text":"<p>View service logs: <pre><code>docker-compose logs orchestrator\ndocker-compose logs agent-hub\ndocker-compose logs baron\n</code></pre></p>"},{"location":"user-journeys/SVC-006-local-dev-setup/#database-issues","title":"Database issues","text":"<p>Reset volumes for fresh start: <pre><code>docker-compose down -v\ndocker-compose up\n</code></pre></p>"},{"location":"user-journeys/SVC-006-local-dev-setup/#success-criteria","title":"Success Criteria","text":"Criterion Verification Start within 60 seconds <code>time docker-compose up</code> &lt; 60s (SC-001) All services healthy All <code>/health</code> endpoints return 200 Services communicate Workflow flows through all services"},{"location":"user-journeys/SVC-006-local-dev-setup/#test-mapping","title":"Test Mapping","text":"Test Type File Description E2E <code>tests/e2e/test_docker_compose.py</code> Full Docker Compose journey with SVC-006 marker"},{"location":"user-journeys/SVC-006-local-dev-setup/#running-tests","title":"Running Tests","text":"<pre><code># Run Docker Compose E2E tests (requires Docker)\nuv run pytest tests/e2e/test_docker_compose.py -m \"e2e and journey\" -v\n\n# Run file existence tests only (no Docker needed)\nuv run pytest tests/e2e/test_docker_compose.py::TestDockerComposeWithoutDocker -v\n</code></pre>"},{"location":"user-journeys/SVC-006-local-dev-setup/#related-documentation","title":"Related Documentation","text":"<ul> <li>Quickstart Guide</li> <li>Services Overview</li> <li>Orchestrator Service</li> <li>Agent Hub Service</li> </ul>"},{"location":"user-journeys/SVC-007-audit-log-query/","title":"SVC-007: Audit Log Query","text":""},{"location":"user-journeys/SVC-007-audit-log-query/#user-story","title":"User Story","text":"<p>As a developer or operator I want to query audit logs by feature ID So that I can review all Q&amp;A exchanges for a specific feature</p>"},{"location":"user-journeys/SVC-007-audit-log-query/#acceptance-criteria","title":"Acceptance Criteria","text":"<ul> <li>[ ] All agent invocations are logged to JSONL format</li> <li>[ ] Logs include: question, answer, confidence, status, duration_ms</li> <li>[ ] Logs are queryable by feature_id</li> <li>[ ] Session context is preserved for multi-turn conversations</li> <li>[ ] Escalation IDs are logged when escalation occurs</li> </ul>"},{"location":"user-journeys/SVC-007-audit-log-query/#journey-flow","title":"Journey Flow","text":"<pre><code>Developer queries logs \u2192 Filter by feature_id \u2192 Review Q&amp;A exchanges\n</code></pre>"},{"location":"user-journeys/SVC-007-audit-log-query/#step-1-invoke-agent-automatically-logged","title":"Step 1: Invoke Agent (Automatically Logged)","text":"<p>When a user invokes the Agent Hub via <code>/ask/{topic}</code>:</p> <pre><code>curl -X POST http://localhost:8001/ask/architecture \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"question\": \"What pattern should I use for data access?\",\n    \"feature_id\": \"008-data-layer\"\n  }'\n</code></pre> <p>Response: <pre><code>{\n  \"answer\": \"Use the repository pattern with SQLAlchemy ORM.\",\n  \"confidence\": 88,\n  \"status\": \"resolved\",\n  \"session_id\": \"a1b2c3d4-...\"\n}\n</code></pre></p>"},{"location":"user-journeys/SVC-007-audit-log-query/#step-2-log-entry-created","title":"Step 2: Log Entry Created","text":"<p>The exchange is automatically logged to <code>logs/audit.jsonl</code>:</p> <pre><code>{\n  \"id\": \"f5e6d7c8-...\",\n  \"timestamp\": \"2025-01-03T12:34:56.789Z\",\n  \"session_id\": null,\n  \"feature_id\": \"008-data-layer\",\n  \"topic\": \"architecture\",\n  \"question\": \"What pattern should I use for data access?\",\n  \"answer\": \"Use the repository pattern with SQLAlchemy ORM.\",\n  \"confidence\": 88,\n  \"status\": \"resolved\",\n  \"escalation_id\": null,\n  \"duration_ms\": 245,\n  \"metadata\": {\"agent\": \"baron\"}\n}\n</code></pre>"},{"location":"user-journeys/SVC-007-audit-log-query/#step-3-query-logs-by-feature","title":"Step 3: Query Logs by Feature","text":"<p>To review all exchanges for a feature:</p> <pre><code># Using jq to filter by feature_id\ncat logs/audit.jsonl | jq 'select(.feature_id == \"008-data-layer\")'\n\n# Count exchanges per feature\ncat logs/audit.jsonl | jq -s 'group_by(.feature_id) | map({feature: .[0].feature_id, count: length})'\n\n# Find escalated exchanges\ncat logs/audit.jsonl | jq 'select(.status == \"escalated\")'\n</code></pre>"},{"location":"user-journeys/SVC-007-audit-log-query/#log-entry-schema","title":"Log Entry Schema","text":"Field Type Description <code>id</code> UUID Unique entry identifier <code>timestamp</code> ISO 8601 UTC timestamp <code>session_id</code> UUID/null Session ID for multi-turn <code>feature_id</code> string Feature being worked on <code>topic</code> string Topic of the question <code>question</code> string The question asked <code>answer</code> string The answer provided <code>confidence</code> int (0-100) Confidence level <code>status</code> string \"resolved\" or \"escalated\" <code>escalation_id</code> UUID/null Escalation ID if escalated <code>duration_ms</code> int Response time in ms <code>metadata</code> object Additional context"},{"location":"user-journeys/SVC-007-audit-log-query/#configuration","title":"Configuration","text":"<p>The audit log path can be configured via environment variable:</p> <pre><code>export AUDIT_LOG_PATH=./logs/audit.jsonl\n</code></pre> <p>Default: <code>./logs/audit.jsonl</code></p>"},{"location":"user-journeys/SVC-007-audit-log-query/#success-criteria","title":"Success Criteria","text":"<ul> <li>SC-007.1: 100% of invocations are logged</li> <li>SC-007.2: Logs are queryable by feature ID</li> <li>SC-007.3: Log format matches data-model.md AuditLog schema</li> </ul>"},{"location":"user-journeys/SVC-007-audit-log-query/#related-tests","title":"Related Tests","text":"<ul> <li><code>tests/e2e/test_audit_logging.py::TestAuditLogging</code></li> <li><code>services/agent-hub/tests/unit/test_audit_logger.py</code></li> <li><code>services/agent-hub/tests/integration/test_audit_log.py</code></li> </ul>"},{"location":"user-journeys/WT-001-create-worktree/","title":"WT-001: Create Worktree for Feature Development","text":"<p>Actor: Developer or AI Agent Goal: Create an isolated development environment for a new feature Preconditions: Git repository exists with a main branch Priority: P1</p>"},{"location":"user-journeys/WT-001-create-worktree/#steps","title":"Steps","text":"<ol> <li>Initialize worktree service</li> <li>Expected outcome: Service connects to repository</li> <li> <p>System behavior: Validates git is available and path is a repository</p> </li> <li> <p>Request new worktree creation</p> </li> <li>Expected outcome: Branch created from main, worktree in sibling directory</li> <li> <p>System behavior:</p> <ul> <li>Creates branch <code>{issue_number}-{feature_name}</code></li> <li>Creates worktree at <code>../{repo}-{issue_number}-{feature_name}/</code></li> <li>Returns Worktree model with path, branch, commit info</li> </ul> </li> <li> <p>Verify worktree is ready</p> </li> <li>Expected outcome: Directory exists with checked out branch</li> <li>System behavior: Worktree is on the new feature branch</li> </ol>"},{"location":"user-journeys/WT-001-create-worktree/#success-criteria","title":"Success Criteria","text":"<ul> <li>Worktree created in under 2 seconds</li> <li>Branch correctly based on main branch</li> <li>Worktree path follows naming convention</li> <li>No interference with main repository</li> </ul>"},{"location":"user-journeys/WT-001-create-worktree/#e2e-test-coverage","title":"E2E Test Coverage","text":"<ul> <li>Test file: <code>tests/e2e/test_worktree_e2e.py</code></li> <li>Journey marker: <code>@pytest.mark.journey(\"WT-001\")</code></li> <li>Covered steps: 1, 2, 3</li> <li>Test status: <code>test_create_worktree_e2e</code></li> </ul>"},{"location":"user-journeys/WT-001-create-worktree/#related-journeys","title":"Related Journeys","text":"<ul> <li>WT-002: Initialize plans folder after worktree creation</li> <li>WT-004: Cleanup worktree after feature completion</li> </ul>"},{"location":"user-journeys/WT-002-init-plans/","title":"WT-002: Initialize Plans Folder Structure","text":"<p>Actor: Developer or AI Agent Goal: Set up specification folder structure for a feature Preconditions: Worktree exists for the feature Priority: P1</p>"},{"location":"user-journeys/WT-002-init-plans/#steps","title":"Steps","text":"<ol> <li>Request plans initialization</li> <li>Expected outcome: <code>.plans/{issue}/</code> directory created</li> <li> <p>System behavior: Creates folder structure with template files</p> </li> <li> <p>Verify folder structure</p> </li> <li>Expected outcome: All required files exist</li> <li> <p>System behavior: Returns PlansFolder model with paths to:</p> <ul> <li><code>.plans/{issue}/README.md</code></li> <li><code>.plans/{issue}/spec.md</code></li> <li><code>.plans/{issue}/plan.md</code></li> <li><code>.plans/{issue}/tasks.md</code></li> </ul> </li> <li> <p>Templates populated with metadata</p> </li> <li>Expected outcome: Files contain issue number and feature title</li> <li>System behavior: README.md has correct header and links</li> </ol>"},{"location":"user-journeys/WT-002-init-plans/#success-criteria","title":"Success Criteria","text":"<ul> <li>Plans folder created in under 1 second</li> <li>All 4 template files present</li> <li>Files contain correct issue metadata</li> <li>Idempotent (can be called multiple times safely)</li> </ul>"},{"location":"user-journeys/WT-002-init-plans/#e2e-test-coverage","title":"E2E Test Coverage","text":"<ul> <li>Test file: <code>tests/e2e/test_worktree_e2e.py</code></li> <li>Journey marker: <code>@pytest.mark.journey(\"WT-002\")</code></li> <li>Covered steps: 1, 2, 3</li> <li>Test status: <code>test_init_plans_e2e</code></li> </ul>"},{"location":"user-journeys/WT-002-init-plans/#related-journeys","title":"Related Journeys","text":"<ul> <li>WT-001: Create worktree before initializing plans</li> <li>WT-003: Commit plans after editing</li> </ul>"},{"location":"user-journeys/WT-003-commit-push/","title":"WT-003: Commit and Push Feature Changes","text":"<p>Actor: Developer or AI Agent Goal: Save and share feature work with the team Preconditions: Worktree exists with uncommitted changes Priority: P2</p>"},{"location":"user-journeys/WT-003-commit-push/#steps","title":"Steps","text":"<ol> <li>Commit changes in worktree</li> <li>Expected outcome: All changes committed with message</li> <li> <p>System behavior:</p> <ul> <li>Stages all modified and new files</li> <li>Creates commit with provided message</li> <li>Returns CommitResult with SHA and file count</li> </ul> </li> <li> <p>Push to remote</p> </li> <li>Expected outcome: Branch pushed to origin</li> <li> <p>System behavior:</p> <ul> <li>Sets upstream on first push (<code>-u origin</code>)</li> <li>Returns OperationResult with success status</li> </ul> </li> <li> <p>Verify remote sync</p> </li> <li>Expected outcome: Local and remote branches aligned</li> <li>System behavior: Branch shows as up-to-date with origin</li> </ol>"},{"location":"user-journeys/WT-003-commit-push/#success-criteria","title":"Success Criteria","text":"<ul> <li>Commit created with correct message format</li> <li>All changes included in commit</li> <li>Push completes without force</li> <li>Branch trackable on remote</li> </ul>"},{"location":"user-journeys/WT-003-commit-push/#e2e-test-coverage","title":"E2E Test Coverage","text":"<ul> <li>Test file: <code>tests/e2e/test_worktree_e2e.py</code></li> <li>Journey marker: <code>@pytest.mark.journey(\"WT-003\")</code></li> <li>Covered steps: 1, 2, 3</li> <li>Test status: <code>test_commit_and_push_e2e</code></li> </ul>"},{"location":"user-journeys/WT-003-commit-push/#related-journeys","title":"Related Journeys","text":"<ul> <li>WT-002: Initialize plans before committing</li> <li>WT-004: Cleanup after push and merge</li> </ul>"},{"location":"user-journeys/WT-004-cleanup-worktree/","title":"WT-004: Cleanup Worktree After Feature Completion","text":"<p>Actor: Developer or AI Agent Goal: Remove worktree and branch after feature is merged Preconditions: Feature merged to main, worktree no longer needed Priority: P2</p>"},{"location":"user-journeys/WT-004-cleanup-worktree/#steps","title":"Steps","text":"<ol> <li>Remove worktree directory</li> <li>Expected outcome: Worktree directory deleted, git metadata cleaned</li> <li> <p>System behavior:</p> <ul> <li>Runs <code>git worktree remove</code></li> <li>Deletes the sibling directory</li> <li>Returns OperationResult with success</li> </ul> </li> <li> <p>Delete local branch</p> </li> <li>Expected outcome: Feature branch removed from local</li> <li> <p>System behavior:</p> <ul> <li>Runs <code>git branch -d</code> (or <code>-D</code> if force)</li> <li>Validates branch is merged before deletion</li> </ul> </li> <li> <p>Delete remote branch (optional)</p> </li> <li>Expected outcome: Feature branch removed from origin</li> <li>System behavior:<ul> <li>Runs <code>git push origin --delete</code></li> <li>Returns OperationResult with status</li> </ul> </li> </ol>"},{"location":"user-journeys/WT-004-cleanup-worktree/#success-criteria","title":"Success Criteria","text":"<ul> <li>Worktree directory completely removed</li> <li>No orphaned git worktree references</li> <li>Branch deleted locally (and optionally remotely)</li> <li>No data loss if uncommitted changes exist (error raised)</li> </ul>"},{"location":"user-journeys/WT-004-cleanup-worktree/#e2e-test-coverage","title":"E2E Test Coverage","text":"<ul> <li>Test file: <code>tests/e2e/test_worktree_e2e.py</code></li> <li>Journey marker: <code>@pytest.mark.journey(\"WT-004\")</code></li> <li>Covered steps: 1, 2</li> <li>Test status: <code>test_remove_worktree_e2e</code></li> </ul>"},{"location":"user-journeys/WT-004-cleanup-worktree/#related-journeys","title":"Related Journeys","text":"<ul> <li>WT-001: Create worktree (inverse operation)</li> <li>WT-003: Ensure changes pushed before cleanup</li> </ul>"}]}